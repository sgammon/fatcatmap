/*! AppTools */ (function(){var v,L,p,q,R,F,w,S,A,x,T,y,U,V,W,G,z,X,C,H,Y,fa,I,M,ga,N,Z,aa,ba,ha,O,J,P,K,D,E,ca,B={}.hasOwnProperty,k=function(g,a){function b(){this.constructor=g}for(var e in a)B.call(a,e)&&(g[e]=a[e]);b.prototype=a.prototype;g.prototype=new b;g.__super__=a.prototype;return g},s=[].slice,ia=[].indexOf||function(g){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===g)return a;return-1},Q=function(g,a){return function(){return g.apply(a,arguments)}};A="installed_drivers installed_integrations abstract_base_classes abstract_feature_interfaces deferred_core_modules deferred_library_integrations".split(" ");
this.__apptools_preinit={};E=0;for(v=A.length;E<v;E++)q=A[E],this.__apptools_preinit[q]=[];q=function(){function g(a,b){null!=(null!=a?a.events:void 0)&&(this.events=a.events)}g.prototype.install=function(a,b){null!=a.apptools&&a.apptools.sys.modules.install(b);a.__apptools_preinit.deferred_core_modules.push(b);return b};return g}();window.CoreAPI=q;y=function(){function g(){}g.prototype.install=function(a,b){a.__apptools_preinit.abstract_base_classes.push(b);return b};return g}();window.CoreObject=
y;w=function(g){function a(b){this}k(a,g);a.prototype.name=null;a.prototype.library=null;a.prototype["interface"]=[];a.prototype.install=function(b,a){null!=b.apptools&&b.apptools.sys.drivers.install(a);b.__apptools_preinit.installed_drivers.push(a);return b[a.name]=a};return a}(y);window.CoreDriver=w;x=function(g){function a(b){this.drivers={adapters:{},priority:[],selected:null}}k(a,g);a.prototype.parent=null;a.prototype.required=[];a.prototype.capability=null;a.prototype["static"]=!0;a.prototype.install=
function(b,a){null!=b.apptools&&b.apptools.sys.interfaces.install(a);b.__apptools_preinit.abstract_feature_interfaces.push(a);return b[a.name]=a};a.prototype.add=function(b){this.drivers.adapters[b.name]=b;this.drivers.priority.push(b.name)};a.prototype.resolve=function(b){var a,c,d;if(null!=b)return null!=this.drivers.adapters[b]?this.drivers.adapters[b]:!1;if(this["static"]&&null!=this.drivers.selected)return this.drivers.adapters[this.drivers.selected];d=this.drivers.priority;a=0;for(c=d.length;a<
c;a++)b=d[a],null!=b.priority&&-1<b.priority?this.drivers.selected=b:null==b.priority&&(this.drivers.selected=b);return null===this.drivers.selected?!1:this.drivers.adapters[this.drivers.selected]};return a}(y);window.CoreInterface=x;A=function(g){function a(b,a,c){this.module=b;this.message=a;this.context=c}k(a,g);a.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message};a.prototype.install=function(b,a){b.__apptools_preinit.abstract_base_classes.push(a);return a};return a}(Error);
window.CoreException=A;v=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);return a}(w);p=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);return a}(A);window.AppToolsDriver=v;window.AppToolsException=p;z=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);return a}(w);v=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);return a}(x);window.Driver=z;window.Interface=
v;this.__apptools_preinit.abstract_base_classes.push(q,y,x,w,A,p,z,v);K=function(){function g(){var a=this;if(0<arguments.length)return _.get.apply(_,arguments);if(null!=window._&&null!=window._.resolve_common_ancestor)return window._;this._state={active:null,init:!1,dom_status:null,dom_ready:!1,queues:{fx:[],dom:[],deferred:[],ready:[],"default":[]},counts:{fx:0,dom:0,deferred:0,ready:0,"default":0},handlers:{"default":function(b){console.log("Default queue handler called on Util, returning queue: ",
b);return b},ready:function(b){document.readyState="complete";document.removeEventListener("DOMContentLoaded",a._state.handlers.ready,!1);a._state.dom_ready=!0;a._state.dom_status="READY";return $.apptools.events.trigger("DOM_READY")}},callbacks:{"default":null}};this.internal={queues:{create:function(b,e,c){null==c&&(c="handler");a._state.queues[b]=[];a._state.counts[b]=0;a._state[c+"s"][b]=e},remove:function(b,e){var c,d;c=a._state.handlers[b];delete a._state.handlers[b];d=a._state.queues[b];delete a._state.queues[b];
c=0<d.length?{queue:d,handler:c}:!0;return null!=e?e(c):c},add:function(b,e){null==e&&(e=b,b="default");a._state.queues[b].push(e);return a._state.counts[b]++},set_handler:function(b,e){return a._state.handlers[b]=e},set_callback:function(b,e){return a._state.callbacks[b]=e},go:function(b,e){a._state.counts[b]--;return a._state.handlers[b]&&a.is_array(e)?a._state.handlers[b](e):a._state.callbacks[b]?a._state.callbacks[b](e):a.is_function(e)?e.call(window,window):e},process:function(b){var e,c,d,f,
h;e=a._state.queues[b];a._state.queues[b]=[];c=[];d=0;for(f=e.length;d<f;d++)h=e[d],c.push(a.internal.queues.go(b,h));return c}}};this.is=function(b){return!a.in_array([!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"],b)};this.has=function(b,a){return{}.hasOwnProperty.call(b,a)};this.is_function=function(b){return"function"===a.type_of(b)};this.is_object=function(b){return"object"===a.type_of(b)};this.is_raw_object=function(b){return!b||"object"!==a.type_of(b)||
b.nodeType||a.is_window(b)||null!=b.constructor&&!b.hasOwnProperty("constructor")&&!b.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0};this.is_empty_object=function(b){for(var a in b)return!1;return!0};this.is_window=function(b){return!!b.setInterval||null!=b.self&&b.self===b||"undefined"!==typeof Window&&null!==Window&&b instanceof Window};this.is_body=function(b){return a.is_object(b)&&("[object HTMLBodyElement]"===Object.prototype.toString.call(b)||"HTMLBodyElement"===b.constructor.name)};
this.is_array=Array.isArray||function(b){return"array"===a.type_of(b)};this.is_string=function(b){return"string"===a.type_of(b)};this.attr=function(b,a,c){return a&&b?null!=c?(b.setAttribute(a,c),b):b.getAttribute(a):!1};this.data=function(b,e,c){var d,f,h,l;null==b&&(b=document);h=/^data-(\w*)$/;if(null==e&&null==c){c={};e=b.attributes;f=0;for(l=e.length;f<l;f++)d=e[f],h.test(d.name)&&(d=h.exec(d.name)[1],c[d]=a.data(b,d));return a.is_empty_object(c)?null:c}if(a.is_raw_object(e)){for(f in e)c=e[f],
a.data(b,f,c);return b}e=h.test(e)?e:"data-"+e;if(null!=c){if(!1===c)return b.removeAttribute(e);if(a.is_object(c)||a.is_array(c))c=a.JSON_to_safe(JSON.stringify(c));b.setAttribute(e,c);return b}return(b=b.getAttribute(e)||!1)?a.is_JSON(b)?JSON.parse(a.safe_to_JSON(b)):b:null};this.is_JSON=function(b){return a.is_string(b)&&/[\{\[](?:.*)[\}\]]/.test(b)};this.JSON_to_safe=function(b){return b.split('"').join("'")};this.safe_to_JSON=function(b){return b.split("'").join('"')};this.in_array=function(b,
e){return!!~a.indexOf(b,e)};this.to_array=function(b){var e;if(!b)return!1;if(a.is_array(b))return b;if(null==b.length)return[b];e=[];for(D=b.length;D--;e.unshift(b[D]));return e};this.join=function(){var b,e,c,d,f,h,l,m;c=a.to_array(arguments);d=[];f=0;for(l=c.length;f<l;f++)for(e=c[f],e=a.to_array(e),h=0,m=e.length;h<m;h++)b=e[h],d.push(b);return d};this.indexOf=function(b,e){var c,d,f;if(a.is_array(b)){if(null!=(E=Array.prototype.indexOf))return E.call(b,e);for(c=b.length;c--;)if(b[c]===e)return c;
return-1}if(a.is_object(b)){d=-1;for(c in b)if(B.call(b,c)&&(f=b[c],f===e)){d=c;break}return d}throw"indexOf() requires an iterable as the first parameter";};this.each=function(b,e,c){var d,f,h,l,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"each() requires an iterator as the second parameter";h=[];if(a.is_array(b)){if(null!=(d=Array.prototype.forEach))return d.call(b,e,c);d=l=0;for(m=b.length;l<m;d=++l)f=b[d],h.push(e.call(c,f,d,b))}else if(a.is_object(b))for(d in b)f=b[d],h.push(e.call(c,
f,d,b));else throw"each() requires an iterable as the first parameter";};this.map=function(b,e,c){var d,f,h,l,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"map() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(h=Array.prototype.map))return h.call(b,e,c);h=[];d=l=0;for(m=b.length;l<m;d=++l)f=b[d],h.push(e.call(c,f,d,b))}else if(a.is_object(b))for(d in h={},b)B.call(b,d)&&(f=b[d],h[d]=e.call(c,f,d,b));else throw"map() requires an iterable as the first parameter";
return h};this.filter=function(b,e,c){var d,f,h,l,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"filter() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(h=Array.prototype.filter))return h.call(b,e,c);h=[];d=l=0;for(m=b.length;l<m;d=++l)f=b[d],e.call(c,f,d,b)&&h.push(f)}else if(a.is_object(b))for(d in h={},b)B.call(b,d)&&(f=b[d],e.call(c,f,d,b)&&(h[d]=f));else throw"filter() requires an iterable as the first parameter";return h};this.reject=function(b,e,c){var d,
f,h,l,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"reject() requires an iterator as the second parameter";if(a.is_array(b))for(h=[],d=l=0,m=b.length;l<m;d=++l)f=b[d],e.call(c,f,d,b)||h.push(f);else if(a.is_object(b))for(d in h={},b)B.call(b,d)&&(f=b[d],e.call(c,f,d,b)||(h[d]=f));else throw"reject() requires an iterable as the first parameter";return h};this.exclude=function(b,e){var c,d,f,h;if(a.is_array(b))for(d=[],f=0,h=b.length;f<h;f++)c=b[f],~a.indexOf(e,c)||d.push(c);else if(a.is_object(b))for(c in d=
{},b)f=b[c],~a.indexOf(e,c)||(d[c]=f);else throw"exclude() requires two iterables";return d};this.all=function(b,e,c){var d,f,h,l;null==c&&(c=window);if("function"!==a.type_of(e))throw"all() requires an iterator as the second parameter";if((h=a.is_array(b))||(l=a.is_object(b))){if(h&&null!=(f=Array.prototype.every))return f.call(b,e,c);b=a.reject(b,e,c);if(h)return 0===b.length;h=[];for(d in l)h.push(!1);return h}throw"all() requires an iterable as the first parameter";};this.any=function(b,e,c){var d,
f,h,l;null==c&&(c=window);if("function"!==a.type_of(e))throw"any() requires an iterator as the second parameter";if((h=a.is_array(b))||(l=a.is_object(b))){if(h&&null!=(f=Array.prototype.some))return f.call(b,e,c);b=a.filter(b,e,c);if(h)return 0<b.length;h=[];for(d in l)h.push(!0);return h}throw"any() requires an iterable as the first parameter";};this.reduce=function(b,e,c,d){var f,h,l;null==d&&(d=window);null==c&&(c=a.is_array(b[0])?[]:0);if("function"!==a.type_of(e))throw"reduce() requires an iterator as the second parameter";
if(a.is_array(b)){if(null!=(f=Array.prototype.reduce))return f.call(b,e,c,d);f=c;h=0;for(l=b.length;h<l;h++)c=b[h],e.call(d,f,c,b);return f}throw"reduce() requires an array as the first parameter";};this.reduce_right=function(b,e,c,d){null==d&&(d=window);null==c&&(c=a.is_array(b[b.length-1])?[]:0);if("function"!==a.type_of(e))throw"reduce_right() requires an iterator as the second parameter";if(a.is_array(b))return a.reduce(b.reverse(),e,c,d);throw"reduce_right() requires an array as the first parameter";
};this.sort=function(b,e){var c;if(null!=e&&"function"!==a.type_of(e))throw"sort() requires an iterator as the second parameter";if(null!=(c=Array.prototype.sort))return c.call(b,e);console.log("non-native sort() currently stubbed.");return!1};this.defaults=function(b,e){var c,d,f,h;null==e&&(e={});if(a.is_array(b))for(c=f=0,h=b.length;f<h;c=++f)d=b[c],null==d&&(b[c]=e[c]);else if(a.is_object(b))for(c in b)d=b[c],null==d&&(b[c]=e[c]);else throw"Defaults requires an iterable as the first param.";return b};
this.first=function(b){return b.slice().shift()};this.last=function(b){return b.slice().pop()};this.purge=function(b){return a.filter(b,function(b){return a.is(b)})};this.empties=function(b){var e;e=[];_.each(b,function(b,d){a.is(b)||e.push(d)});return e};this.create_element_string=function(b,e,c,d){var f,h,l;null==c&&(c="*");b=b.toLowerCase();f="<"+b;for(h in e)l=e[h],f+=" "+h+'="'+(a.is_JSON(l)?a.JSON_to_safe(l):a.is_raw_object(l)||a.is_array(l)?a.JSON_to_safe(JSON.stringify(l)):l)+'"';null!=d&&
(f+=" "+d);f+=">";a.in_array("area base basefont br col frame hr img input link".split(" "),b)||(f+=c+"</"+b+">");return f};this.create_doc_frag=function(b){var a,c,d,f;if(1<arguments.length)for(c="",d=0,f=arguments.length;d<f;d++)a=arguments[d],c+=a;else c=b;a=document.createRange();a.selectNode(document.getElementsByTagName("div").item(0));return a.createContextualFragment(c)};this.to_doc_frag=function(b){var a;a=document.createDocumentFragment();a.appendChild(b);return a};this.add=function(b,e,
c){var d,f,h;null==c&&(c=document.body);if(null==b||!a.is_object(e))return!1;d=a.debounce(function(b){var d,f,e,h;f=[];e=0;for(h=b.length;e<h;e++)d=b[e],f.push(a.create_element_string.apply(a,d));b=a.create_doc_frag(f.join(""));return c.appendChild(b)},500,!1);h=a.is_body(c)||null==c||!(f=c.getAttribute("id"))?"dom":f;null==a._state.queues[h]?a.internal.queues.create(h,{handler:d}):null==a._state.handlers[h]&&a.internal.queues.add_handler(h,d);a.internal.queues.add(h,[b,e]);return a.internal.queues.process(h)};
this.insert=function(b,a){return b.appendChild(a)};this.remove=function(b){return b.parentNode.removeChild(b)};this.get=function(b,e){var c,d,f;null==e&&(e=document);if(null==b||"string"===!a.type_of(b))return!1;if(b.nodeType)return b;a.is_array(b)&&(b=b[0]);null!=e.setInterval&&(e=document);return a.in_array([".","#"],b[0])?(d=[b.charAt(0),Array.prototype.slice.call(b,1).join("")],c=d[0],b=d[1],"#"===c?document.getElementById(b):a.to_array(e.getElementsByClassName(b))):null!=(d=document.getElementById(b))?
d:0<(c=e.getElementsByClassName(b)).length?1<c.length?a.to_array(c):c[0]:0<(f=e.getElementsByTagName(b)).length?1<f.length?a.to_array(f):f[0]:null};this.val=function(b,a){return null!=a?(b.value?b.value=a:b.innerText=a,b):b.value?b.value:b.innerText};this.html=function(b,a){return null!=a?(b.innerHTML=a,b):b.innerHTML};this.get_offset=function(b){var a,c;for(a=c=0;a+=b.offsetLeft,c+=b.offsetTop,b=b.offsetParent;);return{left:a,top:c}};this.has_class=function(b,a){var c;return(null!=(c=b.classList)?
c.contains(a):void 0)||b.className&&RegExp("\\s*"+a+"\\s*").test(b.className)};this.add_class=function(b,a){b.classList?b.classList.add(a):b.className+=" "+a;return b};this.remove_class=function(b,a){b.classList?b.classList.remove(a):b.className.replace(RegExp("\\s*"+a+"\\s*")," ").replace(/\s{2}/g," ");return b};this.is_id=function(b){return"#"===b.charAt(0)||null!==document.getElementById(b)?!0:!1};this.is_child=function(b,e){var c;c=!1;if(a.is_array(e))c=_.reject(_.map(e,function(c){return a.is_child(b,
c)}),function(b){return b}),c=0===c.length;else for(;e=e.parentNode;)if(e===b){c=!0;break}return c};this.children=function(b){return a.to_array(b.childNodes)};this.find_parent=function(b,e){var c;return null!=(c=a.filter([a.get(e)],function(c){return a.is_child(c,b)})[0])?c:null};this.resolve_common_ancestor=function(b,e,c){var d,f,h,l;null==c&&(c=document.body);if(a.is_child(c,[b,e])){l=[];h=null;for(f=d=!0;d||f;){if(d)if(a.in_array(l,b)){h=b;break}else l.push(b),d=b!==c&&(b=b.parentNode)&&null!=
b;if(f)if(a.in_array(l,e)){h=e;break}else l.push(e),f=e!==c&&(e=e.parentNode)&&null!=e}return h}throw"Bounding node must contain both search elements";};this.bind=function(b,e,c,d){var f,h,l,m,n,g;null==d&&(d=!1);if(null==b||null==e)return!1;if(a.is_window(b)||b.nodeType||(f=a.is_array(b))&&0<b.length&&b[0].nodeType)if(a.is_raw_object(e))for(h in e)c=e[h],b.addEventListener(h,c,d);else if(f)for(a.is_array(e)||(e=[e]),l=0,n=e.length;l<n;l++)for(f=e[l],m=0,g=b.length;m<g;m++)h=b[m],h.addEventListener(f,
c,d);else return b.addEventListener(e,c,d);else return b=[b,e,c],e=b[0],c=b[1],d=b[2],a.is_function(c)?$.apptools.events.hook(e,c,d):$.apptools.events.bridge(e,c,d)};this.bridge=function(){return a.bind.apply(a,arguments)};this.trigger=function(){return $.apptools.events.trigger.apply($.apptools.events,arguments)};this.unbind=function(b,e){var c,d,f;if(null==b)return!1;if(a.is_array(b))for(d=0,f=b.length;d<f;d++)c=b[d],a.unbind(c,e);else if(a.is_array(e))for(d=0,f=e.length;d<f;d++)c=e[d],a.unbind(b,
c);else if(a.is_raw_object(b))for(d in b)c=b[d],a.unbind(d,c);else return"NodeList"===b.constructor.name?a.unbind(a.to_array(b),e):b.removeEventListener(e)};this.block=function(b,a){var c,d;null==a&&(a={});console.log("[Util]","Enforcing blocking at user request... :(");d=!1;c=null;for(b(a,function(b){c=b;return d=!0});!1===d;);return c};this.defer=function(b,e){return null==e?a.ready(b):"NaN"===parseInt(e).toString()?!1:setTimeout(b,e)};this.ready=function(b){null==a._state.dom_status&&(a._state.dom_status=
"NOT_READY",a.bind("DOM_READY",a.ready),document.addEventListener("DOMContentLoaded",a._state.handlers.ready,!1));if(null==b&&a._state.dom_ready)return a.internal.queues.process("ready");if(a.is_function(b)&&(a.internal.queues.add("ready",b),"complete"===document.readyState&&!0===a._state.dom_ready))return a.defer(a.ready,1)};this.now=function(){return+new Date};this.timestamp=function(b){null==b&&(b=new Date);return[[b.getMonth()+1,b.getDate(),b.getFullYear()].join("-"),[b.getHours(),b.getMinutes(),
b.getSeconds()].join(":")].join(" ")};this.prep_animation=function(b,e,c){return null==b?{duration:400}:null!=b&&a.is_object(b)?a.extend({},b):{complete:c||!c&&e||a.is_function(b)&&b,duration:b,easing:c&&e||e&&!is_function(e)}};this.throttle=function(b,e,c){var d,f;null==c&&(c=!1);f=null;d=0;return function(){var h,l,m,n;h=a.to_array(arguments);m=a.now()-d;l=function(){n();return f=null};n=function(){d=a.now();return b.apply(window,h)};c&&!f&&n();f&&clearTimeout(f);return!c&&m>=e?n():f=setTimeout(c?
l:n,c?e:e-m)}};this.debounce=function(b,a,c){null==a&&(a=200);null==c&&(c=!1);return this.throttle(b,a,c)};this.currency=function(b){var a,c,d,f,h,l,m;c=(f=String(b).split("").reverse()).length;d=[];h=function(b,a){return d.unshift((0===(a+1)%3&&1<c-a?",":a===c-1?"$":"")+b)};a=l=0;for(m=f.length;l<m;a=++l)b=f[a],h(b,a);return d.join("")};this.extend=function(){var b,e,c,d,f,h,l,m,n,g;m=arguments[0]||{};c=1;h=!1;"boolean"===a.type_of(m)&&(h=m,m=arguments[1]||{},c++);a.is_object(m)||a.is_function(m)||
(m={});c=Array.prototype.slice.call(arguments,c);n=0;for(g=c.length;n<g;n++)for(l in e=c[n],e)d=e[l],m!==d&&(f=m[l],h&&null!=d&&(a.is_raw_object(d)||(b=a.is_array(d)))?(b?(b=!1,f=f&&(a.is_array(f)?f:[])):f=f&&(a.is_raw_object(f)?f:{}),m[l]=a.extend(h,f,d)):null!=d&&(m[l]=d));return m};this["extends"]=function(b,a){var c,d;c={}.hasOwnProperty;for(d in a)c.call(a,d)&&(b[d]=a[d]);return b};this.to_hex=function(b){var e,c;if(b.match(/^\#?[0-9a-fA-F]{6}|[0-9a-fA-F]{3}$/i))return b.charAt(0==="#")?b:"#"+
b;if(b.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i)){if(e=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],3===e.length)return c=a.zero_fill(e[0].toString(16,2)),b=a.zero_fill(e[1].toString(16,2)),e=a.zero_fill(e[2].toString(16,2)),"#"+c+b+e}else return!1};this.to_rgb=function(b){var a,c;return b.match(/^rgb\s*\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)\s*$/)?b:b.match(/^\#?([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})$/i)?(a=[parseInt(RegExp.$1,
16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],c=a[0].toString(10),b=a[1].toString(10),a=a[2].toString(10),"rgb("+c+","+b+","+a+")"):!1};this.strip_script=function(b){return b.match(/^javascript:(\w\W.)/)?(b=RegExp.$1,console.log("Script stripped from link: ",b),"javascript:void(0)"):b};this.type_of=function(b){return{}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.wrap=function(){var b,e,c,d;c=1;e=arguments[0];d=!1;"boolean"===a["typeof"](e)&&(d=e,e=arguments[1],c+=1);b=Array.prototype.slice.call(arguments,
c);return d?function(a){b.unshift(a);return e.apply(this,b)}:function(){return e.apply(this,b)}};this.zero_fill=function(b,a){null==a&&(a=8);return(Array(a).join("0")+b).slice(-a)};this.uuid=function(b){return b?(b=String(b),btoa(b+"-"+(+new Date).toString(16))):btoa((+new Date).toString(16))};this.resolve_uuid=function(b,a){var c,d,f;c=atob(b);d=c.split("-");1<d.length?(f=d[0],c=parseInt(d[1],16)):(f="",c=parseInt(c,16));return"prefix"===a?f:"timestamp"===a?c:"date"===a?Date(c):{prefix:f,timestamp:c}};
this.resolve_date=function(b){return a.resolve_uuid(b,"date")};this.resolve_prefix=function(b){return a.resolve_uuid(b,"prefix")};this.resolve_timestamp=function(b){return a.resolve_uuid(b,"timestamp")};this.init=function(){var b,e;b={find:function(b){return _.get(b,this)},getOffset:function(){return _.get_offset(this)},hasClass:function(b){return _.has_class(this,b)},addClass:function(b){return _.add_class(this,b)},removeClass:function(b){return _.remove_class(this,b)},isChild:function(b){return _.is_child(b,
this)},isParent:function(b){return _.is_child(this,b)},children:function(){return _.children(this)},resolveAncestor:function(b,a){return _.resolve_common_ancestor(this,b,a)},bind:function(b,a,f){return _.bind(this,b,a,f)},unbind:function(b,a,f){return _.unbind(this,b,a,f)},append:function(b){return _.append(this,b)},remove:function(){return _.remove(this)},val:function(b){return _.val(this,b)},html:function(){return _.html(this)},fadeIn:function(){return HTMLElement.prototype.fadeInJacked.apply(this,
arguments)},fadeOut:function(){return HTMLElement.prototype.fadeOutJacked.apply(this,arguments)},attr:function(b,a){return _.attr.call(_,this,b,a)},data:function(b,a){return _.data.call(_,this,b,a)}};a.extend(Element.prototype,b);null!=HTMLElement.prototype&&a.extend(HTMLElement.prototype,b);String.prototype.isJSON=function(){return _.is_JSON(this)};document.ready=function(){return _.ready.apply(_,arguments)};a._state.init=!0;delete a._init;delete a.constructor;e=function(){if(0<arguments.length)return e.get.apply(e,
arguments)};a.extend(e,a);return e}}g.mount="util";g.events=["DOM_READY"];return g}();window.Util=K;window._=(new K).init();null!=window.jQuery?$.extend({_:window._}):window.$=window._;F=function(g){function a(b,e){var c,d,f,h=this;d=function(){var b;b=1<=arguments.length?s.call(arguments,0):[];return console.log.apply(console,b)};c=function(){var b;b=1<=arguments.length?s.call(arguments,0):[];return console.error.apply(console,b)};f=function(){var b;b=1<=arguments.length?s.call(arguments,0):[];return console.warn.apply(console,
b)};this.eventlog=function(){var b,c,d,f;d=arguments[0];c=arguments[1];b=3<=arguments.length?s.call(arguments,2):[];a.prototype.debug.eventlog&&("bridge"!==(f=d.toLowerCase())&&"register"!==f&&"hook"!==f||!0===a.prototype.debug.verbose)&&h.log.apply(h,[["Events",d].join(":"),c].concat(s.call(b)))};this.log=function(){var b,c,f;f=arguments[0];c=arguments[1];b=3<=arguments.length?s.call(arguments,2):[];null==b&&(b="{no context}");!0===a.prototype.debug.logging&&d.apply(null,["["+f+"] INFO: "+c].concat(s.call(b)))};
this.warning=this.warn=function(){var b,c,d;d=arguments[0];c=arguments[1];b=3<=arguments.length?s.call(arguments,2):[];null==b&&(b="{no context}");!0===a.prototype.debug.logging&&f.apply(null,["["+d+"] WARNING: "+c].concat(s.call(b)))};this.error=function(){var b,d,f;f=arguments[0];d=arguments[1];b=3<=arguments.length?s.call(arguments,2):[];!0===a.prototype.debug.logging&&c.apply(null,["["+f+"] ERROR: "+d].concat(s.call(b)))};this.verbose=function(){var b,c,f;f=arguments[0];c=arguments[1];b=3<=arguments.length?
s.call(arguments,2):[];!0===a.prototype.debug.verbose&&d.apply(null,["["+f+"] DEBUG: "+c].concat(s.call(b)))};this.exception=this.critical=function(){var b,a,c,f;f=arguments[0];c=arguments[1];a=arguments[2];b=4<=arguments.length?s.call(arguments,3):[];null==a&&(a=e.AppToolsException);d("A critical error or unhandled exception occurred.");d.apply(null,["["+f+"] CRITICAL: "+c].concat(s.call(b)));throw new a(f,c,b);};!0===b.sys.state.config.devtools.debug&&(a.prototype.debug.logging=!0,a.prototype.debug.verbose=
!0,null!=b.sys.state.config.devtools.strict&&(a.prototype.debug.strict=b.sys.state.config.devtools.strict))}k(a,g);a.prototype.debug={strict:!1,logging:!0,eventlog:!1,verbose:!0,serverside:!1};a.mount="dev";a.events=[];return a}(q);this.__apptools_preinit.abstract_base_classes.push(F);(function(g){function a(b,a){this.source=b;this.message=a}k(a,g);a.prototype.toString=function(){return"["+this.source+"] ModelException: "+this.message};return a})(Error);T=function(g){function a(){var b=this;this._state=
{init:!1};this.put=function(a){return _.block(b.put_async,a)};this.get=function(a,c){return _.block(b.get_async,a,c)};this["delete"]=function(a,c){return _.block(b.delete_async,a,c)};this.put_async=function(a){null==a&&(a=function(b){return b});return apptools.storage.put(b.constructor.prototype.name,a)};this.get_async=function(a,c){null==c&&(c=function(b){return b});return apptools.storage.get(b.key,b.constructor.prototype.name,c)};this.delete_async=function(a){null==a&&(a=function(b){return b});
return apptools.storage["delete"](b.key,b.constructor.prototype.name,a)};this.all=function(b){if(null!=b&&null!=K&&K.is_function(b))throw"all() currently in active development, sorry.";if(null!=b)throw"Provided callback isn't a function. Whoops.";throw"all() requires a callback.";};this.register=function(){return apptools.dev.verbose("CoreModelAPI","register() currently in active development, sorry.")};this._init=function(){this._state.init=!0;return this}}k(a,g);a.mount="model";a.events=[];return a}(q);
p=function(){function g(a){var b,e,c,d,f,h,l=this;if(_.is_raw_object(a)&&1===arguments.length)for(e in a)b=a[e],this[e]=b;else this.key=a;h=g.prototype;c=function(b){return l.prototype[b]=function(){return g.prototype[b].apply(l,arguments)}};d=0;for(f=h.length;d<f;d++)b=h[d],c(b);if(null!=this.constructor.mount&&(b=this[this.constructor.mount],null!=b))for(e in d=b.constructor.prototype.model,d)c=d[e],"ListField"!==c.constructor.name&&function(b,a){l.__defineGetter__(a,function(){return b[a]});return l.__defineSetter__(a,
function(){})}(b,e);null!=(e=this.constructor.prototype.template||this.constructor.template)&&(this.template=new window.t(e));return this}g.prototype.validate=function(a,b,e){var c,d,f,h;null==b&&(b=this.constructor.prototype.model);null==e&&(e=!0);e?(f=[],c=function(a,c){var d,h,e,g,r;if(null!=(d=b[a])&&null!=c===(null!=d))if("function"===typeof d){if(d=new d,!d.validate(c))return f.push({k:c})}else{if("ListField"===d.constructor.name){h=new d[0];r=[];e=0;for(g=c.length;e<g;e++)if(d=c[e],!h.validate(d)){f.push({k:c});
break}return r}if(c.constructor.name!==d.constructor.name)return f.push({k:c})}else return f.push({k:c})}):(f={},c=function(a,c){var d,h,e,g,r;if(null!=(r=b[a])&&null!=c===(null!=r)){if("function"===typeof r)return f[a]=(new r).from_message(c);if("ListField"===r.constructor.name){h=new X;e=0;for(g=c.length;e<g;e++)d=c[e],h.push((new r[0]).from_message(d));return f[a]=h}if(c.constructor.name===r.constructor.name)return f[a]=c}});for(d in a)B.call(a,d)&&(h=a[d],c(d,h));return e?0===f.length:f};g.prototype.from_message=
function(a,b){var e,c,d;null==a&&(a={});null==b&&(b=!1);d=this.validate(a);e=this.validate(a,null,!1);if(b&&!d)console.log("Strict from_message() failed. Returning unmodified object.",this);else if(_.is_empty_object(e))console.log("No modelsafe properties found. Returning unmodified object.",this);else for(c in e)d=e[c],this[c]=d;return this};g.prototype.to_message=function(a){var b,e,c,d,f,h;b={};for(e in this)if(B.call(this,e)&&(c=this[e],"function"!==typeof c&&null!=this.constructor.prototype.model[e]))if("ListField"===
c.constructor.name){h=[];d=0;for(f=c.length;d<f;d++)a=c[d],h.push(a.to_message());b[e]=h}else b[e]=c;return b};return g}();w=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);a.prototype.model={key:String()};return a}(p);X=function(g){function a(){var b,e=this;a.__super__.constructor.call(this);if(0<arguments.length)return b=new a,b.push(arguments[0]),b;this.pick=function(b,a){var f,h,e,m;if("NaN"!==parseInt(b).toString())if(null!=a)if(f=b-a,0<f)e=this.slice(0,a),
f=e.join(this.slice(a).pick(f));else{m=-f;e=this.slice(0,b);for(h=this.slice(b);0>f;)h.pick(m),f++;f=e.join(h)}else h=this.slice(0,b),f=this.slice(b+1),f=this.slice(0,0).push(this[b]).join(h).join(f);else{if(~(f=_.indexOf(this,b)))return this.pick(f);f=_.to_array(this);f.unshift(b)}this.empty();return this.join(f)};this.join=function(b){var a,f,h,e,m,g;if(null!=b&&(_.is_array(b)||(b.constructor.name=this.constructor.name))){a=0;for(h=b.length;a<h;a++)f=b[a],this.push(f);return this}e="";h=this.length;
a=m=0;for(g=this.length;m<g;a=++m)f=this[a],a===h-1&&(e+=f.toString()),e+=f.toString()+b;return e};this.slice=function(b,a){var f;null==b&&(b=0);null==a&&(a=this.length);for(f=[];b<a;)f.push(this[b]),b++;return(new this.constructor).join(f)};this.push=function(b){this[this.length]=b;this.length++;return this};this.empty=function(){this.length=0;return this};this.keys=function(){var b,a,f,h;a=[];f=0;for(h=this.length;f<h;f++)b=this[f],null!=b&&null!=b.key&&a.push(b.key);return _.purge(a)};this.order=
function(b,d){var f;null==d&&(d=!1);f=(new a).join(this);this.empty();this.length=b.length;_.map(f,function(a,f,e){return this[_.indexOf(b)]=d?a[d]:a},this);return this};this.promote=function(b){b="NaN"!==parseInt(b).toString()?b:_.indexOf(e.keys(),b);return e.pick(b,b-1)};this.demote=function(b){b="NaN"!==parseInt(b).toString()?b:_.indexOf(e.keys(),b);return e.pick(b,b+1)};this.remove=function(b){var a;a="NaN"!==parseInt(b).toString()?b:_.indexOf(e.keys(),b);b=e.slice();b=b.slice(0,a).join(b.slice(a+
1));e.empty();return e.join(b)};return this}k(a,g);return a}(Array);this.__apptools_preinit.abstract_base_classes.push(T,p,w,X);S=function(g){function a(b,a){var c=this;this.registry=[];this.callchain={};this.history=[];this.mutators=[];this.fire=this.trigger=this.dispatch=function(){var a,f,h,e,g,n,t,u,k,r,da;f=arguments[0];a=2<=arguments.length?s.call(arguments,1):[];b.dev.eventlog("Trigger","Triggered event.",f,a,c.callchain[f]);if(0<=ia.call(c.registry,f)){g=n=0;h=[];u=[];u.push(f);da=c.callchain[f].hooks;
k=0;for(r=da.length;k<r;k++){e=da[k];try{if(!0!==e.once||!0!==e.has_run)!1===e.bridge?(t=e.fn.apply(e,a),n++,c.history.push({event:f,callback:e,args:a,result:t}),e.has_run=!0):!0===e.bridge&&h.push({event:e.event,args:a,mutator:e.mutator})}catch(ea){if(g++,e=c.history.push({event:f,callback:e,args:a,error:ea}),$.apptools.dev.eventlog("exception",'Encountered unhandled exception when dispatching event hook for "'+f+'".',c.history[e-1]),$.apptools.dev.debug.eventlog&&$.apptools.dev.debug.verbose&&$.apptools.dev.error("Events",
"Unhandled event hook exception.",ea),$.apptools.dev.debug.strict)throw ea;}}t=0;for(k=h.length;t<k;t++)a=h[t],u.push(a.event),!1!==a.mutator?c.trigger.apply(c,[a.event].concat(s.call(c.mutators[a.mutator](a.args,f,a.event)))):c.trigger.apply(c,[a.event].concat(s.call(a.args)));return{events:u,executed:n,errors:g}}return!1};this.create=this.register=function(a){var f,h,e;if(!_.is_array(a)){if(_.is_string(a)&&""===a)return;a=[a]}else if(0===a.length)return;b.dev.eventlog("Register","Registered events.",
{count:a.length,events:a});h=0;for(e=a.length;h<e;h++)f=a[h],c.registry.push(f),c.callchain[f]={hooks:[]};return c};this.on=this.upon=this.when=this.hook=function(a,f,h){null==h&&(h=!1);0>ia.call(c.registry,a)&&(b.dev.warning("warn","Tried to hook to unrecognized event. Registering..."),c.register(a));c.callchain[a].hooks.push({fn:f,once:h,has_run:!1,bridge:!1});b.dev.eventlog("Hook","Hook registered on event.",a);return!0};this.delegate=this.bridge=function(a,f,h){var e,g,n,t,u,k;null==h&&(h=null);
"string"===typeof f&&(f=[f]);"string"===typeof a&&(a=[a]);b.dev.eventlog("Bridge","Bridging events.",{from:a},"->",{to:f});k=[];t=0;for(u=a.length;t<u;t++)g=a[t],k.push(function(){var a,c,d;d=[];a=0;for(c=f.length;a<c;a++)n=f[a],null==this.callchain[g]&&(b.dev.warn("Events","Bridging from undefined source event:",g),this.register(g)),null!=h?(e=this.mutators.push(h),d.push(this.callchain[g].hooks.push({event:n,bridge:!0,mutator:e-1}))):d.push(this.callchain[g].hooks.push({event:n,bridge:!0,mutator:!1}));
return d}.call(c));return k}}k(a,g);a.mount="events";a.events=[];return a}(q);this.__apptools_preinit.abstract_base_classes.push(S);R=function(g){function a(b,a){var c,d,f,h,l,g=this;this.platform={};this.fingerprint={};this.capabilities={};null!=b.lib.modernizr&&(this.capabilities=b.lib.modernizr);this.capabilities.simple={};c=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,
subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:a.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},
{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];d=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];f=void 0;h=function(b){var a,c,d;c=0;for(d=b.length;c<d;c++)if(a=
b[c],null!=a.string){if(-1!==a.string.indexOf(a.subString))return f=a.versionSearch||a.identity,a.identity}else if(a.prop)return f=a.versionSearch||a.identity,a.identity};l=function(b){var a;a=b.indexOf(f);if(-1!==a)return parseFloat(b.substring(a+f.length+1))};this.fingerprint=function(){var b,f,u,k,r;b=h(c)||"unknown";r=l(navigator.userAgent)||l(navigator.appVersion)||"unknown";u=h(d)||"unknown";-1!==b.search("iPod/iPhone")||-1!==b.search("Android")?(k="mobile",f=!0):(k="desktop",f=!1);g.platform=
{os:u,type:k,vendor:navigator.vendor,product:navigator.product,browser:b,version:r,flags:{online:navigator.onLine||!0,mobile:f,webkit:/AppleWebKit\//.test(navigator.userAgent),msie:/MSIE/.test(navigator.userAgent),opera:/Opera/.test(navigator.userAgent),mozilla:/Firefox/.test(navigator.userAgent)}};g.capabilities.simple.cookies=navigator.cookieEnabled;null!=a.XMLHttpRequest&&(g.capabilities.simple.ajax=!0);return{browser:[g.platform.browser,g.platform.version].join(":"),mobile:g.platform.flags.mobile,
legacy:g.platform.flags.msie}}();return this}k(a,g);a.mount="agent";a.events=["UA_DISCOVER"];return a}(q);this.__apptools_preinit.abstract_base_classes.push(R);this.StorageDriver=w=function(g){function a(){}k(a,g);a.methods=["compatible","construct"];a["export"]="public";return a}(x);this.compatible=function(){};this.construct=function(){};this.StorageAdapter=C=function(g){function a(){}k(a,g);a.methods="get put delete clear get_async put_async delete_async clear_async".split(" ");a["export"]="public";
return a}(x);this.KeyEncoder=x=function(g){function a(){}k(a,g);a.methods=["build_key","encode_key","build_cluster","encode_cluster"];a["export"]="public";return a}(x);null!=this.__apptools_preinit?(null==this.__apptools_preinit.abstract_base_classes&&(this.__apptools_preinit.abstract_base_classes=[]),null==this.__apptools_preinit.deferred_core_modules&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]};this.__apptools_preinit.detected_storage_engines=
[];this.__apptools_preinit.abstract_base_classes.push(w,C);this.__apptools_preinit.abstract_feature_interfaces.push({adapter:w,name:"storage"});this.SimpleKeyEncoder=x=function(g){function a(){this.build_key=function(){};this.encode_key=function(){};this.build_cluster=function(){};this.encode_cluster=function(){}}k(a,g);return a}(x);ca=new x;this.LocalStorageEngine=H=function(g){function a(b){var a=this;this.name=b;this._state={runtime:{count:{total_keys:0,by_kind:[]}}};this.get_async=function(b,
d){return d.call(a.get(b))};this.put_async=function(b,d,f){a.put(b,d);return f.call(d)};this.delete_async=function(b,d){a["delete"](b);return d.call(a)};this.clear_async=function(b){a.clear();return b.call(a)};this.get=function(b){return localStorage.getItem(b)};this.put=function(b,d){null==a.get(b)&&a._state.runtime.count.total_keys++;return localStorage.setItem(b,d)};this["delete"]=function(b){a._state.runtime.count.total_keys--;return localStorage.removeItem(b)};this.clear=function(){a._state.runtime.count.total_keys=
0;return localStorage.clear()}}k(a,g);return a}(C);this.SessionStorageEngine=O=function(g){function a(b){var a=this;this.name=b;this._state={runtime:{count:{total_keys:0,by_kind:[]}}};this.get_async=function(b,d){return d.call(a.get(b))};this.put_async=function(b,d,f){a.put(b,d);return f.call(d)};this.delete_async=function(b,d){a["delete"](b);return d.call(a)};this.clear_async=function(b){a.clear();return b.call(a)};this.get=function(b){return sessionStorage.getItem(b)};this.put=function(b,d){null==
a.get(b)&&a._state.runtime.count.total_keys++;return sessionStorage.setItem(b,d)};this["delete"]=function(b){a._state.runtime.count.total_keys--;return sessionStorage.removeItem(b)};this.clear=function(){a._state.runtime.count.total_keys=0;return sessionStorage.clear()}}k(a,g);return a}(C);this.LocalStorageDriver=C=function(g){function a(){var b=this;this._state={};this.compatible=function(){return!!window.localStorage};this.construct=function(a){null==a&&(a="appstorage");return b.compatible()?new H(a):
!1}}k(a,g);return a}(w);this.SessionStorageDriver=w=function(g){function a(){var b=this;this._state={};this.compatible=function(){return!!window.sessionStorage};this.construct=function(a){null==a&&(a="appstorage");return b.compatible()?new O(a):!1}}k(a,g);return a}(w);this.__apptools_preinit.detected_storage_engines.push({name:"LocalStorage",adapter:H,driver:C,key_encoder:ca});this.__apptools_preinit.detected_storage_engines.push({name:"SessionStorage",adapter:O,driver:w,key_encoder:ca});this.__apptools_preinit.abstract_base_classes.push(x,
H,O,H,w);this.CoreStorageAPI=x=function(g){function a(b,a){var c=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},drivers:[],engines:{},encrypt:!1,integrity:!1,obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}};this.internal={check_support:function(b){},
bootstrap:function(b){},provision_collection:function(b,a,c){},add_storage_engine:function(a,f,h){var e,g;try{e=new f(b),g=new h(b)}catch(n){return!1}if(g.compatible())return c._state.config.engines[a]=g,f.adapter=c._state.config.engines[a],c._state.config.drivers.push(f),b.sys.drivers.install("storage",a,e,null!=e.enabled|1,null!=e.priority|50,function(a){return b.events.trigger("ENGINE_LOADED",{driver:a,engine:a.adapter})}),!0;b.dev.verbose("StorageEngine","Detected incompatible storage engine. Skipping.",
a,f,h);return!1}};this.get=function(){};this.list=function(){};this.count=function(){};this.put=function(){};this.query=function(){};this["delete"]=function(){};this.sync=function(){};this._init=function(){var a,f,h,e;b.events.trigger("STORAGE_INIT");b.dev.verbose("Storage","Storage support is currently under construction.");if(null!=(null!=(a=b.sys)?null!=(f=a.preinit)?f.detected_storage_engines:void 0:void 0))for(e=b.sys.preinit.detected_storage_engines,f=0,h=e.length;f<h;f++)a=e[f],c.internal.add_storage_engine(a.name,
a.driver,a.adapter);return b.events.trigger("STORAGE_READY")};b.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY");b.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}k(a,g);a.mount="storage";a.events="STORAGE_INIT ENGINE_LOADED STORAGE_READY STORAGE_ERROR STORAGE_ACTIVITY STORAGE_READ STORAGE_WRITE STORAGE_DELETE COLLECTION_SCAN COLLECTION_CREATE COLLECTION_DESTROY COLLECTION_UPDATE COLLECTION_SYNC".split(" ");
return a}(q);this.__apptools_preinit.abstract_base_classes.push(x);this.__apptools_preinit.deferred_core_modules.push({module:x});this.TransportInterface=P=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);a.prototype.capability="transport";a.prototype.required=[];return a}(v);this.RPCInterface=N=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);a.prototype.capability="rpc";a.prototype.parent=P;a.prototype.required=["factory","fulfill"];
a.prototype.factory=function(){};a.prototype.fulfill=function(){};return a}(P);this.NativeXHR=Y=function(g){function a(b,a){var c=this;this.xhr=b;this.request=a;this.open=function(b,a,h){return c.xhr.open(b,a,h)};this.get_header=function(b){return c.headers[b]};this.set_header=function(b,a){return c.headers[b]=a};this.send=function(b){var a,h,e,g;g=c.headers;for(a in g)e=g[a],c.xhr.setRequestHeader(a,e);e=c.events;for(h in e)a=e[h],c.xhr[h]=a;return c.xhr.send(b)};return this}k(a,g);a.prototype.xhr=
null;a.prototype.request=null;a.prototype.headers={};a.prototype.events={};return a}(y);this.RPCPromise=Z=function(g){function a(b,a){this.expected=b;this.directive=a;return this}k(a,g);a.prototype.expected=null;a.prototype.directive=null;a.prototype.fulfilled=!1;a.prototype.value=function(b,a){if("constructed"!==directive.status){if("pending"===directive.status){for(;"pending"===directive.status;);return directive.response}return this.directive.response}return this.directive.request.fulfill()};return a}(y);
this.ServiceLayerDriver=z=function(g){function a(b){var e=this;this.internal={status_codes:{errors:[400,401,403,404,405,406,500,501,502,503,504,505],success:[200,201,202,203,204,205,303,304,301,302,307,308]},endpoint:function(b){}};this.rpc={factory:function(b){return new Y(new XMLHttpRequest,b)},fulfill:function(a,d,f){var h,l,g,n;a.open(d.context.http_method,d.endpoint(b.rpc.state.config.jsonrpc),d.context.async);n=_.extend({"Content-Type":d.context.content_type},b.rpc.state.config.headers,d.context.headers);
for(l in n)g=n[l],a.set_header(l,g);h=function(b,a,c){var d;try{null==a.target.response||!_.is_string(a.target.response)||0>a.target.response.length||(d={response:{type:"GenericResponse",content:JSON.parse(a.target.response)},platform:{engine:"canteen/python"},status:b,id:c.envelope.id})}catch(h){d=a.target.response}return _.in_array(e.internal.status_codes.errors,a.target.status)?f("failure",d):f(d.status,d)};a.events.onload=function(a){return h("success",a,d)};a.events.onerror=a.events.onabort=
a.events.timeout=function(a){return h("failure",a,d)};return a.send(JSON.stringify(d.payload()))}};return a.__super__.constructor.call(this,b)}k(a,g);a.prototype.name="apptools";a.prototype["native"]=!0;a.prototype["interface"]=[N];return a}(z);this.RPCContext=I=function(g){function a(a){null==a&&(a={});_.extend(this,this.defaults,a)}k(a,g);a.prototype.model={url:String(),async:Boolean(),defer:Boolean(),headers:{},cacheable:Boolean(),http_method:String(),crossdomain:Boolean(),content_type:String(),
ifmodified:Boolean(),base_uri:String()};a.prototype.defaults={async:!0,defer:!1,headers:{},cacheable:!1,http_method:"POST",crossdomain:!1,content_type:"application/json",ifmodified:!1};return a}(p);this.RPCEnvelope=M=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);return a}(p);this.RequestEnvelope=ha=function(g){function a(a){_.extend(this,a)}k(a,g);a.prototype.model={id:Number(),opts:{},agent:{}};return a}(M);this.ResponseEnvelope=function(g){function a(b){a.__super__.constructor.call(this,
_.extend(this,b))}k(a,g);a.prototype.model={id:Number(),flags:{},platform:{}};return a}(M);this.RPC=p=function(g){function a(){this.state=Q(this.state,this);return this.state("constructed")}k(a,g);a.prototype.model={ttl:Number(),context:I,envelope:M};a.prototype.expired=function(){return!0};a.prototype.state=function(a){null==this.flags&&(this.flags={});this.flags.state=a;return this};return a}(p);this.RPCRequest=aa=function(g){function a(b){this.payload=Q(this.payload,this);this.fingerprint=Q(this.fingerprint,
this);a.__super__.constructor.call(this,_.extend(this,b))}k(a,g);a.prototype.states=["constructed","pending","fulfilled"];a.prototype.model={state:String(),params:{},method:String(),service:String()};a.prototype.fulfill=function(a){null==a&&(a={});return $.apptools.rpc.request.fulfill(this,a)};a.prototype.defer=function(a){return this.flags.defer=a};a.prototype.fingerprint=function(){return window.btoa(JSON.stringify([this.service,this.method,this.params,this.envelope.opts]))};a.prototype.endpoint=
function(a){var e;null==a&&(a={});return null==this.context.url?(e=null==a.host?[window.location.protocol,window.location.host].join("//"):a.host,a=null!=this.context.base_uri&&_.is_string(this.context.base_uri)?this.context.base_uri:a.base_uri,[[e.concat(a),this.service].join("/"),this.method].join(".")):this.context.url};a.prototype.payload=function(){return this.params};return a}(p);this.RPCResponse=ba=function(g){function a(b){this.inflate=Q(this.inflate,this);a.__super__.constructor.call(this,
_.extend(this,b))}k(a,g);a.prototype.states=["constructed","pending","success","failure","wait"];a.prototype.model={type:String(),status:String(),payload:{}};a.prototype.events={success:null,failure:null};a.prototype.inflate=function(a){return _.extend(this,a)};a.prototype.callbacks=function(a){this.events=a;return this};return a}(p);this.RPCErrorResponse=ga=function(g){function a(a,e){var c;this.events=a.events;if(null==(null!=(c=e.response)?c.content:void 0))throw $.apptools.dev.error("RPC","Invalid RPC error structure.",
a,e),"Invalid RPC error structure.";return this.inflate(e)}k(a,g);a.prototype.model={code:Number(),message:String()};return a}(ba);this.RPCAPI=fa=function(g){function a(a,e,c,d){var f,h,l,g;h=function(a,b,d,f){return function(d,c,h,e,l){null==d&&(d={});null==c&&(c={});null==h&&(h={});null==e&&(e={});null==l&&(l=aa);return f.rpc.request.factory({method:b,service:a,params:d||{},context:new I(_.extend(f.rpc.request.context["default"](),c)),envelope:new ha(_.extend(e,{id:f.rpc.request.provision(),opts:h||
{},agent:f.agent.fingerprint}))},l)}};if(null!=e.length&&0!==e.length)for(l=0,g=e.length;l<g;l++)f=e[l],this[f]=h(a,f,c,d);d.rpc.service.register(this,e,c);return this}k(a,g);return a}(y);this.CoreRPCAPI=U=function(g){function a(a,e){var c=this;this.state={config:{jsonrpc:{host:null,enabled:!0,base_uri:"/_rpc/v1",default_ttl:null,driver:null},channel:{token:null,script:null,enabled:!1,status:"DISCONNECTED",default_ttl:null,driver:null},sockets:{host:null,token:null,enabled:!1,status:"DISCONNECTED",
default_ttl:null,driver:null},headers:{"X-ServiceClient":["AppToolsJS/",L.version.get()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}},consumer:null,requestpool:{id:1,data:[],index:[],done:[],queue:[],error:[],expect:{},context:new I},servicepool:{name_i:{},rpc_apis:[]},history:{last_request:null,last_error:null,last_success:null,rpclog:[]},cache:{data:{},index:{}}};this.internals={validate:function(a){return a},respond:function(d,f){var h;null==f&&(f=!1);a.events.trigger("RPC_FULFILL",d);if(f&&
null!=d.request.cacheable&&!0===d.request.cacheable)try{if(null!=(h=c.state.cache.data[c.state.cache.index[d.request.fingerprint()]])&&!h.expired())return c.internals.validate(h)}catch(e){}return[c.internals.expect(d,f),c.internals.send_rpc(d)]},expect:function(d,f){d.status="pending";d.request.state("pending");d.response.state("pending");return new Z(d,c.state.requestpool.expect[c.state.requestpool.index[d.request.envelope.id]]={success:function(h){d.status="success";d.request.state("fulfilled");
d.response.state("success");c.state.requestpool.done.push(c.state.requestpool.index[d.request.envelope.id]);c.state.requestpool.queue.splice(d.queue_i,d.queue_i);delete c.state.requestpool.expect[c.state.requestpool.index[d.request.envelope.id]];f&&c.response.store(d.request,d.response);a.events.dispatch("RPC_SUCCESS",d);d.response.events.success(h.response.content,h.response.type,h)},failure:function(f){d.status="failure";d.response.state("failure");d.request.state("fulfilled");c.state.requestpool.error.push(c.state.requestpool.index[d.request.envelope.id]);
c.state.requestpool.queue.splice(d.queue_i,d.queue_i);delete c.state.requestpool.expect[c.state.requestpool.index[d.request.envelope.id]];a.events.dispatch("RPC_FAILURE",d);d.response.events.failure(f.response.content,f.response.type,f)},progress:function(f){var c;a.events.dispatch("RPC_PROGRESS",d);"function"===typeof(c=d.response.events).progress&&c.progress(d.request,f,d)}})},send_rpc:function(d){var f,h;f=(h=c.state.config.jsonrpc).driver||(h.driver=a.sys.drivers.resolve(N));if(null==f)throw a.dev.error("RPC",
"Failed to resolve RPC-compatible driver for prompted RPC directive.",f,d),"Failed to resolve RPC-compatible driver prompted RPC directive.";d.queue_i=c.state.requestpool.queue.push(c.state.requestpool.index[d.request.envelope.id])-1;d.xhr=f.rpc.factory(d.request);a.events.dispatch("RPC_FULFILL",d.request,d.xhr,d);f.rpc.fulfill(d.xhr,d.request,function(a,b){return c.response.dispatch(a,d,b)});return d},dispatch:function(d,f){if(null==c.state.requestpool.expect[c.state.requestpool.index[d.request.envelope.id]])throw a.dev.error("RPC",
"Received a request to dispatch an unexpected RPC response.",d),"Unexpected RPC response.";return c.state.requestpool.expect[c.state.requestpool.index[d.request.envelope.id]][d.response.status](d.response,d.response.type,f)}};this.request={provision:function(){return c.state.requestpool.id++},factory:function(d,f){var h,e;null==f&&(f=aa);e=new f(d);h=c.state.requestpool.index[e.envelope.id]=c.state.requestpool.data.push({request:e,response:new ba({id:e.envelope.id}),status:"constructed"})-1;a.events.dispatch("RPC_CREATE",
d,e,h);return e},fulfill:function(a,b,h){null==b&&(b={});null==h&&(h=!1);c.state.requestpool.data[c.state.requestpool.index[a.envelope.id]].response.callbacks(_.extend(c.response.callbacks["default"],b));return c.internals.respond(c.state.requestpool.data[c.state.requestpool.index[a.envelope.id]],h)},context:{"default":function(a){null!=a&&(c.state.requestpool.context=a);return c.state.requestpool.context},factory:function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===
a?a:c}(I,arguments,function(){})}}};this.response={store:function(a,b){return c},notify:function(a,b,c){},dispatch:function(a,b,h){"failure"===a&&(b.response=new ga(b.response,h));"failure"!==a&&b.response.inflate(h);return c.internals.dispatch(b,h)},callbacks:{"default":{notify:function(c){return a.dev.verbose("RPC","Encountered notify RPC with no callback.",c)},success:function(c){return a.dev.verbose("RPC","Encountered successful RPC with no callback.",c)},failure:function(c){return a.dev.verbose("RPC",
"Encountered failing RPC with no error callback.",c)}}}};this.direct={notify:function(a){},request:function(a){},response:function(a){},subscribe:function(a){},broadcast:function(a){}};this.service={factory:function(d,f,h,e){var g,n;_.is_array(d)||(d=[d]);g=0;for(n=d.length;g<n;g++)e=d[g],f=e[0],h=e[1],e=e[2],c.state.servicepool.name_i[f]=c.state.servicepool.rpc_apis.push(new fa(f,h,e,a))-1,a.api[f]=c.state.servicepool.rpc_apis[c.state.servicepool.name_i[f]];return c},register:function(c,f,h){return a.events.dispatch("CONSTRUCT_SERVICE",
c,f,h)}}}k(a,g);a.mount="rpc";a.events="RPC_CREATE RPC_FULFILL RPC_SUCCESS RPC_FAILURE RPC_COMPLETE RPC_PROGRESS".split(" ");return a}(q);this.CoreServicesAPI=W=function(g){function a(a,e){this._init=function(a){var b;null!=a.sys.state.config&&null!=(null!=(b=a.sys.state.config)?b.services:void 0)&&(null!=a.sys.state.config.services.endpoint&&(a.rpc.state.config.jsonrpc.host=a.sys.state.config.services.endpoint),null!=a.sys.state.config.services.consumer&&(a.rpc.state.config.consumer=a.sys.state.config.services.consumer),
a.events.dispatch("SERVICES_INIT",a.rpc.state.config),a.rpc.service.factory(a.sys.state.config.services.apis),a.dev.verbose("RPC","Autoloaded in-page RPC config.",a.sys.state.config.services))}}k(a,g);a.mount="api";a.events=["SERVICES_INIT","CONSTRUCT_SERVICE"];return a}(q);p=[P,N,Y,Z,z];y=0;for(z=p.length;y<z;y++)D=p[y],D.prototype.install(window,D);this.__apptools_preinit.abstract_base_classes.push(U);this.__apptools_preinit.abstract_base_classes.push(W);G=function(g){function a(){return a.__super__.constructor.apply(this,
arguments)}k(a,g);a.prototype.capability="dom";a.prototype.required=[];return a}(v);y=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);a.prototype.capability="query";a.prototype.parent=G;a.prototype.required=["element_by_id","elements_by_class","elements_by_tag","get"];a.prototype.get=function(a){};a.prototype.element_by_id=function(a){};a.prototype.elements_by_tag=function(a){};a.prototype.elements_by_class=function(a){};return a}(v);z=function(g){function a(){return a.__super__.constructor.apply(this,
arguments)}k(a,g);a.prototype.capability="render";a.prototype.parent=G;a.prototype.required=[];a.prototype.render=function(a,e){};return a}(v);v=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,g);a.prototype.capability="animation";a.prototype.parent=G;a.prototype.required=["animate"];a.prototype.animate=function(a,e){};return a}(v);V=function(g){function a(a,e){return this}k(a,g);a.mount="render";a.events=[];a["export"]="private";return a}(q);A=function(g){function a(){return a.__super__.constructor.apply(this,
arguments)}k(a,g);return a}(A);J=function(){function g(a,b,h){var e=this;null==b&&(b=!1);this.t=a.replace(c,"");this.name=null!=h?h:"template_"+g.uuid();this.temp=[];this.compile=function(){return g.prototype.compile.apply(e,arguments)};this.bind=function(){return g.prototype.bind.apply(e,arguments)};return b?b.nodeType?this.compile(this.bind(b)):this.compile(this):this}var a,b,e,c;g["export"]="public";g.idx=0;g.uuid=function(){this.idx++;return _.zero_fill(this.idx,3)};a=/\{\{\s*?(([@!>]?)(.+?))\s*?\}\}(([\s\S]+?)(\{\{\s*?:\1\s*?\}\}([\s\S]+?))?)\{\{\s*?\/(?:\1|\s*?\3\s*?)\s*?\}\}/g;
e=/\{\{\s*?([<&=%\+])\s*?(.+?)\s*?\}\}/g;b=/\{\{[\w\W.]*\}\}/;c=/[\r\n\t]*/g;g.prototype.bind=function(a){delete this.bind;this.node=a;this.env=document.createElement(this.node.tagName);return this};g.prototype.compile=function(c,f,h){var l,g,n,t,k,s=this;null==f&&(f="str");null==h&&(h="ctx");t=c.name;k=c.t;l=t+".node";console.log("[Render]","Compiling AppTools JS template:",t);g=0;n=function(c){var d,l,k,u,p,q,v;d="";l=0<g?"_val":h;q=p=(p=c.match(b))?p[0]:c;u=~c.search(b)?c.search(b):c.length;if(-1===
u||u===p.length)u=0;v=s.safe(c.slice(0,u));k=s.safe(c.slice(p.length+u));d+="'";0<v.length&&(d+=v);a.test(p)&&(q=q.replace(a,function(a,b,c,d,e,t,u,r){b=0<v.length?"';":"";a=[l,d].join(".");if(""===c||!c)b+="if(!!"+a+"){"+f+"+="+n(t),u&&(b+="}else{"+f+"+="+n(r));else if("!"===c)b+="if(!"+a+"){"+f+"+="+n(e);else if("@"===c||">"===c)d="_"+d.slice(0,2)+d.slice(d.length-2),t="_"+d,u=d+"["+t+"]",">"===c&&g++,b=b+("var "+d+"="+a+";for(var "+t+" in "+d+"){")+("@"===c?h+"._key="+t+";"+h+"._val="+u:"_val="+
u),b+=";"+f+"+=",b+=n(e),">"===c&&(b+=";_val=null;",g--);b+="}";0<k.length&&(b+=f+"+='");return b}));e.test(q)&&(q=q.replace(e,function(a,b,c){var f;"+"===b?f="this."+c+"(false,"+l+")":"&"===b?(c=parseInt(c),"NaN"!==String(c)&&(f=t+".temp["+(c-1)+"]")):f=[l,c].join(".");return"'+"+("%"===b?"Template.prototype.scrub("+f+")":"<"===b?"("+t+".temp.push("+f+"),"+f+")":f)+"+'"}));d=d+q+"'";0<k.length&&(d+="+'"+k+"'");return d};l=[t+" = (function() {",t+".name = '"+t+"';","function "+t+" ("+h+") {","var _val,n="+
l+",","dom=(typeof "+h+"=='boolean')?","(c = "+h+", "+h+" = arguments[1], c)",":true;var "+f+"=",n(k),";return ("+t+".temp=[], (dom && n != null)?","n.outerHTML="+f,":"+f+");}","return "+t+";}).call(this);","return "+t+";"].join("");l=(new Function("",l))();null!=c.env?l.node=c.node:l.bind=function(a){this.node=a;delete this.bind;return this.node};console.log("[Render]","Template compiled:",String(l).replace(/\{[\w\W.]*\}/,"{...}"));return l};g.prototype.parse=function(b,c){var h=this;null==c&&(c=
b,b=this.t);c._ctx&&(c=c._ctx);return c.tag&&c.attrs?_create_element_string(c.tag,c.attrs,c.separator):b.replace(a,function(a,b,d,e,g,k,r,q){var p;b=h.get_value(c,e);a="";if(!b)return"!"===d?h.parse(g,c):r?h.parse(q,c):"";if(!d)return h.parse(r?k:g,c);if("@"===d)for(p in b)k=b[p],b.hasOwnProperty(p)&&(a+=h.parse(g,{_key:p,_val:k}));if(">"===d)if(Array.isArray(b)||"ListField"===b.constructor.name)for(p=0,k=b.length;p<k;p++)d=b[p],a+=h.parse(g,{_ctx:d});else a+=h.parse(g,{_ctx:b});return a}).replace(e,
function(a,b,d){if("&"===b)return h.temp[parseInt(d)-1];if("+"===b)return b=(new Function("","return this."+d+";"))(),b(c);a=h.get_value(c,d);"<"===b&&h.temp.push(a);return null!=a?"%"===b?h.scrub(a):a:""})};g.prototype.unparse=function(a){var b,c,e,g,n,k,u;e={attributes:{}};g=a.parentNode;c=0;e.tagName=a.tagName;u=a.attributes;n=0;for(k=u.length;n<k;n++)b=u[n],e.attributes[b.name]=b.nodeValue;e.innerHTML=a.innerHTML;if(!g.hasAttribute("id"))for(;(c++,g=g.parentNode)&&!g.hasAttribute("id"););e.parent=
g.getAttribute("id");e.depth=c;return e};g.prototype.scrub=function(a){return(new Option(a)).innerHTML.split("'").join("&#39;").split('"').join("&quot;")};g.prototype.safe=function(a){return a.split("'").join("&#39;")};g.prototype.get_value=function(a,b){var c;for(c=b.split(".");c.length;){if(!(c[0]in a))return!1;a=a[c.shift()]}return"function"===typeof a?a():a};g.prototype.template=function(a){this.t=a;return this};g.prototype.render=function(a,b){var c,e;e="boolean"===typeof a?(c=a,a=b,c):!0;if(null==
a)return!1;c=this.parse(a);if(!e||null==this.env)return c;this.env.appendChild(this.node.cloneNode(!1));this.env.firstChild.outerHTML=c;c=this.env.firstChild;e&&this.node.parentNode.insertBefore(c,this.node);return this.node=c};return g}();window.t=J;p=function(){return function(){var g=this;this.load=function(a){console.log(g.constructor.name,"Loading templates from a remote service is currently stubbed.");return a};return this}}();q=function(g){function a(a,e){var c=this;this._state={data:[],index:{},
count:0,init:!1};this._init=function(){var a,b,h,g,m;c.outerHTML=function(a,b){var c;c=document.createElement("div");c.appendChild(this.cloneNode(!1));c.firstChild.outerHTML=a;c=c.firstChild;this.parentNode.insertBefore(c,this);b.cache.push(this.parentNode.removeChild(this));b.node=c;b.node.__defineSetter__("outerHTML",function(a){return $.apptools.templates.outerHTML.call(this,a,b)});return c};if(e.templates&&_.is_array(e.templates))for(m=e.templates,e.templates={};g=m.shift();)g=g.call(e,e),g.name.match(/system/gi)?
(g.singleton=!0,g.cache=[],g.__defineSetter__("node",function(a){this.cache.push(this.current);this.current=a;return this}),g.__defineGetter__("node",function(){return this.current})):g.bind=function(a){this.node=a;delete this.bind;return this},g.temp=[],e.templates[g.name]=g;else if(null!=_("#templates")&&null!=_("#templates").find)for(m=_.to_array(_("#templates").find("script"))||[],e.templates={};g=m.shift();)h=!!g.data("singleton"),a=g.getAttribute("id"),b=g.innerText.replace(/[\r\t\n]/g,"").replace(/\s{3,}/g,
""),b=c.make(a,b.replace(/\[\[\[\s*?([^\]]+)\s*?\]\]\]/g,function(a,b){return"{{"+b+"}}"})),b.temp=[],h?(b.singleton=!0,b.cache=[],b.__defineSetter__("node",function(a){this.cache.push(this.current);this.current=a;return this}),b.__defineGetter__("node",function(){return this.current})):b.bind=function(a){this.node=a;delete this.bind;return this},g.remove(),e.templates[a]=b;delete c._init;c._state.init=!0;return c};this.register=function(a,b){var e;if(null!=(e=c._state.index[a]))return c._state.data[e];
null==b&&_.is_raw_object(a)&&(b=a.template,a=a.name);return b?(b.uuid=e=J.uuid(),c._state.index[e]=c._state.index[a]=c._state.data.push(b)-1,c._state.count++,b):!1};this.make=this.create=function(d,f){var e;if(null!=c._state.index[d])return!1;e=new J(f,!1,d);a.dev.log("Render","Registering template:",d,e);return c.register(d,e)};this.get=function(a){var b;return null!=(b=c._state.index[a])?c._state.data[b]:!1};return this}k(a,g);a.mount="templates";a.events=[];a["export"]="private";return a}(q);this.__apptools_preinit.abstract_base_classes.push(y,
z,v,A,J,p,q,V);this.__apptools_preinit.abstract_feature_interfaces.push(G,y,z,v);this.__apptools_preinit.deferred_core_modules.push({module:q});L=function(){function g(a){var b,e,c,d,f=this;b={transport:{rpc:{host:null,enabled:!0,base_uri:"/_api/rpc"},sockets:{host:null,enabled:!1,endpoint:"/_api/realtime"}},devtools:{debug:!0,strict:!1}};this.lib={};this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED","PLATFORM_READY"],state:{core:[],config:{},
status:"NOT_READY",flags:["base","beta"],preinit:{},modules:{},classes:{},drivers:{},interfaces:{},integrations:[],add_flag:function(a){return f.sys.state.flags.push(a)},consider_preinit:function(b){var c,d,e,g;if(null!=b.abstract_base_classes)for(g=b.abstract_base_classes,d=0,e=g.length;d<e;d++)if(c=g[d],f.sys.state.classes[c.name]=c,null!=c["package"]&&null!=f.sys.state.modules[c["package"]]&&(f.sys.state.modules[c["package"]].classes[c.name]=c),null==c["export"]||"private"!==c["export"])a[c.name]=
c;if(null!=b.deferred_library_integrations)for(g=b.deferred_library_integrations,d=0,e=g.length;d<e;d++)c=g[d],f.sys.libraries.install(c.name,c.library);if(null!=b.abstract_feature_interfaces)for(g=b.abstract_feature_interfaces,e=0,d=g.length;e<d;e++)c=g[e],f.sys.interfaces.install(c);if(null!=b.installed_drivers)for(g=b.installed_drivers,e=0,d=g.length;e<d;e++)c=g[e],f.sys.drivers.install(c);return b}},modules:{install:function(b,c,d){var e,g,k,p,r,q,s,v;null==c&&(c=null);null==d&&(d=null);b=_.is_array(b)&&
null==c&&null==d?b:[b];null!=c&&("function"===typeof c?(d=c,k=null):k=c);null!=k?(null==f[k]&&(f[k]={}),k=f[k],p=!0):(k=f,p=!1);c=[];s=0;for(v=b.length;s<v;s++)e=b[s],g=null!=e.mount?e.mount:e.name.toLowerCase(),null!=e.events&&null!=f.events&&f.events.register(e.events),null==k[g]&&(r=p?new e(f,k,a):new e(f,a),k[g]=r,f.sys.state.modules[g]={module:r,classes:{}}),"function"===typeof(q=k[g])._init&&q._init(f),delete k[g]._init,null!=f.dev&&null!=f.dev.verbose&&f.dev.verbose("ModuleLoader","Installed module:",
r," at mountpoint: ",k," under the name: ",g),null!=f.events&&f.events.trigger("SYS_MODULE_LOADED",{module:r,mountpoint:k}),null!=d&&d(r),c.push(r);return c}},libraries:{install:function(a,b,c){null==c&&(c=null);f.lib[a.toLowerCase()]=b;f.sys.state.integrations.push(a.toLowerCase());f.dev.verbose("Library",a+" detected.");f.events.trigger("SYS_LIB_LOADED",{name:a,library:b});null!=c&&c(b,a);return f.lib[a.toLowerCase()]},resolve:function(a){a=a.toLowerCase();if(null!=f.lib[a.toLowerCase()])return f.lib[a.toLowerCase()]}},
interfaces:{install:function(a){a=null!=a.name&&null!=a.adapter?new a.adapter(f):new a(f);f.dev.verbose("Interface",'Installed "'+a.capability+'" interface.',a);if(null!==a.parent)if(_.is_string(a.parent)){if(null==f.sys.state.interfaces[a.parent])throw f.dev.error("System","Encountered interface with invalid parent reference.",a,a.parent),"Parent interface references must be valid and child interfaces must be loaded after their parents.";f.sys.state.interfaces[a.parent].children[a.capability]={adapter:a,
children:{}};f.events.trigger("SYS_INTERFACE_LOADED",{adapter:f.sys.state.interfaces[a.parent].children[a.capability].adapter})}else{if(null==f.sys.state.interfaces[a.parent.prototype.capability])throw f.dev.error("System","Encountered interface with invalid parent reference.",a,a.parent),"Parent interface references must be valid and child interfaces must be loaded after their parents.";f.sys.state.interfaces[a.parent.prototype.capability].children[a.capability]={adapter:a,children:{}};f.events.trigger("SYS_INTERFACE_LOADED",
{adapter:f.sys.state.interfaces[a.parent.prototype.capability].children[a.capability].adapter})}else f.sys.state.interfaces[a.capability]={adapter:a,children:{}},f.events.trigger("SYS_INTERFACE_LOADED",{adapter:f.sys.state.interfaces[a.capability].adapter});return f.sys.state.interfaces[a.capability]},resolve:function(a){var b,c,e,d;b=_.is_string(a)?String(a).toLowerCase():null!=a.prototype.parent?[a.prototype.parent.prototype.capability,a.prototype.capability].join("."):a.prototype.capability;a=
b.split(".");if(1<a.length)return null!=(null!=(c=f.sys.state.interfaces[a[0]])?c.children[a[1]]:void 0)?null!=(e=f.sys.state.interfaces[a[0]])?null!=(d=e.children[a[1]])?d.adapter:void 0:void 0:!1;if(null!=f.sys.state.interfaces[b])return null!=f.sys.state.interfaces[b]?f.sys.state.interfaces[b].adapter:!1},children:function(a){_.is_string(a)||(a=a.capability);if(a.contains("."))return!1;if(null==f.sys.state.interfaces[a])throw f.dev.error('Failed to resolve interface children for missing interface "'+
a+'".'),'Failed to resolve interface children for missing interface "'+a+'".';return f.sys.state.interfaces[a].children}},drivers:{install:function(b){var c,e,d,g,k,p,r,q,s;if(!_.is_string(b.name))throw f.dev.error("System","Encountered driver without a valid name.",b,b.name),"Drivers must have a string name attached at `driver.name`.";if(null!=f.sys.state.drivers[b.name])return f.dev.log("System",'Encountered a driver conflict installing "'+b.name+'".',"original: ",f.sys.state.drivers[b.name],"conflict: ",
b);if(null!=b.prototype["native"]&&!0===b.prototype["native"]||null!=b.prototype.library||null!=b.prototype.compatible&&!0===b.prototype.compatible()){e=function(){var a,e,d,f;d=b.prototype["interface"];f=[];a=0;for(e=d.length;a<e;a++)c=d[a],f.push(this.sys.interfaces.resolve(c));return f}.call(f);b=null!=b.prototype.library?f.sys.state.drivers[b.name]=new b(b.prototype.library,f,a):f.sys.state.drivers[b.name]=new b(f,a);s=[];g=0;for(p=e.length;g<p;g++){c=e[g];null==b[c.capability]&&f.dev.warning("System",
'Encountered driver ("'+b.name+'") with incomplete implementation for interface "'+c.capability+'".',c,b);if(null!=c.required)for(q=c.required,k=0,r=q.length;k<r;k++)if(d=q[k],null==b[c.capability][d])throw f.dev.error("System",'Encountered driver ("'+b.name+'") without required implementation method ("'+d+'") for attached interface "'+c.capability+'".',c,b),"Encountered fatal driver validation error.";s.push(c.add(b))}return s}f.dev.verbose("System",'Installed driver "'+b.name+'" was found to be incompatible with the current environment.');
return!1},resolve:function(a,b){null==b&&(b=null);return f.sys.interfaces.resolve(a).resolve(b)}},go:function(a){a.dev.log("Core","All systems go.");a.sys.state.status="READY";a.events.trigger("PLATFORM_READY",a);return f}};null!=a.config&&_.is_object(a.config)?(e=a.config,this.sys.state.config=_.extend(b,this.sys.state.config,a.config)):(e=a._cfgst||"js-config",e=document.getElementById(e),this.sys.state.config=null!=e?_.extend(b,this.sys.state.config,JSON.parse(e.innerText)):_.extend({},b,this.sys.state.config));
null!=this.sys.state.config.debug&&(F.prototype.debug=_.extend({},F.prototype.debug,this.sys.state.config.debug));this.sys.modules.install(F,function(a){return f.sys.modules.install(S,function(a){return a.register(f.sys.core_events)})});this.sys.state.preinit=a.__apptools_preinit||a.__preinit;null!=this.sys.state.preinit&&this.sys.state.consider_preinit(a.__apptools_preinit);this.sys.state.core=[T,R,U,W,V];this.sys.modules.install(this.sys.state.core);if(null!=(null!=(c=a.__apptools_preinit)?c.deferred_core_modules:
void 0))for(d=a.__apptools_preinit.deferred_core_modules,c=0,e=d.length;c<e;c++)b=d[c],null!=b["package"]?this.sys.modules.install(b.module,b["package"]):this.sys.modules.install(b.module);null!=a.__clock&&null!=this.analytics&&(this.dev.verbose("Analytics","Installing Google Analytics timings integration."),a.__clock.track=function(a){var b,c;c=a[0];b=a[1];f.analytics.track.timing(b[0],b[1],Math.floor(c)-Math.floor(b[2]),b[3],b[4]);return a});return this.sys.go(this)}g.version={major:0,minor:1,micro:5,
build:8272012,release:"BETA",get:function(){var a,b,e,c,d;c=[this.major,this.minor,this.micro];d=[];b=0;for(e=c.length;b<e;b++)a=c[b],d.push(a.toString());return[[""+d,this.build.toString()].join("-"),this.release].join(" ")}};return g}();window.AppTools=L;window.apptools=new L(window);null!=window.jQuery?$.extend({apptools:window.apptools}):null!=window.$?window.$.apptools=window.apptools:(window.$=function(g){return document.getElementById(g)}).apptools=window.apptools;null!=window.__clock&&window.__clock.clockpoint("JavaScript",
"Platform Ready",window.__clock.ts[0],"AppTools",100)}).call(this);
