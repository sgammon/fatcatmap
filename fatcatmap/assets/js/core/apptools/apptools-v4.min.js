/*! AppTools */ (function(){var w,P,x,p,T,J,v,U,B,s,V,t,W,X,Y,K,y,Z,F,L,aa,ba,ja,M,Q,ka,R,ca,da,ea,la,S,C,fa,D,ma,N,G,O,H,I,ga,E={}.hasOwnProperty,l=function(g,a){function b(){this.constructor=g}for(var d in a)E.call(a,d)&&(g[d]=a[d]);b.prototype=a.prototype;g.prototype=new b;g.__super__=a.prototype;return g},q=[].slice,na=[].indexOf||function(g){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===g)return a;return-1},A=function(g,a){return function(){return g.apply(a,arguments)}};B="installed_drivers installed_integrations abstract_base_classes abstract_feature_interfaces deferred_core_modules deferred_library_integrations".split(" ");
this.__apptools_preinit={};I=0;for(w=B.length;I<w;I++)p=B[I],this.__apptools_preinit[p]=[];p=function(){function g(a,b){null!=(null!=a?a.events:void 0)&&(this.events=a.events)}g.prototype.install=function(a,b){null!=a.apptools&&a.apptools.sys.modules.install(b);a.__apptools_preinit.deferred_core_modules.push(b);return b};return g}();window.CoreAPI=p;t=function(){function g(){}g.prototype.install=function(a,b){a.__apptools_preinit.abstract_base_classes.push(b);return b};return g}();window.CoreObject=
t;v=function(g){function a(b){this}l(a,g);a.prototype.name=null;a.prototype.library=null;a.prototype["interface"]=[];a.prototype.install=function(b,a){null!=b.apptools&&b.apptools.sys.drivers.install(a);b.__apptools_preinit.installed_drivers.push(a);return b[a.name]=a};return a}(t);window.CoreDriver=v;s=function(g){function a(b){this.drivers={adapters:{},priority:[],selected:null}}l(a,g);a.prototype.parent=null;a.prototype.required=[];a.prototype.capability=null;a.prototype["static"]=!0;a.prototype.install=
function(b,a){null!=b.apptools&&b.apptools.sys.interfaces.install(a);b.__apptools_preinit.abstract_feature_interfaces.push(a);return b[a.name]=a};a.prototype.add=function(b){this.drivers.adapters[b.name]=b;this.drivers.priority.push(b.name)};a.prototype.resolve=function(b){var a,c,e;if(null!=b)return null!=this.drivers.adapters[b]?this.drivers.adapters[b]:!1;if(this["static"]&&null!=this.drivers.selected)return this.drivers.adapters[this.drivers.selected];e=this.drivers.priority;a=0;for(c=e.length;a<
c;a++)b=e[a],null!=b.priority&&-1<b.priority?this.drivers.selected=b:null==b.priority&&(this.drivers.selected=b);return null===this.drivers.selected?!1:this.drivers.adapters[this.drivers.selected]};return a}(t);window.CoreInterface=s;B=function(g){function a(b,a,c){this.module=b;this.message=a;this.context=c}l(a,g);a.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message};a.prototype.install=function(b,a){b.__apptools_preinit.abstract_base_classes.push(a);return a};return a}(Error);
window.CoreException=B;w=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(v);x=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(B);window.AppToolsDriver=w;window.AppToolsException=x;y=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(v);w=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(s);window.Driver=y;window.Interface=
w;this.__apptools_preinit.abstract_base_classes.push(p,t,s,v,B,x,y,w);O=function(){function g(){var a=this;if(0<arguments.length)return _.get.apply(_,arguments);if(null!=window._&&null!=window._.resolve_common_ancestor)return window._;this._state={active:null,init:!1,dom_status:null,dom_ready:!1,queues:{fx:[],dom:[],deferred:[],ready:[],"default":[]},counts:{fx:0,dom:0,deferred:0,ready:0,"default":0},handlers:{"default":function(b){console.log("Default queue handler called on Util, returning queue: ",
b);return b},ready:function(b){document.readyState="complete";document.removeEventListener("DOMContentLoaded",a._state.handlers.ready,!1);a._state.dom_ready=!0;a._state.dom_status="READY";return $.apptools.events.trigger("DOM_READY")}},callbacks:{"default":null}};this.internal={queues:{create:function(b,d,c){null==c&&(c="handler");a._state.queues[b]=[];a._state.counts[b]=0;a._state[c+"s"][b]=d},remove:function(b,d){var c,e;c=a._state.handlers[b];delete a._state.handlers[b];e=a._state.queues[b];delete a._state.queues[b];
c=0<e.length?{queue:e,handler:c}:!0;return null!=d?d(c):c},add:function(b,d){null==d&&(d=b,b="default");a._state.queues[b].push(d);return a._state.counts[b]++},set_handler:function(b,d){return a._state.handlers[b]=d},set_callback:function(b,d){return a._state.callbacks[b]=d},go:function(b,d){a._state.counts[b]--;return a._state.handlers[b]&&a.is_array(d)?a._state.handlers[b](d):a._state.callbacks[b]?a._state.callbacks[b](d):a.is_function(d)?d.call(window,window):d},process:function(b){var d,c,e,f,
h;d=a._state.queues[b];a._state.queues[b]=[];c=[];e=0;for(f=d.length;e<f;e++)h=d[e],c.push(a.internal.queues.go(b,h));return c}}};this.is=function(b){return!a.in_array([!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"],b)};this.has=function(b,a){return{}.hasOwnProperty.call(b,a)};this.is_function=function(b){return"function"===a.type_of(b)};this.is_object=function(b){return"object"===a.type_of(b)};this.is_raw_object=function(b){return!b||"object"!==a.type_of(b)||
b.nodeType||a.is_window(b)||null!=b.constructor&&!b.hasOwnProperty("constructor")&&!b.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0};this.is_empty_object=function(b){for(var a in b)return!1;return!0};this.is_window=function(b){return!!b.setInterval||null!=b.self&&b.self===b||"undefined"!==typeof Window&&null!==Window&&b instanceof Window};this.is_body=function(b){return a.is_object(b)&&("[object HTMLBodyElement]"===Object.prototype.toString.call(b)||"HTMLBodyElement"===b.constructor.name)};
this.is_array=Array.isArray||function(b){return"array"===a.type_of(b)};this.is_string=function(b){return"string"===a.type_of(b)};this.attr=function(b,a,c){return a&&b?null!=c?(b.setAttribute(a,c),b):b.getAttribute(a):!1};this.data=function(b,d,c){var e,f,h,k;null==b&&(b=document);h=/^data-(\w*)$/;if(null==d&&null==c){c={};d=b.attributes;f=0;for(k=d.length;f<k;f++)e=d[f],h.test(e.name)&&(e=h.exec(e.name)[1],c[e]=a.data(b,e));return a.is_empty_object(c)?null:c}if(a.is_raw_object(d)){for(f in d)c=d[f],
a.data(b,f,c);return b}d=h.test(d)?d:"data-"+d;if(null!=c){if(!1===c)return b.removeAttribute(d);if(a.is_object(c)||a.is_array(c))c=a.JSON_to_safe(JSON.stringify(c));b.setAttribute(d,c);return b}return(b=b.getAttribute(d)||!1)?a.is_JSON(b)?JSON.parse(a.safe_to_JSON(b)):b:null};this.is_JSON=function(b){return a.is_string(b)&&/[\{\[](?:.*)[\}\]]/.test(b)};this.JSON_to_safe=function(b){return b.split('"').join("'")};this.safe_to_JSON=function(b){return b.split("'").join('"')};this.in_array=function(b,
d){return!!~a.indexOf(b,d)};this.to_array=function(b){var d;if(!b)return!1;if(a.is_array(b))return b;if(null==b.length)return[b];d=[];for(H=b.length;H--;d.unshift(b[H]));return d};this.join=function(){var b,d,c,e,f,h,k,m;c=a.to_array(arguments);e=[];f=0;for(k=c.length;f<k;f++)for(d=c[f],d=a.to_array(d),h=0,m=d.length;h<m;h++)b=d[h],e.push(b);return e};this.indexOf=function(b,d){var c,e,f;if(a.is_array(b)){if(null!=(I=Array.prototype.indexOf))return I.call(b,d);for(c=b.length;c--;)if(b[c]===d)return c;
return-1}if(a.is_object(b)){e=-1;for(c in b)if(E.call(b,c)&&(f=b[c],f===d)){e=c;break}return e}throw"indexOf() requires an iterable as the first parameter";};this.each=function(b,d,c){var e,f,h,k,m;null==c&&(c=window);if("function"!==a.type_of(d))throw"each() requires an iterator as the second parameter";h=[];if(a.is_array(b)){if(null!=(e=Array.prototype.forEach))return e.call(b,d,c);e=k=0;for(m=b.length;k<m;e=++k)f=b[e],h.push(d.call(c,f,e,b))}else if(a.is_object(b))for(e in b)f=b[e],h.push(d.call(c,
f,e,b));else throw"each() requires an iterable as the first parameter";};this.map=function(b,d,c){var e,f,h,k,m;null==c&&(c=window);if("function"!==a.type_of(d))throw"map() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(h=Array.prototype.map))return h.call(b,d,c);h=[];e=k=0;for(m=b.length;k<m;e=++k)f=b[e],h.push(d.call(c,f,e,b))}else if(a.is_object(b))for(e in h={},b)E.call(b,e)&&(f=b[e],h[e]=d.call(c,f,e,b));else throw"map() requires an iterable as the first parameter";
return h};this.filter=function(b,d,c){var e,f,h,k,m;null==c&&(c=window);if("function"!==a.type_of(d))throw"filter() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(h=Array.prototype.filter))return h.call(b,d,c);h=[];e=k=0;for(m=b.length;k<m;e=++k)f=b[e],d.call(c,f,e,b)&&h.push(f)}else if(a.is_object(b))for(e in h={},b)E.call(b,e)&&(f=b[e],d.call(c,f,e,b)&&(h[e]=f));else throw"filter() requires an iterable as the first parameter";return h};this.reject=function(b,d,c){var e,
f,h,k,m;null==c&&(c=window);if("function"!==a.type_of(d))throw"reject() requires an iterator as the second parameter";if(a.is_array(b))for(h=[],e=k=0,m=b.length;k<m;e=++k)f=b[e],d.call(c,f,e,b)||h.push(f);else if(a.is_object(b))for(e in h={},b)E.call(b,e)&&(f=b[e],d.call(c,f,e,b)||(h[e]=f));else throw"reject() requires an iterable as the first parameter";return h};this.exclude=function(b,d){var c,e,f,h;if(a.is_array(b))for(e=[],f=0,h=b.length;f<h;f++)c=b[f],~a.indexOf(d,c)||e.push(c);else if(a.is_object(b))for(c in e=
{},b)f=b[c],~a.indexOf(d,c)||(e[c]=f);else throw"exclude() requires two iterables";return e};this.all=function(b,d,c){var e,f,h,k;null==c&&(c=window);if("function"!==a.type_of(d))throw"all() requires an iterator as the second parameter";if((h=a.is_array(b))||(k=a.is_object(b))){if(h&&null!=(f=Array.prototype.every))return f.call(b,d,c);b=a.reject(b,d,c);if(h)return 0===b.length;h=[];for(e in k)h.push(!1);return h}throw"all() requires an iterable as the first parameter";};this.any=function(b,d,c){var e,
f,h,k;null==c&&(c=window);if("function"!==a.type_of(d))throw"any() requires an iterator as the second parameter";if((h=a.is_array(b))||(k=a.is_object(b))){if(h&&null!=(f=Array.prototype.some))return f.call(b,d,c);b=a.filter(b,d,c);if(h)return 0<b.length;h=[];for(e in k)h.push(!0);return h}throw"any() requires an iterable as the first parameter";};this.reduce=function(b,d,c,e){var f,h,k;null==e&&(e=window);null==c&&(c=a.is_array(b[0])?[]:0);if("function"!==a.type_of(d))throw"reduce() requires an iterator as the second parameter";
if(a.is_array(b)){if(null!=(f=Array.prototype.reduce))return f.call(b,d,c,e);f=c;h=0;for(k=b.length;h<k;h++)c=b[h],d.call(e,f,c,b);return f}throw"reduce() requires an array as the first parameter";};this.reduce_right=function(b,d,c,e){null==e&&(e=window);null==c&&(c=a.is_array(b[b.length-1])?[]:0);if("function"!==a.type_of(d))throw"reduce_right() requires an iterator as the second parameter";if(a.is_array(b))return a.reduce(b.reverse(),d,c,e);throw"reduce_right() requires an array as the first parameter";
};this.sort=function(b,d){var c;if(null!=d&&"function"!==a.type_of(d))throw"sort() requires an iterator as the second parameter";if(null!=(c=Array.prototype.sort))return c.call(b,d);console.log("non-native sort() currently stubbed.");return!1};this.defaults=function(b,d){var c,e,f,h;null==d&&(d={});if(a.is_array(b))for(c=f=0,h=b.length;f<h;c=++f)e=b[c],null==e&&(b[c]=d[c]);else if(a.is_object(b))for(c in b)e=b[c],null==e&&(b[c]=d[c]);else throw"Defaults requires an iterable as the first param.";return b};
this.first=function(b){return b.slice().shift()};this.last=function(b){return b.slice().pop()};this.purge=function(b){return a.filter(b,function(b){return a.is(b)})};this.empties=function(b){var d;d=[];_.each(b,function(b,e){a.is(b)||d.push(e)});return d};this.create_element_string=function(b,d,c,e){var f,h,k;null==c&&(c="*");b=b.toLowerCase();f="<"+b;for(h in d)k=d[h],f+=" "+h+'="'+(a.is_JSON(k)?a.JSON_to_safe(k):a.is_raw_object(k)||a.is_array(k)?a.JSON_to_safe(JSON.stringify(k)):k)+'"';null!=e&&
(f+=" "+e);f+=">";a.in_array("area base basefont br col frame hr img input link".split(" "),b)||(f+=c+"</"+b+">");return f};this.create_doc_frag=function(b){var a,c,e,f;if(1<arguments.length)for(c="",e=0,f=arguments.length;e<f;e++)a=arguments[e],c+=a;else c=b;a=document.createRange();a.selectNode(document.getElementsByTagName("div").item(0));return a.createContextualFragment(c)};this.to_doc_frag=function(b){var a;a=document.createDocumentFragment();a.appendChild(b);return a};this.add=function(b,d,
c){var e,f,h;null==c&&(c=document.body);if(null==b||!a.is_object(d))return!1;e=a.debounce(function(b){var e,f,h,d;f=[];h=0;for(d=b.length;h<d;h++)e=b[h],f.push(a.create_element_string.apply(a,e));b=a.create_doc_frag(f.join(""));return c.appendChild(b)},500,!1);h=a.is_body(c)||null==c||!(f=c.getAttribute("id"))?"dom":f;null==a._state.queues[h]?a.internal.queues.create(h,{handler:e}):null==a._state.handlers[h]&&a.internal.queues.add_handler(h,e);a.internal.queues.add(h,[b,d]);return a.internal.queues.process(h)};
this.insert=function(b,a){return b.appendChild(a)};this.remove=function(b){return b.parentNode.removeChild(b)};this.get=function(b,d){var c,e,f;null==d&&(d=document);if(null==b||"string"===!a.type_of(b))return!1;if(b.nodeType)return b;a.is_array(b)&&(b=b[0]);null!=d.setInterval&&(d=document);return a.in_array([".","#"],b[0])?(e=[b.charAt(0),Array.prototype.slice.call(b,1).join("")],c=e[0],b=e[1],"#"===c?document.getElementById(b):a.to_array(d.getElementsByClassName(b))):null!=(e=document.getElementById(b))?
e:0<(c=d.getElementsByClassName(b)).length?1<c.length?a.to_array(c):c[0]:0<(f=d.getElementsByTagName(b)).length?1<f.length?a.to_array(f):f[0]:null};this.val=function(b,a){return null!=a?(b.value?b.value=a:b.innerText=a,b):b.value?b.value:b.innerText};this.html=function(b,a){return null!=a?(b.innerHTML=a,b):b.innerHTML};this.get_offset=function(b){var a,c;for(a=c=0;a+=b.offsetLeft,c+=b.offsetTop,b=b.offsetParent;);return{left:a,top:c}};this.has_class=function(b,a){var c;return(null!=(c=b.classList)?
c.contains(a):void 0)||b.className&&RegExp("\\s*"+a+"\\s*").test(b.className)};this.add_class=function(b,a){b.classList?b.classList.add(a):b.className+=" "+a;return b};this.remove_class=function(b,a){b.classList?b.classList.remove(a):b.className.replace(RegExp("\\s*"+a+"\\s*")," ").replace(/\s{2}/g," ");return b};this.is_id=function(b){return"#"===b.charAt(0)||null!==document.getElementById(b)?!0:!1};this.is_child=function(b,d){var c;c=!1;if(a.is_array(d))c=_.reject(_.map(d,function(e){return a.is_child(b,
e)}),function(b){return b}),c=0===c.length;else for(;d=d.parentNode;)if(d===b){c=!0;break}return c};this.children=function(b){return a.to_array(b.childNodes)};this.find_parent=function(b,d){var c;return null!=(c=a.filter([a.get(d)],function(e){return a.is_child(e,b)})[0])?c:null};this.resolve_common_ancestor=function(b,d,c){var e,f,h,k;null==c&&(c=document.body);if(a.is_child(c,[b,d])){k=[];h=null;for(f=e=!0;e||f;){if(e)if(a.in_array(k,b)){h=b;break}else k.push(b),e=b!==c&&(b=b.parentNode)&&null!=
b;if(f)if(a.in_array(k,d)){h=d;break}else k.push(d),f=d!==c&&(d=d.parentNode)&&null!=d}return h}throw"Bounding node must contain both search elements";};this.bind=function(b,d,c,e){var f,h,k,m,z,g;null==e&&(e=!1);if(null==b||null==d)return!1;if(a.is_window(b)||b.nodeType||(f=a.is_array(b))&&0<b.length&&b[0].nodeType)if(a.is_raw_object(d))for(h in d)c=d[h],b.addEventListener(h,c,e);else if(f)for(a.is_array(d)||(d=[d]),k=0,z=d.length;k<z;k++)for(f=d[k],m=0,g=b.length;m<g;m++)h=b[m],h.addEventListener(f,
c,e);else return b.addEventListener(d,c,e);else return b=[b,d,c],d=b[0],c=b[1],e=b[2],a.is_function(c)?$.apptools.events.hook(d,c,e):$.apptools.events.bridge(d,c,e)};this.bridge=function(){return a.bind.apply(a,arguments)};this.trigger=function(){return $.apptools.events.trigger.apply($.apptools.events,arguments)};this.unbind=function(b,d){var c,e,f;if(null==b)return!1;if(a.is_array(b))for(e=0,f=b.length;e<f;e++)c=b[e],a.unbind(c,d);else if(a.is_array(d))for(e=0,f=d.length;e<f;e++)c=d[e],a.unbind(b,
c);else if(a.is_raw_object(b))for(e in b)c=b[e],a.unbind(e,c);else return"NodeList"===b.constructor.name?a.unbind(a.to_array(b),d):b.removeEventListener(d)};this.block=function(b,a){var c,e;null==a&&(a={});console.log("[Util]","Enforcing blocking at user request... :(");e=!1;c=null;for(b(a,function(b){c=b;return e=!0});!1===e;);return c};this.defer=function(b,d){return null==d?a.ready(b):"NaN"===parseInt(d).toString()?!1:setTimeout(b,d)};this.ready=function(b){null==a._state.dom_status&&(a._state.dom_status=
"NOT_READY",a.bind("DOM_READY",a.ready),document.addEventListener("DOMContentLoaded",a._state.handlers.ready,!1));if(null==b&&a._state.dom_ready)return a.internal.queues.process("ready");if(a.is_function(b)&&(a.internal.queues.add("ready",b),"complete"===document.readyState&&!0===a._state.dom_ready))return a.defer(a.ready,1)};this.now=function(){return+new Date};this.timestamp=function(b){null==b&&(b=new Date);return[[b.getMonth()+1,b.getDate(),b.getFullYear()].join("-"),[b.getHours(),b.getMinutes(),
b.getSeconds()].join(":")].join(" ")};this.prep_animation=function(b,d,c){return null==b?{duration:400}:null!=b&&a.is_object(b)?a.extend({},b):{complete:c||!c&&d||a.is_function(b)&&b,duration:b,easing:c&&d||d&&!is_function(d)}};this.throttle=function(b,d,c){var e,f;null==c&&(c=!1);f=null;e=0;return function(){var h,k,m,z;h=a.to_array(arguments);m=a.now()-e;k=function(){z();return f=null};z=function(){e=a.now();return b.apply(window,h)};c&&!f&&z();f&&clearTimeout(f);return!c&&m>=d?z():f=setTimeout(c?
k:z,c?d:d-m)}};this.debounce=function(b,a,c){null==a&&(a=200);null==c&&(c=!1);return this.throttle(b,a,c)};this.currency=function(b){var a,c,e,f,h,k,m;c=(f=String(b).split("").reverse()).length;e=[];h=function(b,a){return e.unshift((0===(a+1)%3&&1<c-a?",":a===c-1?"$":"")+b)};a=k=0;for(m=f.length;k<m;a=++k)b=f[a],h(b,a);return e.join("")};this.extend=function(){var b,d,c,e,f,h,k,m,z,g;m=arguments[0]||{};c=1;h=!1;"boolean"===a.type_of(m)&&(h=m,m=arguments[1]||{},c++);a.is_object(m)||a.is_function(m)||
(m={});c=Array.prototype.slice.call(arguments,c);z=0;for(g=c.length;z<g;z++)for(k in d=c[z],d)e=d[k],m!==e&&(f=m[k],h&&null!=e&&(a.is_raw_object(e)||(b=a.is_array(e)))?(b?(b=!1,f=f&&(a.is_array(f)?f:[])):f=f&&(a.is_raw_object(f)?f:{}),m[k]=a.extend(h,f,e)):null!=e&&(m[k]=e));return m};this["extends"]=function(b,a){var c,e;c={}.hasOwnProperty;for(e in a)c.call(a,e)&&(b[e]=a[e]);return b};this.to_hex=function(b){var d,c;if(b.match(/^\#?[0-9a-fA-F]{6}|[0-9a-fA-F]{3}$/i))return b.charAt(0==="#")?b:"#"+
b;if(b.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i)){if(d=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],3===d.length)return c=a.zero_fill(d[0].toString(16,2)),b=a.zero_fill(d[1].toString(16,2)),d=a.zero_fill(d[2].toString(16,2)),"#"+c+b+d}else return!1};this.to_rgb=function(b){var a,c;return b.match(/^rgb\s*\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)\s*$/)?b:b.match(/^\#?([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})$/i)?(a=[parseInt(RegExp.$1,
16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],c=a[0].toString(10),b=a[1].toString(10),a=a[2].toString(10),"rgb("+c+","+b+","+a+")"):!1};this.strip_script=function(b){return b.match(/^javascript:(\w\W.)/)?(b=RegExp.$1,console.log("Script stripped from link: ",b),"javascript:void(0)"):b};this.type_of=function(b){return{}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.wrap=function(){var b,d,c,e;c=1;d=arguments[0];e=!1;"boolean"===a["typeof"](d)&&(e=d,d=arguments[1],c+=1);b=Array.prototype.slice.call(arguments,
c);return e?function(a){b.unshift(a);return d.apply(this,b)}:function(){return d.apply(this,b)}};this.zero_fill=function(b,a){null==a&&(a=8);return(Array(a).join("0")+b).slice(-a)};this.uuid=function(a){return a?(a=String(a),btoa(a+"-"+(+new Date).toString(16))):btoa((+new Date).toString(16))};this.resolve_uuid=function(a,d){var c,e,f;c=atob(a);e=c.split("-");1<e.length?(f=e[0],c=parseInt(e[1],16)):(f="",c=parseInt(c,16));return"prefix"===d?f:"timestamp"===d?c:"date"===d?Date(c):{prefix:f,timestamp:c}};
this.resolve_date=function(b){return a.resolve_uuid(b,"date")};this.resolve_prefix=function(b){return a.resolve_uuid(b,"prefix")};this.resolve_timestamp=function(b){return a.resolve_uuid(b,"timestamp")};this.init=function(){var b,d;b={find:function(a){return _.get(a,this)},getOffset:function(){return _.get_offset(this)},hasClass:function(a){return _.has_class(this,a)},addClass:function(a){return _.add_class(this,a)},removeClass:function(a){return _.remove_class(this,a)},isChild:function(a){return _.is_child(a,
this)},isParent:function(a){return _.is_child(this,a)},children:function(){return _.children(this)},resolveAncestor:function(a,b){return _.resolve_common_ancestor(this,a,b)},bind:function(a,b,f){return _.bind(this,a,b,f)},unbind:function(a,b,f){return _.unbind(this,a,b,f)},append:function(a){return _.append(this,a)},remove:function(){return _.remove(this)},val:function(a){return _.val(this,a)},html:function(){return _.html(this)},fadeIn:function(){return HTMLElement.prototype.fadeInJacked.apply(this,
arguments)},fadeOut:function(){return HTMLElement.prototype.fadeOutJacked.apply(this,arguments)},attr:function(a,b){return _.attr.call(_,this,a,b)},data:function(a,b){return _.data.call(_,this,a,b)}};a.extend(Element.prototype,b);null!=HTMLElement.prototype&&a.extend(HTMLElement.prototype,b);String.prototype.isJSON=function(){return _.is_JSON(this)};document.ready=function(){return _.ready.apply(_,arguments)};a._state.init=!0;delete a._init;delete a.constructor;d=function(){if(0<arguments.length)return d.get.apply(d,
arguments)};a.extend(d,a);return d}}g.mount="util";g.events=["DOM_READY"];return g}();window.Util=O;window._=(new O).init();null!=window.jQuery?$.extend({_:window._}):window.$=window._;J=function(g){function a(b,d){var c,e,f,h=this;e=function(){var a;a=1<=arguments.length?q.call(arguments,0):[];return console.log.apply(console,a)};c=function(){var a;a=1<=arguments.length?q.call(arguments,0):[];return console.error.apply(console,a)};f=function(){var a;a=1<=arguments.length?q.call(arguments,0):[];return console.warn.apply(console,
a)};this.eventlog=function(){var b,e,c,f;c=arguments[0];e=arguments[1];b=3<=arguments.length?q.call(arguments,2):[];a.prototype.debug.eventlog&&("bridge"!==(f=c.toLowerCase())&&"register"!==f&&"hook"!==f||!0===a.prototype.debug.verbose)&&h.log.apply(h,[["Events",c].join(":"),e].concat(q.call(b)))};this.log=function(){var b,c,f;f=arguments[0];c=arguments[1];b=3<=arguments.length?q.call(arguments,2):[];null==b&&(b="{no context}");!0===a.prototype.debug.logging&&e.apply(null,["["+f+"] INFO: "+c].concat(q.call(b)))};
this.warning=this.warn=function(){var b,e,c;c=arguments[0];e=arguments[1];b=3<=arguments.length?q.call(arguments,2):[];null==b&&(b="{no context}");!0===a.prototype.debug.logging&&f.apply(null,["["+c+"] WARNING: "+e].concat(q.call(b)))};this.error=function(){var b,e,f;f=arguments[0];e=arguments[1];b=3<=arguments.length?q.call(arguments,2):[];!0===a.prototype.debug.logging&&c.apply(null,["["+f+"] ERROR: "+e].concat(q.call(b)))};this.verbose=function(){var b,c,f;f=arguments[0];c=arguments[1];b=3<=arguments.length?
q.call(arguments,2):[];!0===a.prototype.debug.verbose&&e.apply(null,["["+f+"] DEBUG: "+c].concat(q.call(b)))};this.exception=this.critical=function(){var a,b,c,f;f=arguments[0];c=arguments[1];b=arguments[2];a=4<=arguments.length?q.call(arguments,3):[];null==b&&(b=d.AppToolsException);e("A critical error or unhandled exception occurred.");e.apply(null,["["+f+"] CRITICAL: "+c].concat(q.call(a)));throw new b(f,c,a);};!0===b.sys.state.config.devtools.debug&&(a.prototype.debug.logging=!0,a.prototype.debug.verbose=
!0,null!=b.sys.state.config.devtools.strict&&(a.prototype.debug.strict=b.sys.state.config.devtools.strict))}l(a,g);a.prototype.debug={strict:!1,logging:!0,eventlog:!1,verbose:!0,serverside:!1};a.mount="dev";a.events=[];return a}(p);this.__apptools_preinit.abstract_base_classes.push(J);(function(g){function a(a,d){this.source=a;this.message=d}l(a,g);a.prototype.toString=function(){return"["+this.source+"] ModelException: "+this.message};return a})(Error);V=function(g){function a(){var a=this;this._state=
{init:!1};this.put=function(d){return _.block(a.put_async,d)};this.get=function(d,c){return _.block(a.get_async,d,c)};this["delete"]=function(d,c){return _.block(a.delete_async,d,c)};this.put_async=function(d){null==d&&(d=function(a){return a});return apptools.storage.put(a.constructor.prototype.name,d)};this.get_async=function(d,c){null==c&&(c=function(a){return a});return apptools.storage.get(a.key,a.constructor.prototype.name,c)};this.delete_async=function(d){null==d&&(d=function(a){return a});
return apptools.storage["delete"](a.key,a.constructor.prototype.name,d)};this.all=function(a){if(null!=a&&null!=O&&O.is_function(a))throw"all() currently in active development, sorry.";if(null!=a)throw"Provided callback isn't a function. Whoops.";throw"all() requires a callback.";};this.register=function(){return apptools.dev.verbose("CoreModelAPI","register() currently in active development, sorry.")};this._init=function(){this._state.init=!0;return this}}l(a,g);a.mount="model";a.events=[];return a}(p);
x=function(){function g(a){var b,d,c,e,f,h,k=this;if(_.is_raw_object(a)&&1===arguments.length)for(d in a)b=a[d],this[d]=b;else this.key=a;h=g.prototype;c=function(a){return k.prototype[a]=function(){return g.prototype[a].apply(k,arguments)}};e=0;for(f=h.length;e<f;e++)b=h[e],c(b);if(null!=this.constructor.mount&&(b=this[this.constructor.mount],null!=b))for(d in e=b.constructor.prototype.model,e)c=e[d],"ListField"!==c.constructor.name&&function(a,b){k.__defineGetter__(b,function(){return a[b]});return k.__defineSetter__(b,
function(){})}(b,d);null!=(d=this.constructor.prototype.template||this.constructor.template)&&(this.template=new window.t(d));return this}g.prototype.validate=function(a,b,d){var c,e,f,h;null==b&&(b=this.constructor.prototype.model);null==d&&(d=!0);d?(f=[],c=function(a,e){var c,h,d,g,r;if(null!=(c=b[a])&&null!=e===(null!=c))if("function"===typeof c){if(c=new c,!c.validate(e))return f.push({k:e})}else{if("ListField"===c.constructor.name){h=new c[0];r=[];d=0;for(g=e.length;d<g;d++)if(c=e[d],!h.validate(c)){f.push({k:e});
break}return r}if(e.constructor.name!==c.constructor.name)return f.push({k:e})}else return f.push({k:e})}):(f={},c=function(a,e){var c,h,d,g,r;if(null!=(r=b[a])&&null!=e===(null!=r)){if("function"===typeof r)return f[a]=(new r).from_message(e);if("ListField"===r.constructor.name){h=new Z;d=0;for(g=e.length;d<g;d++)c=e[d],h.push((new r[0]).from_message(c));return f[a]=h}if(e.constructor.name===r.constructor.name)return f[a]=e}});for(e in a)E.call(a,e)&&(h=a[e],c(e,h));return d?0===f.length:f};g.prototype.from_message=
function(a,b){var d,c,e;null==a&&(a={});null==b&&(b=!1);e=this.validate(a);d=this.validate(a,null,!1);if(b&&!e)console.log("Strict from_message() failed. Returning unmodified object.",this);else if(_.is_empty_object(d))console.log("No modelsafe properties found. Returning unmodified object.",this);else for(c in d)e=d[c],this[c]=e;return this};g.prototype.to_message=function(a){var b,d,c,e,f,h;b={};for(d in this)if(E.call(this,d)&&(c=this[d],"function"!==typeof c&&null!=this.constructor.prototype.model[d]))if("ListField"===
c.constructor.name){h=[];e=0;for(f=c.length;e<f;e++)a=c[e],h.push(a.to_message());b[d]=h}else b[d]=c;return b};return g}();v=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.model={key:String()};return a}(x);Z=function(g){function a(){var b,d=this;a.__super__.constructor.call(this);if(0<arguments.length)return b=new a,b.push(arguments[0]),b;this.pick=function(a,b){var f,h,d,m;if("NaN"!==parseInt(a).toString())if(null!=b)if(f=a-b,0<f)d=this.slice(0,b),
f=d.join(this.slice(b).pick(f));else{m=-f;d=this.slice(0,a);for(h=this.slice(a);0>f;)h.pick(m),f++;f=d.join(h)}else h=this.slice(0,a),f=this.slice(a+1),f=this.slice(0,0).push(this[a]).join(h).join(f);else{if(~(f=_.indexOf(this,a)))return this.pick(f);f=_.to_array(this);f.unshift(a)}this.empty();return this.join(f)};this.join=function(a){var b,f,h,d,m,g;if(null!=a&&(_.is_array(a)||(a.constructor.name=this.constructor.name))){b=0;for(h=a.length;b<h;b++)f=a[b],this.push(f);return this}d="";h=this.length;
b=m=0;for(g=this.length;m<g;b=++m)f=this[b],b===h-1&&(d+=f.toString()),d+=f.toString()+a;return d};this.slice=function(a,b){var f;null==a&&(a=0);null==b&&(b=this.length);for(f=[];a<b;)f.push(this[a]),a++;return(new this.constructor).join(f)};this.push=function(a){this[this.length]=a;this.length++;return this};this.empty=function(){this.length=0;return this};this.keys=function(){var a,b,f,h;b=[];f=0;for(h=this.length;f<h;f++)a=this[f],null!=a&&null!=a.key&&b.push(a.key);return _.purge(b)};this.order=
function(b,e){var f;null==e&&(e=!1);f=(new a).join(this);this.empty();this.length=b.length;_.map(f,function(a,f,d){return this[_.indexOf(b)]=e?a[e]:a},this);return this};this.promote=function(a){a="NaN"!==parseInt(a).toString()?a:_.indexOf(d.keys(),a);return d.pick(a,a-1)};this.demote=function(a){a="NaN"!==parseInt(a).toString()?a:_.indexOf(d.keys(),a);return d.pick(a,a+1)};this.remove=function(a){var b;b="NaN"!==parseInt(a).toString()?a:_.indexOf(d.keys(),a);a=d.slice();a=a.slice(0,b).join(a.slice(b+
1));d.empty();return d.join(a)};return this}l(a,g);return a}(Array);this.__apptools_preinit.abstract_base_classes.push(V,x,v,Z);U=function(g){function a(a,d){var c=this;this.registry=[];this.callchain={};this.history=[];this.mutators=[];this.fire=this.trigger=this.dispatch=function(){var e,f,h,d,m,g,n,u,l,r,ha;f=arguments[0];e=2<=arguments.length?q.call(arguments,1):[];a.dev.eventlog("Trigger","Triggered event.",f,e,c.callchain[f]);if(0<=na.call(c.registry,f)){m=g=0;h=[];u=[];u.push(f);ha=c.callchain[f].hooks;
l=0;for(r=ha.length;l<r;l++){d=ha[l];try{if(!0!==d.once||!0!==d.has_run)!1===d.bridge?(n=d.fn.apply(d,e),g++,c.history.push({event:f,callback:d,args:e,result:n}),d.has_run=!0):!0===d.bridge&&h.push({event:d.event,args:e,mutator:d.mutator})}catch(ia){if(m++,d=c.history.push({event:f,callback:d,args:e,error:ia}),$.apptools.dev.eventlog("exception",'Encountered unhandled exception when dispatching event hook for "'+f+'".',c.history[d-1]),$.apptools.dev.debug.eventlog&&$.apptools.dev.debug.verbose&&$.apptools.dev.error("Events",
"Unhandled event hook exception.",ia),$.apptools.dev.debug.strict)throw ia;}}n=0;for(l=h.length;n<l;n++)e=h[n],u.push(e.event),!1!==e.mutator?c.trigger.apply(c,[e.event].concat(q.call(c.mutators[e.mutator](e.args,f,e.event)))):c.trigger.apply(c,[e.event].concat(q.call(e.args)));return{events:u,executed:g,errors:m}}return!1};this.create=this.register=function(e){var f,h,d;if(!_.is_array(e)){if(_.is_string(e)&&""===e)return;e=[e]}else if(0===e.length)return;a.dev.eventlog("Register","Registered events.",
{count:e.length,events:e});h=0;for(d=e.length;h<d;h++)f=e[h],c.registry.push(f),c.callchain[f]={hooks:[]};return c};this.on=this.upon=this.when=this.hook=function(e,f,h){null==h&&(h=!1);0>na.call(c.registry,e)&&(a.dev.warning("warn","Tried to hook to unrecognized event. Registering..."),c.register(e));c.callchain[e].hooks.push({fn:f,once:h,has_run:!1,bridge:!1});a.dev.eventlog("Hook","Hook registered on event.",e);return!0};this.delegate=this.bridge=function(e,f,h){var d,m,g,n,u,l;null==h&&(h=null);
"string"===typeof f&&(f=[f]);"string"===typeof e&&(e=[e]);a.dev.eventlog("Bridge","Bridging events.",{from:e},"->",{to:f});l=[];n=0;for(u=e.length;n<u;n++)m=e[n],l.push(function(){var e,c,n;n=[];e=0;for(c=f.length;e<c;e++)g=f[e],null==this.callchain[m]&&(a.dev.warn("Events","Bridging from undefined source event:",m),this.register(m)),null!=h?(d=this.mutators.push(h),n.push(this.callchain[m].hooks.push({event:g,bridge:!0,mutator:d-1}))):n.push(this.callchain[m].hooks.push({event:g,bridge:!0,mutator:!1}));
return n}.call(c));return l}}l(a,g);a.mount="events";a.events=[];return a}(p);this.__apptools_preinit.abstract_base_classes.push(U);T=function(g){function a(a,d){var c,e,f,h,k,m=this;this.platform={};this.fingerprint={};this.capabilities={};null!=a.lib.modernizr&&(this.capabilities=a.lib.modernizr);this.capabilities.simple={};c=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,
subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:d.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},
{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];e=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];f=void 0;h=function(a){var b,e,c;e=0;for(c=a.length;e<c;e++)if(b=
a[e],null!=b.string){if(-1!==b.string.indexOf(b.subString))return f=b.versionSearch||b.identity,b.identity}else if(b.prop)return f=b.versionSearch||b.identity,b.identity};k=function(a){var b;b=a.indexOf(f);if(-1!==b)return parseFloat(a.substring(b+f.length+1))};this.fingerprint=function(){var a,b,f,g,l;a=h(c)||"unknown";l=k(navigator.userAgent)||k(navigator.appVersion)||"unknown";f=h(e)||"unknown";-1!==a.search("iPod/iPhone")||-1!==a.search("Android")?(g="mobile",b=!0):(g="desktop",b=!1);m.platform=
{os:f,type:g,vendor:navigator.vendor,product:navigator.product,browser:a,version:l,flags:{online:navigator.onLine||!0,mobile:b,webkit:/AppleWebKit\//.test(navigator.userAgent),msie:/MSIE/.test(navigator.userAgent),opera:/Opera/.test(navigator.userAgent),mozilla:/Firefox/.test(navigator.userAgent)}};m.capabilities.simple.cookies=navigator.cookieEnabled;null!=d.XMLHttpRequest&&(m.capabilities.simple.ajax=!0);return{browser:[m.platform.browser,m.platform.version].join(":"),mobile:m.platform.flags.mobile,
legacy:m.platform.flags.msie}}();return this}l(a,g);a.mount="agent";a.events=["UA_DISCOVER"];return a}(p);this.__apptools_preinit.abstract_base_classes.push(T);this.StorageDriver=v=function(g){function a(){}l(a,g);a.methods=["compatible","construct"];a["export"]="public";return a}(s);this.compatible=function(){};this.construct=function(){};this.StorageAdapter=F=function(g){function a(){}l(a,g);a.methods="get put delete clear get_async put_async delete_async clear_async".split(" ");a["export"]="public";
return a}(s);this.KeyEncoder=s=function(g){function a(){}l(a,g);a.methods=["build_key","encode_key","build_cluster","encode_cluster"];a["export"]="public";return a}(s);null!=this.__apptools_preinit?(null==this.__apptools_preinit.abstract_base_classes&&(this.__apptools_preinit.abstract_base_classes=[]),null==this.__apptools_preinit.deferred_core_modules&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]};this.__apptools_preinit.detected_storage_engines=
[];this.__apptools_preinit.abstract_base_classes.push(v,F);this.__apptools_preinit.abstract_feature_interfaces.push({adapter:v,name:"storage"});this.SimpleKeyEncoder=s=function(g){function a(){this.build_key=function(){};this.encode_key=function(){};this.build_cluster=function(){};this.encode_cluster=function(){}}l(a,g);return a}(s);ga=new s;this.LocalStorageEngine=L=function(g){function a(a){var d=this;this.name=a;this._state={runtime:{count:{total_keys:0,by_kind:[]}}};this.get_async=function(a,
b){return b.call(d.get(a))};this.put_async=function(a,b,f){d.put(a,b);return f.call(b)};this.delete_async=function(a,b){d["delete"](a);return b.call(d)};this.clear_async=function(a){d.clear();return a.call(d)};this.get=function(a){return localStorage.getItem(a)};this.put=function(a,b){null==d.get(a)&&d._state.runtime.count.total_keys++;return localStorage.setItem(a,b)};this["delete"]=function(a){d._state.runtime.count.total_keys--;return localStorage.removeItem(a)};this.clear=function(){d._state.runtime.count.total_keys=
0;return localStorage.clear()}}l(a,g);return a}(F);this.SessionStorageEngine=S=function(g){function a(a){var d=this;this.name=a;this._state={runtime:{count:{total_keys:0,by_kind:[]}}};this.get_async=function(a,b){return b.call(d.get(a))};this.put_async=function(a,b,f){d.put(a,b);return f.call(b)};this.delete_async=function(a,b){d["delete"](a);return b.call(d)};this.clear_async=function(a){d.clear();return a.call(d)};this.get=function(a){return sessionStorage.getItem(a)};this.put=function(a,b){null==
d.get(a)&&d._state.runtime.count.total_keys++;return sessionStorage.setItem(a,b)};this["delete"]=function(a){d._state.runtime.count.total_keys--;return sessionStorage.removeItem(a)};this.clear=function(){d._state.runtime.count.total_keys=0;return sessionStorage.clear()}}l(a,g);return a}(F);this.LocalStorageDriver=F=function(g){function a(){var a=this;this._state={};this.compatible=function(){return!!window.localStorage};this.construct=function(d){null==d&&(d="appstorage");return a.compatible()?new L(d):
!1}}l(a,g);return a}(v);this.SessionStorageDriver=v=function(g){function a(){var a=this;this._state={};this.compatible=function(){return!!window.sessionStorage};this.construct=function(d){null==d&&(d="appstorage");return a.compatible()?new S(d):!1}}l(a,g);return a}(v);this.__apptools_preinit.detected_storage_engines.push({name:"LocalStorage",adapter:L,driver:F,key_encoder:ga});this.__apptools_preinit.detected_storage_engines.push({name:"SessionStorage",adapter:S,driver:v,key_encoder:ga});this.__apptools_preinit.abstract_base_classes.push(s,
L,S,L,v);this.CoreStorageAPI=s=function(g){function a(a,d){var c=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},drivers:[],engines:{},encrypt:!1,integrity:!1,obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}};this.internal={check_support:function(a){},
bootstrap:function(a){},provision_collection:function(a,b,c){},add_storage_engine:function(e,f,h){var d,m;try{d=new f(a),m=new h(a)}catch(g){return!1}if(m.compatible())return c._state.config.engines[e]=m,f.adapter=c._state.config.engines[e],c._state.config.drivers.push(f),a.sys.drivers.install("storage",e,d,null!=d.enabled|1,null!=d.priority|50,function(e){return a.events.trigger("ENGINE_LOADED",{driver:e,engine:e.adapter})}),!0;a.dev.verbose("StorageEngine","Detected incompatible storage engine. Skipping.",
e,f,h);return!1}};this.get=function(){};this.list=function(){};this.count=function(){};this.put=function(){};this.query=function(){};this["delete"]=function(){};this.sync=function(){};this._init=function(){var e,f,h,d;a.events.trigger("STORAGE_INIT");a.dev.verbose("Storage","Storage support is currently under construction.");if(null!=(null!=(e=a.sys)?null!=(f=e.preinit)?f.detected_storage_engines:void 0:void 0))for(d=a.sys.preinit.detected_storage_engines,f=0,h=d.length;f<h;f++)e=d[f],c.internal.add_storage_engine(e.name,
e.driver,e.adapter);return a.events.trigger("STORAGE_READY")};a.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY");a.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}l(a,g);a.mount="storage";a.events="STORAGE_INIT ENGINE_LOADED STORAGE_READY STORAGE_ERROR STORAGE_ACTIVITY STORAGE_READ STORAGE_WRITE STORAGE_DELETE COLLECTION_SCAN COLLECTION_CREATE COLLECTION_DESTROY COLLECTION_UPDATE COLLECTION_SYNC".split(" ");
return a}(p);this.__apptools_preinit.abstract_base_classes.push(s);this.__apptools_preinit.deferred_core_modules.push({module:s});this.TransportInterface=G=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.capability="transport";a.prototype.required=[];return a}(w);this.RPCInterface=R=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.capability="rpc";a.prototype.parent=G;a.prototype.required=["factory","fulfill"];
a.prototype.factory=function(){};a.prototype.fulfill=function(){};return a}(G);this.SocketInterface=fa=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.capability="socket";a.prototype.parent=G;a.prototype.required=["factory","open","send","close","message"];a.prototype.open=function(){};a.prototype.send=function(){};a.prototype.close=function(){};a.prototype.factory=function(){};a.prototype.message=function(){};return a}(G);this.NativeXHR=ba=function(g){function a(a,
d){var c=this;this.xhr=a;this.request=d;this.open=function(a,b,h){return c.xhr.open(a,b,h)};this.get_header=function(a){return c.headers[a]};this.set_header=function(a,b){return c.headers[a]=b};this.send=function(a){var b,h,d,m;m=c.headers;for(b in m)d=m[b],c.xhr.setRequestHeader(b,d);d=c.events;for(h in d)b=d[h],c.xhr[h]=b;return c.xhr.send(a)};return this}l(a,g);a.prototype.xhr=null;a.prototype.request=null;a.prototype.headers={};a.prototype.events={};return a}(t);this.SocketState=D=function(g){function a(){return a.__super__.constructor.apply(this,
arguments)}l(a,g);return a}(t);this.SocketCommands=C=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(t);this.NativeSocket=aa=function(g){function a(a,d,c){var e,f,h,k,m=this;this.config=a;this.events=null!=d?d:{};this.socket=null!=c?c:WebSocket;this.transmit=A(this.transmit,this);this.get_header=A(this.get_header,this);this.set_header=A(this.set_header,this);this.serialize=A(this.serialize,this);this.send=A(this.send,this);this.close=A(this.close,this);
this.open=A(this.open,this);e=function(a){m.internal.state(D.OPEN);if(null!=m.events.open)return m.events.open(a,m.socket)};f=function(a){m.internal.state(D.ERROR);if(null!=m.events.error)return m.events.error(a,m.socket)};h=function(a){if(null!=m.events.message)return m.events.message(a.data,a,m.socket)};k=function(a){m.internal.state(D.CLOSED);if(null!=m.events.close)return m.events.close(a,m.socket)};this.internal={bind:function(){m.socket.onopen=e;m.socket.onclose=k;m.socket.onmessage=h;m.socket.onerror=
f;return m},send:function(){var a,b;a=1<=arguments.length?q.call(arguments,0):[];return(b=m.socket).send.apply(b,a)},state:function(a){return m.state=a}}}l(a,g);a.prototype.id=0;a.prototype.uuid=null;a.prototype.name=null;a.prototype.host=null;a.prototype.state=D.CLOSED;a.prototype.config={};a.prototype.events={};a.prototype.socket=null;a.prototype.request=null;a.prototype.protocols=[];a.prototype.protocols=[];a.prototype.add_protocol=function(a){var d,c,e,f;f=this.protocols;c=0;for(e=f.length;c<
e;c++)if(d=f[c],d.name===a.name)return $.apptools.dev.warning("fcm:socket","Re-registered protocol.",a),this;this.protocols.unshift(a);return this};a.prototype.list_protocols=function(){return this.protocols};a.prototype.remove_protocols=function(a){var d,c,e,f,h;h=this.protocols;d=e=0;for(f=h.length;e<f&&(c=h[d],c.name!==a);d=++e);delete this.protocols[d];return this};a.prototype.open=function(a){var d;null==a&&(a=null);if(null!=a||this.config.host||null!=this.config.endpoint)return null!=a?this.socket=
new this.socket(a,function(){var a,b,f,h;f=this.protocols;h=[];a=0;for(b=f.length;a<b;a++)d=f[a],h.push(d.name);return h}.call(this)):null!=this.config.endpoint?this.socket=new this.socket(this.config.endpoint,function(){var a,b,f,h;f=this.protocols;h=[];a=0;for(b=f.length;a<b;a++)d=f[a],h.push(d.name);return h}.call(this)):(a=null!=this.config.secure?this.config.secure?"wss":"ws":"ws",this.socket=new this.socket([a,this.config.host].join("://"),function(){var a,b,f,h;f=this.protocols;h=[];a=0;for(b=
f.length;a<b;a++)d=f[a],h.push(d.name);return h}.call(this))),this.internal.bind(),this;throw"Must provide a host or socket URL.";};a.prototype.establish=a.prototype.open;a.prototype.close=function(a){null==a&&(a=!0);return a?this.send(C.CLOSE):this.socket.close()};a.prototype.destroy=a.prototype.open;a.prototype.send=function(a,d){null==d&&(d=null);return"number"===typeof a?this.transmit(this.serialize(a,d)):null==d?this.transmit(a):this.transmit(this.serialize(C[a],d))};a.prototype.serialize=function(a,
d){var c,e,f,h,k;null==d&&(d=null);_.is_array(a)||(a=[a]);_.is_array(d)||(d=[d]);e=[];f=h=0;for(k=a.length;h<k;f=++h)switch(c=a[f],c){case C.PING:e.push(0);break;case C.PONG:e.push(1);break;case C.INIT:e.push(this.identify());break;case C.REQUEST:e.push(d[f].payload());break;default:e.push(d[f])}return e};a.prototype.set_header=function(a,d){this.config.headers[a]=d;return this};a.prototype.get_header=function(a){return null!=this.config.headers[a]?this.config.headers[a]:!1};a.prototype.transmit=
function(a){a={id:this.id++,headers:{},request:a};this.payload.headers=_.extend({},this.payload.headers,this.config.headers);return this.internal.send(JSON.stringify(a))};return a}(t);this.SocketVocabulary=ma=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(t);this.SocketProtocol=v=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.name="APTLS_V1";a.state=D;a.commands=C;a.vocabulary=ma;a.prototype.install=function(a,
d){a.__apptools_preinit.abstract_base_classes.push(d);a.NativeSocket.prototype.add_protocol(d);return d};a.prototype.get_command=function(a){var d,c,e;e=this.commands;for(d in e)if(c=e[d],a===c)return d};a.prototype.pack=function(a,d){return this.encode(this.serialize(a,d))};a.prototype.unpack=function(a){return this.deserialize(this.decode(a))};return a}(t);this.RPCPromise=ca=function(g){function a(a,d){this.expected=a;this.directive=d;return this}l(a,g);a.prototype.expected=null;a.prototype.directive=
null;a.prototype.fulfilled=!1;a.prototype.value=function(a,d){if("constructed"!==directive.status){if("pending"===directive.status){for(;"pending"===directive.status;);return directive.response}return this.directive.response}return this.directive.request.fulfill()};return a}(t);this.ServiceLayerDriver=s=function(g){function a(b){var d=this;this.internal={status_codes:{errors:[400,401,403,404,405,406,500,501,502,503,504,505],success:[200,201,202,203,204,205,303,304,301,302,307,308]},endpoint:function(a){}};
this.rpc={factory:function(a){return new ba(new XMLHttpRequest,a)},fulfill:function(a,e,f){var h,k,m,g;a.open(e.context.http_method,e.endpoint(b.rpc.state.config.jsonrpc),e.context.async);g=_.extend({"Content-Type":e.context.content_type},b.rpc.state.config.headers,e.context.headers);for(k in g)m=g[k],a.set_header(k,m);h=function(a,b,e){var c;try{null==b.target.response||!_.is_string(b.target.response)||0>b.target.response.length||(c={response:{type:"GenericResponse",content:JSON.parse(b.target.response)},
platform:{engine:"canteen/python"},status:a,id:e.envelope.id})}catch(h){c=b.target.response}return _.in_array(d.internal.status_codes.errors,b.target.status)?f("failure",c):f(c.status,c)};a.events.onload=function(a){return h("success",a,e)};a.events.onerror=a.events.onabort=a.events.timeout=function(a){return h("failure",a,e)};return a.send(JSON.stringify(e.payload()))}};return a.__super__.constructor.call(this,b)}l(a,g);a.prototype.name="apptools";a.prototype["native"]=!0;a.prototype["interface"]=
[R];return a}(y);this.RealtimeDriver=function(g){function a(a){var d=this;this.internal={impl:aa,state:D,config:a.sys.state.config.transport.sockets};this.rpc={factory:function(a){return d.internal.acquire(a)},fulfill:function(a,b,f){return d.rpc.factory()},open:function(){},send:function(){},close:function(){},message:function(){}}}l(a,g);a.prototype.name="apptools";a.prototype["native"]=!0;a.prototype["interface"]=[fa];return a}(y);this.RPCContext=M=function(g){function a(a){null==a&&(a={});_.extend(this,
this.defaults,a)}l(a,g);a.prototype.model={url:String(),async:Boolean(),defer:Boolean(),headers:{},cacheable:Boolean(),http_method:String(),crossdomain:Boolean(),content_type:String(),ifmodified:Boolean(),base_uri:String()};a.prototype.defaults={async:!0,defer:!1,headers:{},cacheable:!1,http_method:"POST",crossdomain:!1,content_type:"application/json",ifmodified:!1};return a}(x);this.RPCEnvelope=Q=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(x);this.RequestEnvelope=
la=function(g){function a(a){_.extend(this,a)}l(a,g);a.prototype.model={id:Number(),opts:{},agent:{}};return a}(Q);this.ResponseEnvelope=function(g){function a(b){a.__super__.constructor.call(this,_.extend(this,b))}l(a,g);a.prototype.model={id:Number(),flags:{},platform:{}};return a}(Q);this.RPC=y=function(g){function a(){this.state=A(this.state,this);return this.state("constructed")}l(a,g);a.prototype.model={ttl:Number(),context:M,envelope:Q};a.prototype.expired=function(){return!0};a.prototype.state=
function(a){null==this.flags&&(this.flags={});this.flags.state=a;return this};return a}(x);this.RPCRequest=da=function(g){function a(b){this.payload=A(this.payload,this);this.fingerprint=A(this.fingerprint,this);a.__super__.constructor.call(this,_.extend(this,b))}l(a,g);a.prototype.states=["constructed","pending","fulfilled"];a.prototype.model={state:String(),params:{},method:String(),service:String()};a.prototype.fulfill=function(a){null==a&&(a={});return $.apptools.rpc.request.fulfill(this,a)};
a.prototype.defer=function(a){return this.flags.defer=a};a.prototype.fingerprint=function(){return window.btoa(JSON.stringify([this.service,this.method,this.params,this.envelope.opts]))};a.prototype.endpoint=function(a){var d;null==a&&(a={});return null==this.context.url?(d=null==a.host?[window.location.protocol,window.location.host].join("//"):a.host,a=null!=this.context.base_uri&&_.is_string(this.context.base_uri)?this.context.base_uri:a.base_uri,[[d.concat(a),this.service].join("/"),this.method].join(".")):
this.context.url};a.prototype.payload=function(){return this.params};return a}(y);this.RPCResponse=ea=function(g){function a(b){this.inflate=A(this.inflate,this);a.__super__.constructor.call(this,_.extend(this,b))}l(a,g);a.prototype.states=["constructed","pending","success","failure","wait"];a.prototype.model={type:String(),status:String(),payload:{}};a.prototype.events={success:null,failure:null};a.prototype.inflate=function(a){return _.extend(this,a)};a.prototype.callbacks=function(a){this.events=
a;return this};return a}(y);this.RPCErrorResponse=ka=function(g){function a(a,d){var c;this.events=a.events;if(null==(null!=(c=d.response)?c.content:void 0))throw $.apptools.dev.error("RPC","Invalid RPC error structure.",a,d),"Invalid RPC error structure.";return this.inflate(d)}l(a,g);a.prototype.model={code:Number(),message:String()};return a}(ea);this.RPCAPI=ja=function(g){function a(a,d,c,e){var f,h,k,m;h=function(a,b,e,f){return function(e,c,h,d,k){null==e&&(e={});null==c&&(c={});null==h&&(h=
{});null==d&&(d={});null==k&&(k=da);return f.rpc.request.factory({method:b,service:a,params:e||{},context:new M(_.extend(f.rpc.request.context["default"](),c)),envelope:new la(_.extend(d,{id:f.rpc.request.provision(),opts:h||{},agent:f.agent.fingerprint}))},k)}};if(null!=d.length&&0!==d.length)for(k=0,m=d.length;k<m;k++)f=d[k],this[f]=h(a,f,c,e);e.rpc.service.register(this,d,c);return this}l(a,g);return a}(t);this.CoreRPCAPI=W=function(g){function a(a,d){var c=this;this.state={config:{jsonrpc:{host:null,
enabled:!0,base_uri:"/_rpc/v1",default_ttl:null,driver:null},channel:{token:null,script:null,enabled:!1,status:"DISCONNECTED",default_ttl:null,driver:null},sockets:{host:null,token:null,enabled:!1,status:"DISCONNECTED",default_ttl:null,driver:null},headers:{"X-ServiceClient":["AppToolsJS/",P.version.get()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}},consumer:null,requestpool:{id:1,data:[],index:[],done:[],queue:[],error:[],expect:{},context:new M},servicepool:{name_i:{},rpc_apis:[]},history:{last_request:null,
last_error:null,last_success:null,rpclog:[]},cache:{data:{},index:{}}};this.internals={validate:function(a){return a},respond:function(e,f){var h;null==f&&(f=!1);a.events.trigger("RPC_FULFILL",e);if(f&&null!=e.request.cacheable&&!0===e.request.cacheable)try{if(null!=(h=c.state.cache.data[c.state.cache.index[e.request.fingerprint()]])&&!h.expired())return c.internals.validate(h)}catch(d){}return[c.internals.expect(e,f),c.internals.send_rpc(e)]},expect:function(e,f){e.status="pending";e.request.state("pending");
e.response.state("pending");return new ca(e,c.state.requestpool.expect[c.state.requestpool.index[e.request.envelope.id]]={success:function(h){e.status="success";e.request.state("fulfilled");e.response.state("success");c.state.requestpool.done.push(c.state.requestpool.index[e.request.envelope.id]);c.state.requestpool.queue.splice(e.queue_i,e.queue_i);delete c.state.requestpool.expect[c.state.requestpool.index[e.request.envelope.id]];f&&c.response.store(e.request,e.response);a.events.dispatch("RPC_SUCCESS",
e);e.response.events.success(h.response.content,h.response.type,h)},failure:function(f){e.status="failure";e.response.state("failure");e.request.state("fulfilled");c.state.requestpool.error.push(c.state.requestpool.index[e.request.envelope.id]);c.state.requestpool.queue.splice(e.queue_i,e.queue_i);delete c.state.requestpool.expect[c.state.requestpool.index[e.request.envelope.id]];a.events.dispatch("RPC_FAILURE",e);e.response.events.failure(f.response.content,f.response.type,f)},progress:function(f){var c;
a.events.dispatch("RPC_PROGRESS",e);"function"===typeof(c=e.response.events).progress&&c.progress(e.request,f,e)}})},send_rpc:function(e){var f,h;f=(h=c.state.config.jsonrpc).driver||(h.driver=a.sys.drivers.resolve(R));if(null==f)throw a.dev.error("RPC","Failed to resolve RPC-compatible driver for prompted RPC directive.",f,e),"Failed to resolve RPC-compatible driver prompted RPC directive.";e.queue_i=c.state.requestpool.queue.push(c.state.requestpool.index[e.request.envelope.id])-1;e.xhr=f.rpc.factory(e.request);
a.events.dispatch("RPC_FULFILL",e.request,e.xhr,e);f.rpc.fulfill(e.xhr,e.request,function(a,b){return c.response.dispatch(a,e,b)});return e},dispatch:function(e,f){if(null==c.state.requestpool.expect[c.state.requestpool.index[e.request.envelope.id]])throw a.dev.error("RPC","Received a request to dispatch an unexpected RPC response.",e),"Unexpected RPC response.";return c.state.requestpool.expect[c.state.requestpool.index[e.request.envelope.id]][e.response.status](e.response,e.response.type,f)}};this.request=
{provision:function(){return c.state.requestpool.id++},factory:function(e,f){var h,d;null==f&&(f=da);d=new f(e);h=c.state.requestpool.index[d.envelope.id]=c.state.requestpool.data.push({request:d,response:new ea({id:d.envelope.id}),status:"constructed"})-1;a.events.dispatch("RPC_CREATE",e,d,h);return d},fulfill:function(a,b,h){null==b&&(b={});null==h&&(h=!1);c.state.requestpool.data[c.state.requestpool.index[a.envelope.id]].response.callbacks(_.extend(c.response.callbacks["default"],b));return c.internals.respond(c.state.requestpool.data[c.state.requestpool.index[a.envelope.id]],
h)},context:{"default":function(a){null!=a&&(c.state.requestpool.context=a);return c.state.requestpool.context},factory:function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(M,arguments,function(){})}}};this.response={store:function(a,b){return c},notify:function(a,b,c){},dispatch:function(a,b,d){"failure"===a&&(b.response=new ka(b.response,d));"failure"!==a&&b.response.inflate(d);return c.internals.dispatch(b,d)},callbacks:{"default":{notify:function(e){return a.dev.verbose("RPC",
"Encountered notify RPC with no callback.",e)},success:function(e){return a.dev.verbose("RPC","Encountered successful RPC with no callback.",e)},failure:function(e){return a.dev.verbose("RPC","Encountered failing RPC with no error callback.",e)}}}};this.direct={notify:function(a){},request:function(a){},response:function(a){},subscribe:function(a){},broadcast:function(a){}};this.service={factory:function(e,f,d,k){var m,g;_.is_array(e)||(e=[e]);m=0;for(g=e.length;m<g;m++)k=e[m],f=k[0],d=k[1],k=k[2],
c.state.servicepool.name_i[f]=c.state.servicepool.rpc_apis.push(new ja(f,d,k,a))-1,a.api[f]=c.state.servicepool.rpc_apis[c.state.servicepool.name_i[f]];return c},register:function(e,f,c){return a.events.dispatch("CONSTRUCT_SERVICE",e,f,c)}}}l(a,g);a.mount="rpc";a.events="RPC_CREATE RPC_FULFILL RPC_SUCCESS RPC_FAILURE RPC_COMPLETE RPC_PROGRESS".split(" ");return a}(p);this.CoreServicesAPI=Y=function(g){function a(a,d){this._init=function(a){var b;null!=a.sys.state.config&&null!=(null!=(b=a.sys.state.config)?
b.services:void 0)&&(null!=a.sys.state.config.services.endpoint&&(a.rpc.state.config.jsonrpc.host=a.sys.state.config.services.endpoint),null!=a.sys.state.config.services.consumer&&(a.rpc.state.config.consumer=a.sys.state.config.services.consumer),a.events.dispatch("SERVICES_INIT",a.rpc.state.config),a.rpc.service.factory(a.sys.state.config.services.apis),a.dev.verbose("RPC","Autoloaded in-page RPC config.",a.sys.state.config.services))}}l(a,g);a.mount="api";a.events=["SERVICES_INIT","CONSTRUCT_SERVICE"];
return a}(p);x=[G,R,fa,aa,v,ba,ca,s];t=0;for(y=x.length;t<y;t++)H=x[t],H.prototype.install(window,H);this.__apptools_preinit.abstract_base_classes.push(W);this.__apptools_preinit.abstract_base_classes.push(Y);K=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.capability="dom";a.prototype.required=[];return a}(w);t=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.capability="query";a.prototype.parent=K;
a.prototype.required=["element_by_id","elements_by_class","elements_by_tag","get"];a.prototype.get=function(a){};a.prototype.element_by_id=function(a){};a.prototype.elements_by_tag=function(a){};a.prototype.elements_by_class=function(a){};return a}(w);y=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);a.prototype.capability="render";a.prototype.parent=K;a.prototype.required=[];a.prototype.render=function(a,d){};return a}(w);w=function(g){function a(){return a.__super__.constructor.apply(this,
arguments)}l(a,g);a.prototype.capability="animation";a.prototype.parent=K;a.prototype.required=["animate"];a.prototype.animate=function(a,d){};return a}(w);X=function(g){function a(a,d){return this}l(a,g);a.mount="render";a.events=[];a["export"]="private";return a}(p);B=function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(B);N=function(){function g(a,b,d){var k=this;null==b&&(b=!1);this.t=a.replace(c,"");this.name=null!=d?d:"template_"+g.uuid();this.temp=
[];this.compile=function(){return g.prototype.compile.apply(k,arguments)};this.bind=function(){return g.prototype.bind.apply(k,arguments)};return b?b.nodeType?this.compile(this.bind(b)):this.compile(this):this}var a,b,d,c;g["export"]="public";g.idx=0;g.uuid=function(){this.idx++;return _.zero_fill(this.idx,3)};a=/\{\{\s*?(([@!>]?)(.+?))\s*?\}\}(([\s\S]+?)(\{\{\s*?:\1\s*?\}\}([\s\S]+?))?)\{\{\s*?\/(?:\1|\s*?\3\s*?)\s*?\}\}/g;d=/\{\{\s*?([<&=%\+])\s*?(.+?)\s*?\}\}/g;b=/\{\{[\w\W.]*\}\}/;c=/[\r\n\t]*/g;
g.prototype.bind=function(a){delete this.bind;this.node=a;this.env=document.createElement(this.node.tagName);return this};g.prototype.compile=function(e,f,c){var k,m,g,n,l,q=this;null==f&&(f="str");null==c&&(c="ctx");n=e.name;l=e.t;k=n+".node";console.log("[Render]","Compiling AppTools JS template:",n);m=0;g=function(e){var k,l,u,p,t,s,v;k="";l=0<m?"_val":c;s=t=(t=e.match(b))?t[0]:e;p=~e.search(b)?e.search(b):e.length;if(-1===p||p===t.length)p=0;v=q.safe(e.slice(0,p));u=q.safe(e.slice(t.length+p));
k+="'";0<v.length&&(k+=v);a.test(t)&&(s=s.replace(a,function(a,b,e,d,k,n,r,q){b=0<v.length?"';":"";a=[l,d].join(".");if(""===e||!e)b+="if(!!"+a+"){"+f+"+="+g(n),r&&(b+="}else{"+f+"+="+g(q));else if("!"===e)b+="if(!"+a+"){"+f+"+="+g(k);else if("@"===e||">"===e)d="_"+d.slice(0,2)+d.slice(d.length-2),n="_"+d,r=d+"["+n+"]",">"===e&&m++,b=b+("var "+d+"="+a+";for(var "+n+" in "+d+"){")+("@"===e?c+"._key="+n+";"+c+"._val="+r:"_val="+r),b+=";"+f+"+=",b+=g(k),">"===e&&(b+=";_val=null;",m--);b+="}";0<u.length&&
(b+=f+"+='");return b}));d.test(s)&&(s=s.replace(d,function(a,b,e){var f;"+"===b?f="this."+e+"(false,"+l+")":"&"===b?(e=parseInt(e),"NaN"!==String(e)&&(f=n+".temp["+(e-1)+"]")):f=[l,e].join(".");return"'+"+("%"===b?"Template.prototype.scrub("+f+")":"<"===b?"("+n+".temp.push("+f+"),"+f+")":f)+"+'"}));k=k+s+"'";0<u.length&&(k+="+'"+u+"'");return k};k=[n+" = (function() {",n+".name = '"+n+"';","function "+n+" ("+c+") {","var _val,n="+k+",","dom=(typeof "+c+"=='boolean')?","(c = "+c+", "+c+" = arguments[1], c)",
":true;var "+f+"=",g(l),";return ("+n+".temp=[], (dom && n != null)?","n.outerHTML="+f,":"+f+");}","return "+n+";}).call(this);","return "+n+";"].join("");k=(new Function("",k))();null!=e.env?k.node=e.node:k.bind=function(a){this.node=a;delete this.bind;return this.node};console.log("[Render]","Template compiled:",String(k).replace(/\{[\w\W.]*\}/,"{...}"));return k};g.prototype.parse=function(b,f){var c=this;null==f&&(f=b,b=this.t);f._ctx&&(f=f._ctx);return f.tag&&f.attrs?_create_element_string(f.tag,
f.attrs,f.separator):b.replace(a,function(a,b,e,d,g,l,r,q){var p;b=c.get_value(f,d);a="";if(!b)return"!"===e?c.parse(g,f):r?c.parse(q,f):"";if(!e)return c.parse(r?l:g,f);if("@"===e)for(p in b)l=b[p],b.hasOwnProperty(p)&&(a+=c.parse(g,{_key:p,_val:l}));if(">"===e)if(Array.isArray(b)||"ListField"===b.constructor.name)for(p=0,l=b.length;p<l;p++)e=b[p],a+=c.parse(g,{_ctx:e});else a+=c.parse(g,{_ctx:b});return a}).replace(d,function(a,b,e){if("&"===b)return c.temp[parseInt(e)-1];if("+"===b)return b=(new Function("",
"return this."+e+";"))(),b(f);a=c.get_value(f,e);"<"===b&&c.temp.push(a);return null!=a?"%"===b?c.scrub(a):a:""})};g.prototype.unparse=function(a){var b,c,d,g,l,n,u;d={attributes:{}};g=a.parentNode;c=0;d.tagName=a.tagName;u=a.attributes;l=0;for(n=u.length;l<n;l++)b=u[l],d.attributes[b.name]=b.nodeValue;d.innerHTML=a.innerHTML;if(!g.hasAttribute("id"))for(;(c++,g=g.parentNode)&&!g.hasAttribute("id"););d.parent=g.getAttribute("id");d.depth=c;return d};g.prototype.scrub=function(a){return(new Option(a)).innerHTML.split("'").join("&#39;").split('"').join("&quot;")};
g.prototype.safe=function(a){return a.split("'").join("&#39;")};g.prototype.get_value=function(a,b){var c;for(c=b.split(".");c.length;){if(!(c[0]in a))return!1;a=a[c.shift()]}return"function"===typeof a?a():a};g.prototype.template=function(a){this.t=a;return this};g.prototype.render=function(a,b){var c,d;d="boolean"===typeof a?(c=a,a=b,c):!0;if(null==a)return!1;c=this.parse(a);if(!d||null==this.env)return c;this.env.appendChild(this.node.cloneNode(!1));this.env.firstChild.outerHTML=c;c=this.env.firstChild;
d&&this.node.parentNode.insertBefore(c,this.node);return this.node=c};return g}();window.t=N;s=function(){return function(){var g=this;this.load=function(a){console.log(g.constructor.name,"Loading templates from a remote service is currently stubbed.");return a};return this}}();x=function(g){function a(a,d){var c=this;this._state={data:[],index:{},count:0,init:!1};this._init=function(){var a,b,h,k,g;c.outerHTML=function(a,b){var e;e=document.createElement("div");e.appendChild(this.cloneNode(!1));
e.firstChild.outerHTML=a;e=e.firstChild;this.parentNode.insertBefore(e,this);b.cache.push(this.parentNode.removeChild(this));b.node=e;b.node.__defineSetter__("outerHTML",function(a){return $.apptools.templates.outerHTML.call(this,a,b)});return e};if(d.templates&&_.is_array(d.templates))for(g=d.templates,d.templates={};k=g.shift();)k=k.call(d,d),k.name.match(/system/gi)?(k.singleton=!0,k.cache=[],k.__defineSetter__("node",function(a){this.cache.push(this.current);this.current=a;return this}),k.__defineGetter__("node",
function(){return this.current})):k.bind=function(a){this.node=a;delete this.bind;return this},k.temp=[],d.templates[k.name]=k;else if(null!=_("#templates")&&null!=_("#templates").find)for(g=_.to_array(_("#templates").find("script"))||[],d.templates={};k=g.shift();)h=!!k.data("singleton"),a=k.getAttribute("id"),b=k.innerText.replace(/[\r\t\n]/g,"").replace(/\s{3,}/g,""),b=c.make(a,b.replace(/\[\[\[\s*?([^\]]+)\s*?\]\]\]/g,function(a,b){return"{{"+b+"}}"})),b.temp=[],h?(b.singleton=!0,b.cache=[],b.__defineSetter__("node",
function(a){this.cache.push(this.current);this.current=a;return this}),b.__defineGetter__("node",function(){return this.current})):b.bind=function(a){this.node=a;delete this.bind;return this},k.remove(),d.templates[a]=b;delete c._init;c._state.init=!0;return c};this.register=function(a,b){var d;if(null!=(d=c._state.index[a]))return c._state.data[d];null==b&&_.is_raw_object(a)&&(b=a.template,a=a.name);return b?(b.uuid=d=N.uuid(),c._state.index[d]=c._state.index[a]=c._state.data.push(b)-1,c._state.count++,
b):!1};this.make=this.create=function(a,b){var d;if(null!=c._state.index[a])return!1;d=new N(b,!1,a);$.apptools.dev.log("Registering template:",a,d);return c.register(a,d)};this.get=function(a){var b;return null!=(b=c._state.index[a])?c._state.data[b]:!1};return this}l(a,g);a.mount="templates";a.events=[];a["export"]="private";return a}(p);this.__apptools_preinit.abstract_base_classes.push(t,y,w,B,N,s,x,X);this.__apptools_preinit.abstract_feature_interfaces.push(K,t,y,w);this.__apptools_preinit.deferred_core_modules.push({module:x});
p=function(g){function a(a,d){var c=this;this.state={vars:{},agent:{},trackers:{},initialized:!1,data:{events:[],social:[],timing:[],campaigns:[],transactions:[]},index:{timing:{},networks:{},campaigns:{},transactions:{}},_ga:{queue:null,tracker:null,scopes:["visitor","session","page"],bindings:{ANALYTICS_SETVAR:"_setCustomVar",ANALYTICS_TRACK_EVENT:"_trackEvent",ANALYTICS_TRACK_SOCIAL:"_trackSocial",ANALYTICS_TRACK_TIMING:"_trackTiming",ANALYTICS_TRACK_PAGEVIEW:"_trackPageview",ANALYTICS_TRACK_CAMPAIGN:"_setCampaignTrack",
ANALYTICS_TRACK_TRANSACTION:"_addTrans",ANALYTICS_TRANSACTION_NEWITEM:"_addItem",ANALYTICS_TRANSACTION_COMPLETE:"_trackTrans"}},config:{account_ids:{},linker:!0,anonymize:!1,samplerate:1,multitrack:!1}};this._init=function(a){};this.internal={initialize:function(a,b,h,k){var g,l,n,u,p,r;null==h&&(h=null);null==k&&(k=null);if(!c.state.initialized){$.apptools.dev.verbose("Analytics","Initializing Google Analytics integration.");null==h&&null!=d._gac&&(h=d._gac);c.state.config=_.extend(!0,{},c.state.config,
h);$.apptools.dev.verbose("Analytics","Merged analytics config.",h);c.internal.bind_events();h=[function(){var a,b,e,c;e=this.state.config.account_ids;c=[];a=0;for(b=e.length;a<b;a++)l=e[a],c.push(l);return c}.call(c)];c.state.initialized=h.length;c.state._ga.queue=a;c.state._ga.tracker=b;b=c.state.config.account_ids;for(n in b)if(a=b[n],c.internal.provision_tracker(n,a),!c.state.config.multitrack)break;if(null!=d.__clock&&0<d.__clock.ts.length)for(h=d.__clock.ts,a=0,b=h.length;a<b;a++)k=h[a],_.is_array(k)&&
(n=k[0],g=k[1],k=g[0],r=g[1],p=g[2],u=g[3],g=g[4],c.track.timing(k,r,Math.floor(n)-Math.floor(p),u,g))}return c},bind_events:function(a){_.bind("ANALYTICS_INIT",function(b){var d;$.apptools.dev.verbose("Analytics","Tracker initialized.",b);d=[];c.state.config.linker&&d.push(["_setAllowLinker",!0]);d.push(["_setAccount",c.state.config.account_ids[b.name]]);null!=a&&a.srcElement.hasAttribute("data-hostname")&&d.push(["_setDomainName",a.srcElement.getAttribute("data-hostname")]);null!=c.state.config.samplerate?
d.push(["_setSiteSpeedSampleRate",c.state.config.samplerate]):c.state.config.samplerate=30;c.internal.push_command(d,b.name);c.state.initialized--;0===c.state.initialized&&(c.state.initialized=!0,_.trigger("ANALYTICS_READY",c.state.trackers))});_.bind("ANALYTICS_PUSH",function(){var a,b;b=arguments[0];a=2<=arguments.length?q.call(arguments,1):[];$.apptools.dev.verbose("Analytics","Pushing tracker command.",b,a);a.unshift(b);c.internal.push_command(a)});_.bind("ANALYTICS_READY",function(a){$.apptools.dev.verbose("Analytics",
"Analytics is READY to receive events.","config:",c.state.config,"trackers:",a);return _.trigger("ANALYTICS_PUSH",["_trackPageview"])});_.bridge("ANALYTICS_SETVAR ANALYTICS_TRACK_EVENT ANALYTICS_TRACK_SOCIAL ANALYTICS_TRACK_TIMING ANALYTICS_TRACK_PAGEVIEW ANALYTICS_TRACK_CAMPAIGN ANALYTICS_TRACK_TRANSACTION ANALYTICS_TRANSACTION_NEWITEM ANALYTICS_TRANSACTION_COMPLETE".split(" "),["ANALYTICS_PUSH"],function(a,b){var e,d,g,l;e=[c.state._ga.bindings[b]];if(_.is_array(a)&&1<a.length)for(d=0,l=a.length;d<
l;d++)g=a[d],null!=g&&e.push(g);else if(_.is_object(a)&&!_.is_array(a)||1===a.length&&_.is_object(a[0]))for(d in _.is_object(a)||(a=a[0]),a)g=a[d],null!=g&&e.push(g);else e.push(a[0]);return e});_.bridge(["ANALYTICS_INIT","ANALYTICS_PUSH","ANALYTICS_READY"],["ANALYTICS_EVENT"],function(a,b){var e;e=b.split("_")[1];a.unshift(e);$.apptools.dev.verbose("Analytics",'Emitted "'+e+'".',a);return a});return c.mappings},provision_tracker:function(a,b){c.state.trackers[a]=c.state._ga.tracker._createTracker(b,
a);$.apptools.events.trigger("ANALYTICS_INIT",{name:a,tracker:c.state.trackers[a]});return c.state.trackers[a]},push_command:function(a,b){var d,k,g,l,n,u,p,r;null==b&&(b=null);$.apptools.dev.verbose("Analytics","Pushing command.",a,b);if(null===b)l=_.extend({},c.state.trackers);else if(_.is_array(b))for(k=0,n=b.length;k<n;k++)d=b[k],l[d]=c.state.trackers[d];else l={},l[b]=c.state.trackers[b];$.apptools.dev.verbose("Analytics","Resolved target trackers.",l);n=0;for(g in l){k=[];if(_.is_array(a))if(_.is_string(a[0]))a[0]=
[g,a[0]].join("."),k.push(a);else for(u=0,p=a.length;u<p;u++)d=a[u],_.is_string(d[0])&&(d[0]=[g,d[0]].join("."),k.push(d));(r=c.state._ga.queue).push.apply(r,k);$.apptools.dev.verbose("Analytics",'Pushed command to tracker "'+g+'".',k);n++}$.apptools.dev.log("Analytics","Pushed command to "+n.toString()+" trackers.",a,l);return n}};this.config={flash:function(a){null==a&&(a=null);return null!=a?c.state._ga.tracker._setDetectFlash(a):c.state._ga.tracker._getDetectFlash()},title:function(a){null==a&&
(a=null);return null!=a?c.state._ga.tracker._setDetectTitle(a):c.state._ga.tracker._getDetectTitle()},client:function(a){null==a&&(a=null);return null!=a?c.state._ga.tracker._setClientInfo(a):c.state._ga.tracker._getClientInfo()},anonymize:function(a){null==a&&(a=null);null!=a&&(c.state.config.anonymize=a);return c.state.config.anonymize},samplerate:function(a){null==a&&(a=null);null!=a&&(c.state.config.samplerate=a);return c.state.config.samplerate}};this.vars={set:function(a,b,d,k){null==k&&(k=
"page");_.is_string(k)&&(k=_.indexOf(c.state.config._ga.scopes,k));_.trigger.apply(_,["ANALYTICS_SETVAR"].concat(q.call([a,b,d,k])));return c}};this.track={event:function(a,b,d,k,g){null==d&&(d=null);null==k&&(k=null);null==g&&(g=!1);a=[a,b];null!=d&&a.push(d);null!=k&&a.push(k);!1!==g&&a.push(g);_.trigger.apply(_,["ANALYTICS_TRACK_EVENT"].concat(q.call(a)));return c},social:function(a,b,d,k){null==d&&(d=null);null==k&&(k=null);a=[a,b];null!=d&&a.push(d);null!=k&&a.push(k);_.trigger.apply(_,["ANALYTICS_TRACK_SOCIAL"].concat(q.call(a)));
return c},timing:function(a,b,d,k,g){null==g&&(g=null);a=[a,b,d,k];null!=g?a.push(g):a.push(c.state.config.samplerate);_.trigger.apply(_,["ANALYTICS_TRACK_TIMING"].concat(q.call(a)));return c},pageview:function(a){var b;null==a&&(a=null);b=[];null!=a&&b.push(a);_.trigger.apply(_,["ANALYTICS_TRACK_PAGEVIEW"].concat(q.call(b)));return c},campaign:function(a,b,c,d,g,l){},transaction:function(a,b,c,d,g,l,n,u){}};this.transactions={item:function(a,b,c,d,g,l){},complete:function(a){}}}l(a,g);a.mount="analytics";
a["export"]="private";a.events="ANALYTICS_INIT ANALYTICS_PUSH ANALYTICS_EVENT ANALYTICS_READY ANALYTICS_CONFIG ANALYTICS_SETVAR ANALYTICS_TRACK_EVENT ANALYTICS_TRACK_SOCIAL ANALYTICS_TRACK_TIMING ANALYTICS_TRACK_PAGEVIEW ANALYTICS_TRACK_CAMPAIGN ANALYTICS_TRACK_TRANSACTION ANALYTICS_TRANSACTION_NEWITEM ANALYTICS_TRANSACTION_COMPLETE".split(" ");return a}(function(g){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,g);return a}(p));window.GoogleAnalytics=p;this.__apptools_preinit.abstract_base_classes.push(p);
this.__apptools_preinit.installed_integrations.push(p);this.__apptools_preinit.deferred_core_modules.push({module:p});P=function(){function g(a){var b,d,c,e,f=this;b={transport:{rpc:{host:null,enabled:!0,base_uri:"/_api/rpc"},sockets:{host:null,enabled:!1,endpoint:"/_api/realtime"}},devtools:{debug:!0,strict:!1}};this.lib={};this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED","PLATFORM_READY"],state:{core:[],config:{},status:"NOT_READY",
flags:["base","beta"],preinit:{},modules:{},classes:{},drivers:{},interfaces:{},integrations:[],add_flag:function(a){return f.sys.state.flags.push(a)},consider_preinit:function(b){var c,d,e,g;if(null!=b.abstract_base_classes)for(g=b.abstract_base_classes,d=0,e=g.length;d<e;d++)if(c=g[d],f.sys.state.classes[c.name]=c,null!=c["package"]&&null!=f.sys.state.modules[c["package"]]&&(f.sys.state.modules[c["package"]].classes[c.name]=c),null==c["export"]||"private"!==c["export"])a[c.name]=c;if(null!=b.deferred_library_integrations)for(g=
b.deferred_library_integrations,d=0,e=g.length;d<e;d++)c=g[d],f.sys.libraries.install(c.name,c.library);if(null!=b.abstract_feature_interfaces)for(g=b.abstract_feature_interfaces,e=0,d=g.length;e<d;e++)c=g[e],f.sys.interfaces.install(c);if(null!=b.installed_drivers)for(g=b.installed_drivers,e=0,d=g.length;e<d;e++)c=g[e],f.sys.drivers.install(c);return b}},modules:{install:function(b,c,d){var e,g,l,p,r,q,s,t;null==c&&(c=null);null==d&&(d=null);b=_.is_array(b)&&null==c&&null==d?b:[b];null!=c&&("function"===
typeof c?(d=c,l=null):l=c);null!=l?(null==f[l]&&(f[l]={}),l=f[l],p=!0):(l=f,p=!1);c=[];s=0;for(t=b.length;s<t;s++)e=b[s],g=null!=e.mount?e.mount:e.name.toLowerCase(),null!=e.events&&null!=f.events&&f.events.register(e.events),null==l[g]&&(r=p?new e(f,l,a):new e(f,a),l[g]=r,f.sys.state.modules[g]={module:r,classes:{}}),"function"===typeof(q=l[g])._init&&q._init(f),delete l[g]._init,null!=f.dev&&null!=f.dev.verbose&&f.dev.verbose("ModuleLoader","Installed module:",r," at mountpoint: ",l," under the name: ",
g),null!=f.events&&f.events.trigger("SYS_MODULE_LOADED",{module:r,mountpoint:l}),null!=d&&d(r),c.push(r);return c}},libraries:{install:function(a,b,c){null==c&&(c=null);f.lib[a.toLowerCase()]=b;f.sys.state.integrations.push(a.toLowerCase());f.dev.verbose("Library",a+" detected.");f.events.trigger("SYS_LIB_LOADED",{name:a,library:b});null!=c&&c(b,a);return f.lib[a.toLowerCase()]},resolve:function(a){a=a.toLowerCase();if(null!=f.lib[a.toLowerCase()])return f.lib[a.toLowerCase()]}},interfaces:{install:function(a){a=
null!=a.name&&null!=a.adapter?new a.adapter(f):new a(f);f.dev.verbose("Interface",'Installed "'+a.capability+'" interface.',a);if(null!==a.parent)if(_.is_string(a.parent)){if(null==f.sys.state.interfaces[a.parent])throw f.dev.error("System","Encountered interface with invalid parent reference.",a,a.parent),"Parent interface references must be valid and child interfaces must be loaded after their parents.";f.sys.state.interfaces[a.parent].children[a.capability]={adapter:a,children:{}};f.events.trigger("SYS_INTERFACE_LOADED",
{adapter:f.sys.state.interfaces[a.parent].children[a.capability].adapter})}else{if(null==f.sys.state.interfaces[a.parent.prototype.capability])throw f.dev.error("System","Encountered interface with invalid parent reference.",a,a.parent),"Parent interface references must be valid and child interfaces must be loaded after their parents.";f.sys.state.interfaces[a.parent.prototype.capability].children[a.capability]={adapter:a,children:{}};f.events.trigger("SYS_INTERFACE_LOADED",{adapter:f.sys.state.interfaces[a.parent.prototype.capability].children[a.capability].adapter})}else f.sys.state.interfaces[a.capability]=
{adapter:a,children:{}},f.events.trigger("SYS_INTERFACE_LOADED",{adapter:f.sys.state.interfaces[a.capability].adapter});return f.sys.state.interfaces[a.capability]},resolve:function(a){var b,c,d,e;b=_.is_string(a)?String(a).toLowerCase():null!=a.prototype.parent?[a.prototype.parent.prototype.capability,a.prototype.capability].join("."):a.prototype.capability;a=b.split(".");if(1<a.length)return null!=(null!=(c=f.sys.state.interfaces[a[0]])?c.children[a[1]]:void 0)?null!=(d=f.sys.state.interfaces[a[0]])?
null!=(e=d.children[a[1]])?e.adapter:void 0:void 0:!1;if(null!=f.sys.state.interfaces[b])return null!=f.sys.state.interfaces[b]?f.sys.state.interfaces[b].adapter:!1},children:function(a){_.is_string(a)||(a=a.capability);if(a.contains("."))return!1;if(null==f.sys.state.interfaces[a])throw f.dev.error('Failed to resolve interface children for missing interface "'+a+'".'),'Failed to resolve interface children for missing interface "'+a+'".';return f.sys.state.interfaces[a].children}},drivers:{install:function(b){var c,
d,e,g,l,p,r,q,s;if(!_.is_string(b.name))throw f.dev.error("System","Encountered driver without a valid name.",b,b.name),"Drivers must have a string name attached at `driver.name`.";if(null!=f.sys.state.drivers[b.name])return f.dev.log("System",'Encountered a driver conflict installing "'+b.name+'".',"original: ",f.sys.state.drivers[b.name],"conflict: ",b);if(null!=b.prototype["native"]&&!0===b.prototype["native"]||null!=b.prototype.library||null!=b.prototype.compatible&&!0===b.prototype.compatible()){d=
function(){var a,d,e,f;e=b.prototype["interface"];f=[];a=0;for(d=e.length;a<d;a++)c=e[a],f.push(this.sys.interfaces.resolve(c));return f}.call(f);b=null!=b.prototype.library?f.sys.state.drivers[b.name]=new b(b.prototype.library,f,a):f.sys.state.drivers[b.name]=new b(f,a);s=[];g=0;for(p=d.length;g<p;g++){c=d[g];null==b[c.capability]&&f.dev.warning("System",'Encountered driver ("'+b.name+'") with incomplete implementation for interface "'+c.capability+'".',c,b);if(null!=c.required)for(q=c.required,
l=0,r=q.length;l<r;l++)if(e=q[l],null==b[c.capability][e])throw f.dev.error("System",'Encountered driver ("'+b.name+'") without required implementation method ("'+e+'") for attached interface "'+c.capability+'".',c,b),"Encountered fatal driver validation error.";s.push(c.add(b))}return s}f.dev.verbose("System",'Installed driver "'+b.name+'" was found to be incompatible with the current environment.');return!1},resolve:function(a,b){null==b&&(b=null);return f.sys.interfaces.resolve(a).resolve(b)}},
go:function(a){a.dev.log("Core","All systems go.");a.sys.state.status="READY";a.events.trigger("PLATFORM_READY",a);return f}};null!=a.config&&_.is_object(a.config)?(d=a.config,this.sys.state.config=_.extend(b,this.sys.state.config,a.config)):(d=a._cfgst||"js-config",d=document.getElementById(d),this.sys.state.config=null!=d?_.extend(b,this.sys.state.config,JSON.parse(d.innerText)):_.extend({},b,this.sys.state.config));null!=this.sys.state.config.debug&&(J.prototype.debug=_.extend({},J.prototype.debug,
this.sys.state.config.debug));this.sys.modules.install(J,function(a){return f.sys.modules.install(U,function(a){return a.register(f.sys.core_events)})});this.sys.state.preinit=a.__apptools_preinit||a.__preinit;null!=this.sys.state.preinit&&this.sys.state.consider_preinit(a.__apptools_preinit);this.sys.state.core=[V,T,W,Y,X];this.sys.modules.install(this.sys.state.core);if(null!=(null!=(c=a.__apptools_preinit)?c.deferred_core_modules:void 0))for(e=a.__apptools_preinit.deferred_core_modules,c=0,d=e.length;c<
d;c++)b=e[c],null!=b["package"]?this.sys.modules.install(b.module,b["package"]):this.sys.modules.install(b.module);null!=a.__clock&&null!=this.analytics&&(this.dev.verbose("Analytics","Installing Google Analytics timings integration."),a.__clock.track=function(a){var b,c;c=a[0];b=a[1];f.analytics.track.timing(b[0],b[1],Math.floor(c)-Math.floor(b[2]),b[3],b[4]);return a});return this.sys.go(this)}g.version={major:0,minor:1,micro:5,build:8272012,release:"BETA",get:function(){var a,b,d,c,e;c=[this.major,
this.minor,this.micro];e=[];b=0;for(d=c.length;b<d;b++)a=c[b],e.push(a.toString());return[[""+e,this.build.toString()].join("-"),this.release].join(" ")}};return g}();window.AppTools=P;window.apptools=new P(window);null!=window.jQuery?$.extend({apptools:window.apptools}):null!=window.$?window.$.apptools=window.apptools:(window.$=function(g){return document.getElementById(g)}).apptools=window.apptools;null!=window.__clock&&window.__clock.clockpoint("JavaScript","Platform Ready",window.__clock.ts[0],
"AppTools",100)}).call(this);
