/*! AppTools */ (function(){var C=0,I,r,u,s,M,G,x,N,y,v,O,t,P,Q,z,R,S,Y,H,J,Z,K,T,U,V,aa,D,E,F,A={}.hasOwnProperty,l=function(h,a){function b(){this.constructor=h}for(var e in a)A.call(a,e)&&(h[e]=a[e]);b.prototype=a.prototype;h.prototype=new b;h.__super__=a.prototype;return h},n=[].slice,ba=[].indexOf||function(h){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===h)return a;return-1},L=function(h,a){return function(){return h.apply(a,arguments)}};t="installed_drivers installed_integrations abstract_base_classes abstract_feature_interfaces deferred_core_modules deferred_library_integrations".split(" ");this.__apptools_preinit={};F=0;for(r=t.length;F<r;F++)s=t[F],this.__apptools_preinit[s]=[];s=function(){function h(a,b){null!=(null!=a?a.events:void 0)&&(this.events=a.events)}h.prototype.install=function(a,b){null!=a.apptools&&a.apptools.sys.modules.install(b);a.__apptools_preinit.deferred_core_modules.push(b);return b};return h}();window.CoreAPI=s;t=function(){function h(){}h.prototype.install=function(a,b){a.__apptools_preinit.abstract_base_classes.push(b);return b};return h}();window.CoreObject=t;x=function(h){function a(b){this}l(a,h);a.prototype.name=null;a.prototype.library=null;a.prototype["interface"]=[];a.prototype.install=function(b,a){null!=b.apptools&&b.apptools.sys.drivers.install(a);b.__apptools_preinit.installed_drivers.push(a);return b[a.name]=a};return a}(t);window.CoreDriver=x;v=function(h){function a(b){this.drivers={adapters:{},priority:[],selected:null}}l(a,h);a.prototype.parent=null;a.prototype.required=[];a.prototype.capability=null;a.prototype["static"]=!0;a.prototype.install=function(b,a){null!=b.apptools&&b.apptools.sys.interfaces.install(a);b.__apptools_preinit.abstract_feature_interfaces.push(a);return b[a.name]=a};a.prototype.add=function(b){this.drivers.adapters[b.name]=b;this.drivers.priority.push(b.name)};a.prototype.resolve=function(b){var a,c,f;if(null!=b)return null!=this.drivers.adapters[b]?this.drivers.adapters[b]:!1;if(this["static"]&&null!=this.drivers.selected)return this.drivers.adapters[this.drivers.selected];f=this.drivers.priority;a=0;for(c=f.length;a<c;a++)b=f[a],null!=b.priority&&-1<b.priority?this.drivers.selected=b:null==b.priority&&(this.drivers.selected=b);return null===this.drivers.selected?!1:this.drivers.adapters[this.drivers.selected]};return a}(t);window.CoreInterface=v;y=function(h){function a(b,a,c){this.module=b;this.message=a;this.context=c}l(a,h);a.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message};a.prototype.install=function(b,a){b.__apptools_preinit.abstract_base_classes.push(a);return a};return a}(Error);window.CoreException=y;r=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);return a}(x);u=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);return a}(y);window.AppToolsDriver=r;window.AppToolsException=u;r=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);return a}(x);z=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);return a}(v);window.Driver=r;window.Interface=z;this.__apptools_preinit.abstract_base_classes.push(s,t,v,x,y,u,r,z);u=function(){function h(){var a=this;if(0<arguments.length)return _.get.apply(_,arguments);if(null!=window._&&null!=window._.resolve_common_ancestor)return window._;this._state={active:null,init:!1,dom_status:null,dom_ready:!1,queues:{fx:[],dom:[],deferred:[],ready:[],"default":[]},counts:{fx:0,dom:0,deferred:0,ready:0,"default":0},handlers:{"default":function(b){console.log("Default queue handler called on Util, returning queue: ",b);return b},ready:function(b){document.readyState="complete";document.removeEventListener("DOMContentLoaded",a._state.handlers.ready,!1);a._state.dom_ready=!0;a._state.dom_status="READY";return $.apptools.events.trigger("DOM_READY")}},callbacks:{"default":null}};this.internal={queues:{create:function(b,e,c){null==c&&(c="handler");a._state.queues[b]=[];a._state.counts[b]=0;a._state[c+"s"][b]=e},remove:function(b,e){var c,f;c=a._state.handlers[b];delete a._state.handlers[b];f=a._state.queues[b];delete a._state.queues[b];c=0<f.length?{queue:f,handler:c}:!0;return null!=e?e(c):c},add:function(b,e){null==e&&(e=b,b="default");a._state.queues[b].push(e);return a._state.counts[b]++},set_handler:function(b,e){return a._state.handlers[b]=e},set_callback:function(b,e){return a._state.callbacks[b]=e},go:function(b,e){a._state.counts[b]--;return a._state.handlers[b]&&a.is_array(e)?a._state.handlers[b](e):a._state.callbacks[b]?a._state.callbacks[b](e):a.is_function(e)?e.call(window,window):e},process:function(b){var e,c,f,d,g;e=a._state.queues[b];a._state.queues[b]=[];c=[];f=0;for(d=e.length;f<d;f++)g=e[f],c.push(a.internal.queues.go(b,g));return c}}};this.isUndefined=function(b){return"undefined"==typeof b?!0:"object"==typeof b&&null==b?!0:!1};this.is=function(b){return!a.in_array([!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"],b)};this.has=function(b,a){return{}.hasOwnProperty.call(b,a)};this.is_function=function(b){return"function"===a.type_of(b)};this.is_object=function(b){return"object"===a.type_of(b)};this.is_raw_object=function(b){return!b||"object"!==a.type_of(b)||b.nodeType||a.is_window(b)||null!=b.constructor&&!b.hasOwnProperty("constructor")&&!b.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0};this.is_empty_object=function(b){for(var a in b)return!1;return!0};this.is_window=function(b){return!!b.setInterval||null!=b.self&&b.self===b||"undefined"!==typeof Window&&null!==Window&&b instanceof Window};this.is_body=function(b){return a.is_object(b)&&("[object HTMLBodyElement]"===Object.prototype.toString.call(b)||"HTMLBodyElement"===b.constructor.name)};this.is_array=Array.isArray||function(b){return"array"===a.type_of(b)};this.is_string=function(b){return"string"===a.type_of(b)};this.attr=function(b,a,c){return a&&b?null!=c?(b.setAttribute(a,c),b):b.getAttribute(a):!1};this.data=function(b,e,c){var f,d,g,k;null==b&&(b=document);g=/^data-(\w*)$/;if(null==e&&null==c){c={};e=b.attributes;d=0;for(k=e.length;d<k;d++)f=e[d],g.test(f.name)&&(f=g.exec(f.name)[1],c[f]=a.data(b,f));return a.is_empty_object(c)?null:c}if(a.is_raw_object(e)){for(d in e)c=e[d],a.data(b,d,c);return b}e=g.test(e)?e:"data-"+e;if(null!=c){if(!1===c)return b.removeAttribute(e);if(a.is_object(c)||a.is_array(c))c=a.JSON_to_safe(JSON.stringify(c));b.setAttribute(e,c);return b}return(b=b.getAttribute(e)||!1)?a.is_JSON(b)?JSON.parse(a.safe_to_JSON(b)):b:null};this.is_JSON=function(b){return a.is_string(b)&&/[\{\[](?:.*)[\}\]]/.test(b)};this.JSON_to_safe=function(b){return b.split('"').join("'")};this.safe_to_JSON=function(b){return b.split("'").join('"')};this.in_array=function(b,e){return!!~a.indexOf(b,e)};this.to_array=function(b){var e;if(!b)return!1;if(a.is_array(b))return b;if(null==b.length)return[b];e=[];for(E=b.length;E--;e.unshift(b[E]));return e};this.join=function(){var b,e,c,f,d,g,k,m;c=a.to_array(arguments);f=[];d=0;for(k=c.length;d<k;d++)for(e=c[d],e=a.to_array(e),g=0,m=e.length;g<m;g++)b=e[g],f.push(b);return f};this.indexOf=function(b,e){var c,f,d;if(a.is_array(b)){if(null!=(F=Array.prototype.indexOf))return F.call(b,e);for(c=b.length;c--;)if(b[c]===e)return c;return-1}if(a.is_object(b)){f=-1;for(c in b)if(A.call(b,c)&&(d=b[c],d===e)){f=c;break}return f}throw"indexOf() requires an iterable as the first parameter";};this.each=function(b,e,c){var f,d,g,k,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"each() requires an iterator as the second parameter";g=[];if(a.is_array(b)){if(null!=(f=Array.prototype.forEach))return f.call(b,e,c);f=k=0;for(m=b.length;k<m;f=++k)d=b[f],g.push(e.call(c,d,f,b))}else if(a.is_object(b))for(f in b)d=b[f],g.push(e.call(c,d,f,b));else throw"each() requires an iterable as the first parameter";};this.map=function(b,e,c){var f,d,g,k,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"map() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(g=Array.prototype.map))return g.call(b,e,c);g=[];f=k=0;for(m=b.length;k<m;f=++k)d=b[f],g.push(e.call(c,d,f,b))}else if(a.is_object(b))for(f in g={},b)A.call(b,f)&&(d=b[f],g[f]=e.call(c,d,f,b));else throw"map() requires an iterable as the first parameter";return g};this.filter=function(b,e,c){var f,d,g,k,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"filter() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(g=Array.prototype.filter))return g.call(b,e,c);g=[];f=k=0;for(m=b.length;k<m;f=++k)d=b[f],e.call(c,d,f,b)&&g.push(d)}else if(a.is_object(b))for(f in g={},b)A.call(b,f)&&(d=b[f],e.call(c,d,f,b)&&(g[f]=d));else throw"filter() requires an iterable as the first parameter";return g};this.reject=function(b,e,c){var f,d,g,k,m;null==c&&(c=window);if("function"!==a.type_of(e))throw"reject() requires an iterator as the second parameter";if(a.is_array(b))for(g=[],f=k=0,m=b.length;k<m;f=++k)d=b[f],e.call(c,d,f,b)||g.push(d);else if(a.is_object(b))for(f in g={},b)A.call(b,f)&&(d=b[f],e.call(c,d,f,b)||(g[f]=d));else throw"reject() requires an iterable as the first parameter";return g};this.exclude=function(b,e){var c,f,d,g;if(a.is_array(b))for(f=[],d=0,g=b.length;d<g;d++)c=b[d],~a.indexOf(e,c)||f.push(c);else if(a.is_object(b))for(c in f={},b)d=b[c],~a.indexOf(e,c)||(f[c]=d);else throw"exclude() requires two iterables";return f};this.all=function(b,e,c){var f,d,g,k;null==c&&(c=window);if("function"!==a.type_of(e))throw"all() requires an iterator as the second parameter";if((g=a.is_array(b))||(k=a.is_object(b))){if(g&&null!=(d=Array.prototype.every))return d.call(b,e,c);b=a.reject(b,e,c);if(g)return 0===b.length;g=[];for(f in k)g.push(!1);return g}throw"all() requires an iterable as the first parameter";};this.any=function(b,e,c){var f,d,g,k;null==c&&(c=window);if("function"!==a.type_of(e))throw"any() requires an iterator as the second parameter";if((g=a.is_array(b))||(k=a.is_object(b))){if(g&&null!=(d=Array.prototype.some))return d.call(b,e,c);b=a.filter(b,e,c);if(g)return 0<b.length;g=[];for(f in k)g.push(!0);return g}throw"any() requires an iterable as the first parameter";};this.reduce=function(b,e,c,f){var d,g,k;null==f&&(f=window);null==c&&(c=a.is_array(b[0])?[]:0);if("function"!==a.type_of(e))throw"reduce() requires an iterator as the second parameter";if(a.is_array(b)){if(null!=(d=Array.prototype.reduce))return d.call(b,e,c,f);d=c;g=0;for(k=b.length;g<k;g++)c=b[g],e.call(f,d,c,b);return d}throw"reduce() requires an array as the first parameter";};this.reduce_right=function(b,e,c,f){null==f&&(f=window);null==c&&(c=a.is_array(b[b.length-1])?[]:0);if("function"!==a.type_of(e))throw"reduce_right() requires an iterator as the second parameter";if(a.is_array(b))return a.reduce(b.reverse(),e,c,f);throw"reduce_right() requires an array as the first parameter";};this.sort=function(b,e){var c;if(null!=e&&"function"!==a.type_of(e))throw"sort() requires an iterator as the second parameter";if(null!=(c=Array.prototype.sort))return c.call(b,e);console.log("non-native sort() currently stubbed.");return!1};this.defaults=function(b,e){var c,f,d,g;null==e&&(e={});if(a.is_array(b))for(c=d=0,g=b.length;d<g;c=++d)f=b[c],null==f&&(b[c]=e[c]);else if(a.is_object(b))for(c in b)f=b[c],null==f&&(b[c]=e[c]);else throw"Defaults requires an iterable as the first param.";return b};this.first=function(b){return b.slice().shift()};this.last=function(b){return b.slice().pop()};this.purge=function(b){return a.filter(b,function(b){return a.is(b)})};this.empties=function(b){var e;e=[];_.each(b,function(b,f){a.is(b)||e.push(f)});return e};this.create_element_string=function(b,e,c,f){var d,g,k;null==c&&(c="*");b=b.toLowerCase();d="<"+b;for(g in e)k=e[g],d+=" "+g+'="'+(a.is_JSON(k)?a.JSON_to_safe(k):a.is_raw_object(k)||a.is_array(k)?a.JSON_to_safe(JSON.stringify(k)):k)+'"';null!=f&&(d+=" "+f);d+=">";a.in_array("area base basefont br col frame hr img input link".split(" "),b)||(d+=c+"</"+b+">");return d};this.create_doc_frag=function(b){var a,c,f,d;if(1<arguments.length)for(c="",f=0,d=arguments.length;f<d;f++)a=arguments[f],c+=a;else c=b;a=document.createRange();a.selectNode(document.getElementsByTagName("div").item(0));return a.createContextualFragment(c)};this.to_doc_frag=function(b){var a;a=document.createDocumentFragment();a.appendChild(b);return a};this.add=function(b,e,c){var f,d,g;null==c&&(c=document.body);if(null==b||!a.is_object(e))return!1;f=a.debounce(function(b){var f,d,e,g;d=[];e=0;for(g=b.length;e<g;e++)f=b[e],d.push(a.create_element_string.apply(a,f));b=a.create_doc_frag(d.join(""));return c.appendChild(b)},500,!1);g=a.is_body(c)||null==c||!(d=c.getAttribute("id"))?"dom":d;null==a._state.queues[g]?a.internal.queues.create(g,{handler:f}):null==a._state.handlers[g]&&a.internal.queues.add_handler(g,f);a.internal.queues.add(g,[b,e]);return a.internal.queues.process(g)};this.insert=function(b,a){return b.appendChild(a)};this.remove=function(b){return b.parentNode.removeChild(b)};this.get=function(b,e){var c,f,d;null==e&&(e=document);if(null==b||"string"===!a.type_of(b))return!1;if(b.nodeType)return b;a.is_array(b)&&(b=b[0]);null!=e.setInterval&&(e=document);return a.in_array([".","#"],b[0])?(f=[b.charAt(0),Array.prototype.slice.call(b,1).join("")],c=f[0],b=f[1],"#"===c?document.getElementById(b):a.to_array(e.getElementsByClassName(b))):null!=(f=document.getElementById(b))?f:0<(c=e.getElementsByClassName(b)).length?1<c.length?a.to_array(c):c[0]:0<(d=e.getElementsByTagName(b)).length?1<d.length?a.to_array(d):d[0]:null};this.val=function(b,a){return null!=a?(b.value?b.value=a:b.innerText=a,b):b.value?b.value:b.innerText};this.html=function(b,a){return null!=a?(b.innerHTML=a,b):b.innerHTML};this.get_offset=function(b){var a,c;for(a=c=0;a+=b.offsetLeft,c+=b.offsetTop,b=b.offsetParent;);return{left:a,top:c}};this.has_class=function(b,a){var c;return(null!=(c=b.classList)?c.contains(a):void 0)||b.className&&RegExp("s*"+a+"s*").test(b.className)};this.add_class=function(b,a){b.classList?b.classList.add(a):b.className+=" "+a;return b};this.remove_class=function(b,a){b.classList?b.classList.remove(a):b.className.replace(RegExp("s*"+a+"s*")," ").replace(/\s{2}/g," ");return b};this.is_id=function(b){return"#"===b.charAt(0)||null!==document.getElementById(b)?!0:!1};this.is_child=function(b,e){var c;c=!1;if(a.is_array(e))c=_.reject(_.map(e,function(c){return a.is_child(b,c)}),function(b){return b}),c=0===c.length;else for(;e=e.parentNode;)if(e===b){c=!0;break}return c};this.children=function(b){return a.to_array(b.childNodes)};this.find_parent=function(b,e){var c;return null!=(c=a.filter([a.get(e)],function(c){return a.is_child(c,b)})[0])?c:null};this.resolve_common_ancestor=function(b,e,c){var f,d,g,k;null==c&&(c=document.body);if(a.is_child(c,[b,e])){k=[];g=null;for(d=f=!0;f||d;){if(f)if(a.in_array(k,b)){g=b;break}else k.push(b),f=b!==c&&(b=b.parentNode)&&null!=b;if(d)if(a.in_array(k,e)){g=e;break}else k.push(e),d=e!==c&&(e=e.parentNode)&&null!=e}return g}throw"Bounding node must contain both search elements";};this.bind=function(b,e,c,f){var d,g,k,m,q,h;if("string"!=typeof e&&"function"==typeof b)return b.bind(e);null==f&&(f=!1);if(null==b||null==e)return!1;if(a.is_window(b)||b.nodeType||(d=a.is_array(b))&&0<b.length&&b[0].nodeType)if(a.is_raw_object(e))for(g in e)c=e[g],b.addEventListener(g,c,f);else if(d)for(a.is_array(e)||(e=[e]),k=0,q=e.length;k<q;k++)for(d=e[k],m=0,h=b.length;m<h;m++)g=b[m],g.addEventListener(d,c,f);else return b.addEventListener(e,c,f);else return b=[b,e,c],e=b[0],c=b[1],f=b[2],a.is_function(c)?$.apptools.events.hook(e,c,f):$.apptools.events.bridge(e,c,f)};this.bridge=function(){return a.bind.apply(a,arguments)};this.trigger=function(){return $.apptools.events.trigger.apply($.apptools.events,arguments)};this.unbind=function(b,e){var c,f,d;if(null==b)return!1;if(a.is_array(b))for(f=0,d=b.length;f<d;f++)c=b[f],a.unbind(c,e);else if(a.is_array(e))for(f=0,d=e.length;f<d;f++)c=e[f],a.unbind(b,c);else if(a.is_raw_object(b))for(f in b)c=b[f],a.unbind(f,c);else return"NodeList"===b.constructor.name?a.unbind(a.to_array(b),e):b.removeEventListener(e)};this.block=function(b,a){var c,f;null==a&&(a={});console.log("[Util]","Enforcing blocking at user request... :(");f=!1;c=null;for(b(a,function(b){c=b;return f=!0});!1===f;);return c};this.defer=function(b,e){return null==e?a.ready(b):"NaN"===parseInt(e).toString()?!1:setTimeout(b,e)};this.ready=function(b){null==a._state.dom_status&&(a._state.dom_status="NOT_READY",a.bind("DOM_READY",a.ready),document.addEventListener("DOMContentLoaded",a._state.handlers.ready,!1));if(null==b&&a._state.dom_ready)return a.internal.queues.process("ready");if(a.is_function(b)&&(a.internal.queues.add("ready",b),"complete"===document.readyState&&!0===a._state.dom_ready))return a.defer(a.ready,1)};this.now=function(){return+new Date};this.timestamp=function(b){null==b&&(b=new Date);return[[b.getMonth()+1,b.getDate(),b.getFullYear()].join("-"),[b.getHours(),b.getMinutes(),b.getSeconds()].join(":")].join(" ")};this.prep_animation=function(b,e,c){return null==b?{duration:400}:null!=b&&a.is_object(b)?a.extend({},b):{complete:c||!c&&e||a.is_function(b)&&b,duration:b,easing:c&&e||e&&!is_function(e)}};this.throttle=function(b,e,c){var f,d;null==c&&(c=!1);d=null;f=0;return function(){var g,k,m,q;g=a.to_array(arguments);m=a.now()-f;k=function(){q();return d=null};q=function(){f=a.now();return b.apply(window,g)};c&&!d&&q();d&&clearTimeout(d);return!c&&m>=e?q():d=setTimeout(c?k:q,c?e:e-m)}};this.debounce=function(b,a,c){null==a&&(a=200);null==c&&(c=!1);return this.throttle(b,a,c)};this.currency=function(b){var a,c,f,d,g,k,m;c=(d=String(b).split("").reverse()).length;f=[];g=function(b,a){return f.unshift((0===(a+1)%3&&1<c-a?",":a===c-1?"$":"")+b)};a=k=0;for(m=d.length;k<m;a=++k)b=d[a],g(b,a);return f.join("")};this.extend=function(){var b,e,c,f,d,g,k,m,q,h;m=arguments[0]||{};c=1;g=!1;"boolean"===a.type_of(m)&&(g=m,m=arguments[1]||{},c++);a.is_object(m)||a.is_function(m)||(m={});c=Array.prototype.slice.call(arguments,c);q=0;for(h=c.length;q<h;q++)for(k in e=c[q],e)f=e[k],m!==f&&(d=m[k],g&&null!=f&&(a.is_raw_object(f)||(b=a.is_array(f)))?(b?(b=!1,d=d&&(a.is_array(d)?d:[])):d=d&&(a.is_raw_object(d)?d:{}),m[k]=a.extend(g,d,f)):null!=f&&(m[k]=f));return m};this["extends"]=function(b,a){var c,f;c={}.hasOwnProperty;for(f in a)c.call(a,f)&&(b[f]=a[f]);return b};this.to_hex=function(b){var e,c;if(b.match(/^\#?[0-9a-fA-F]{6}|[0-9a-fA-F]{3}$/i))return b.charAt(0==="#")?b:"#"+b;if(b.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i)){if(e=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],3===e.length)return c=a.zero_fill(e[0].toString(16,2)),b=a.zero_fill(e[1].toString(16,2)),e=a.zero_fill(e[2].toString(16,2)),"#"+c+b+e}else return!1};this.to_rgb=function(b){var a,c;return b.match(/^rgb\s*\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)\s*$/)?b:b.match(/^\#?([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})$/i)?(a=[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],c=a[0].toString(10),b=a[1].toString(10),a=a[2].toString(10),"rgb("+c+","+b+","+a+")"):!1};this.strip_script=function(b){return b.match(/^javascript:(\w\W.)/)?(b=RegExp.$1,console.log("Script stripped from link: ",b),"javascript:void(0)"):b};this.type_of=function(b){return{}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.wrap=function(){var b,e,c,f;c=1;e=arguments[0];f=!1;"boolean"===a["typeof"](e)&&(f=e,e=arguments[1],c+=1);b=Array.prototype.slice.call(arguments,c);return f?function(a){b.unshift(a);return e.apply(this,b)}:function(){return e.apply(this,b)}};this.zero_fill=function(b,a){null==a&&(a=8);return(Array(a).join("0")+b).slice(-a)};this.uuid=function(b){return b?(b=String(b),btoa(b+"-"+(+new Date).toString(16))):btoa((+new Date).toString(16))};this.resolve_uuid=function(b,a){var c,f,d;c=atob(b);f=c.split("-");1<f.length?(d=f[0],c=parseInt(f[1],16)):(d="",c=parseInt(c,16));return"prefix"===a?d:"timestamp"===a?c:"date"===a?Date(c):{prefix:d,timestamp:c}};this.resolve_date=function(b){return a.resolve_uuid(b,"date")};this.resolve_prefix=function(b){return a.resolve_uuid(b,"prefix")};this.resolve_timestamp=function(b){return a.resolve_uuid(b,"timestamp")};this.init=function(){var b,e;b={find:function(b){return _.get(b,this)},getOffset:function(){return _.get_offset(this)},hasClass:function(b){return _.has_class(this,b)},addClass:function(b){return _.add_class(this,b)},removeClass:function(b){return _.remove_class(this,b)},isChild:function(b){return _.is_child(b,this)},isParent:function(b){return _.is_child(this,b)},children:function(){return _.children(this)},resolveAncestor:function(b,a){return _.resolve_common_ancestor(this,b,a)},bind:function(b,a,d){return _.bind(this,b,a,d)},unbind:function(b,a,d){return _.unbind(this,b,a,d)},append:function(b){return _.append(this,b)},remove:function(){return _.remove(this)},val:function(b){return _.val(this,b)},html:function(){return _.html(this)},fadeIn:function(){return HTMLElement.prototype.fadeInJacked.apply(this,arguments)},fadeOut:function(){return HTMLElement.prototype.fadeOutJacked.apply(this,arguments)},attr:function(b,a){return _.attr.call(_,this,b,a)},data:function(b,a){return _.data.call(_,this,b,a)}};a.extend(Element.prototype,b);null!=HTMLElement.prototype&&a.extend(HTMLElement.prototype,b);String.prototype.isJSON=function(){return _.is_JSON(this)};document.ready=function(){return _.ready.apply(_,arguments)};a._state.init=!0;delete a._init;delete a.constructor;e=function(){if(0<arguments.length)return e.get.apply(e,arguments)};a.extend(e,a);return e}}h.mount="util";h.events=["DOM_READY"];return h}();window.Util=u;window._=(new u).init();null!=window.jQuery?$.extend({_:window._}):window.$=window._;G=function(h){function a(b,e){var c,f,d,g=this;f=function(){if(C){var b;b=1<=arguments.length?n.call(arguments,0):[];return console.log.apply(console,b)}};c=function(){var b;b=1<=arguments.length?n.call(arguments,0):[];return console.error.apply(console,b)};d=function(){if(C){var b;b=1<=arguments.length?n.call(arguments,0):[];return console.warn.apply(console,b)}};this.eventlog=function(){if(C){var b,c,f,d;f=arguments[0];c=arguments[1];b=3<=arguments.length?n.call(arguments,2):[];a.prototype.debug.eventlog&&("bridge"!==(d=f.toLowerCase())&&"register"!==d&&"hook"!==d||!0===a.prototype.debug.verbose)&&g.log.apply(g,[["Events",f].join(":"),c].concat(n.call(b)))}};this.log=function(){if(C){var b,c,d;d=arguments[0];c=arguments[1];b=3<=arguments.length?n.call(arguments,2):[];null==b&&(b="{no context}");!0===a.prototype.debug.logging&&f.apply(null,["["+d+"] INFO: "+c].concat(n.call(b)))}};this.warning=this.warn=function(){if(C){var b,c,f;f=arguments[0];c=arguments[1];b=3<=arguments.length?n.call(arguments,2):[];null==b&&(b="{no context}");!0===a.prototype.debug.logging&&d.apply(null,["["+f+"] WARNING: "+c].concat(n.call(b)))}};this.error=function(){var b,f,d;d=arguments[0];f=arguments[1];b=3<=arguments.length?n.call(arguments,2):[];!0===a.prototype.debug.logging&&c.apply(null,["["+d+"] ERROR: "+f].concat(n.call(b)))};this.verbose=function(){if(C){var b,c,d;d=arguments[0];c=arguments[1];b=3<=arguments.length?n.call(arguments,2):[];!0===a.prototype.debug.verbose&&f.apply(null,["["+d+"] DEBUG: "+c].concat(n.call(b)))}};this.exception=this.critical=function(){var b,a,c,d;d=arguments[0];c=arguments[1];a=arguments[2];b=4<=arguments.length?n.call(arguments,3):[];null==a&&(a=e.AppToolsException);f("A critical error or unhandled exception occurred.");f.apply(null,["["+d+"] CRITICAL: "+c].concat(n.call(b)));throw new a(d,c,b);};!0===b.sys.state.config.devtools.debug&&(a.prototype.debug.logging=!0,a.prototype.debug.verbose=!0,null!=b.sys.state.config.devtools.strict&&(a.prototype.debug.strict=b.sys.state.config.devtools.strict))}l(a,h);a.prototype.debug={strict:!1,logging:!0,eventlog:!1,verbose:!0,serverside:!1};a.mount="dev";a.events=[];return a}(s);this.__apptools_preinit.abstract_base_classes.push(G);(function(h){function a(b,a){this.source=b;this.message=a}l(a,h);a.prototype.toString=function(){return"["+this.source+"] ModelException: "+this.message};return a})(Error);O=function(h){function a(){var b=this;this._state={init:!1};this.put=function(a){return _.block(b.put_async,a)};this.get=function(a,c){return _.block(b.get_async,a,c)};this["delete"]=function(a,c){return _.block(b.delete_async,a,c)};this.put_async=function(a){null==a&&(a=function(b){return b});return apptools.storage.put(b.constructor.prototype.name,a)};this.get_async=function(a,c){null==c&&(c=function(b){return b});return apptools.storage.get(b.key,b.constructor.prototype.name,c)};this.delete_async=function(a){null==a&&(a=function(b){return b});return apptools.storage["delete"](b.key,b.constructor.prototype.name,a)};this.all=function(b){return null};this.register=function(){return null};this._init=function(){this._state.init=!0;return this}}l(a,h);a.mount="model";a.events=[];return a}(s);u=function(){function h(a){var b,e,c,f,d,g,k=this;if(_.is_raw_object(a)&&1===arguments.length)for(e in a)b=a[e],this[e]=b;else this.key=a;g=h.prototype;c=function(b){return k.prototype[b]=function(){return h.prototype[b].apply(k,arguments)}};f=0;for(d=g.length;f<d;f++)b=g[f],c(b);if(null!=this.constructor.mount&&(b=this[this.constructor.mount],null!=b))for(e in f=b.constructor.prototype.model,f)c=f[e],"ListField"!==c.constructor.name&&function(b,a){k.__defineGetter__(a,function(){return b[a]});return k.__defineSetter__(a,function(){})}(b,e);null!=(e=this.constructor.prototype.template||this.constructor.template)&&(this.template=new window.t(e));return this}h.prototype.validate=function(a,b,e){var c,f,d,g;null==b&&(b=this.constructor.prototype.model);null==e&&(e=!0);e?(d=[],c=function(a,c){var f,g,e,h,p;if(null!=(f=b[a])&&null!=c===(null!=f))if("function"===typeof f){if(f=new f,!f.validate(c))return d.push({k:c})}else{if("ListField"===f.constructor.name){g=new f[0];p=[];e=0;for(h=c.length;e<h;e++)if(f=c[e],!g.validate(f)){d.push({k:c});break}return p}if(c.constructor.name!==f.constructor.name)return d.push({k:c})}else return d.push({k:c})}):(d={},c=function(a,c){var f,g,e,h,p;if(null!=(p=b[a])&&null!=c===(null!=p)){if("function"===typeof p)return d[a]=(new p).from_message(c);if("ListField"===p.constructor.name){g=new R;e=0;for(h=c.length;e<h;e++)f=c[e],g.push((new p[0]).from_message(f));return d[a]=g}if(c.constructor.name===p.constructor.name)return d[a]=c}});for(f in a)A.call(a,f)&&(g=a[f],c(f,g));return e?0===d.length:d};h.prototype.from_message=function(a,b){var e,c,f;null==a&&(a={});null==b&&(b=!1);f=this.validate(a);e=this.validate(a,null,!1);if(b&&!f)console.log("Strict from_message() failed. Returning unmodified object.",this);else if(_.is_empty_object(e))console.log("No modelsafe properties found. Returning unmodified object.",this);else for(c in e)f=e[c],this[c]=f;return this};h.prototype.to_message=function(a){var b,e,c,f,d,g;b={};for(e in this)if(A.call(this,e)&&(c=this[e],"function"!==typeof c&&null!=this.constructor.prototype.model[e]))if("ListField"===c.constructor.name){g=[];f=0;for(d=c.length;f<d;f++)a=c[f],g.push(a.to_message());b[e]=g}else b[e]=c;return b};return h}();x=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);a.prototype.model={key:String()};return a}(u);R=function(h){function a(){var b,e=this;a.__super__.constructor.call(this);if(0<arguments.length)return b=new a,b.push(arguments[0]),b;this.pick=function(b,a){var d,g,e,m;if("NaN"!==parseInt(b).toString())if(null!=a)if(d=b-a,0<d)e=this.slice(0,a),d=e.join(this.slice(a).pick(d));else{m=-d;e=this.slice(0,b);for(g=this.slice(b);0>d;)g.pick(m),d++;d=e.join(g)}else g=this.slice(0,b),d=this.slice(b+1),d=this.slice(0,0).push(this[b]).join(g).join(d);else{if(~(d=_.indexOf(this,b)))return this.pick(d);d=_.to_array(this);d.unshift(b)}this.empty();return this.join(d)};this.join=function(b){var a,d,g,e,m,h;if(null!=b&&(_.is_array(b)||(b.constructor.name=this.constructor.name))){a=0;for(g=b.length;a<g;a++)d=b[a],this.push(d);return this}e="";g=this.length;a=m=0;for(h=this.length;m<h;a=++m)d=this[a],a===g-1&&(e+=d.toString()),e+=d.toString()+b;return e};this.slice=function(b,a){var d;null==b&&(b=0);null==a&&(a=this.length);for(d=[];b<a;)d.push(this[b]),b++;return(new this.constructor).join(d)};this.push=function(b){this[this.length]=b;this.length++;return this};this.empty=function(){this.length=0;return this};this.keys=function(){var b,a,d,g;a=[];d=0;for(g=this.length;d<g;d++)b=this[d],null!=b&&null!=b.key&&a.push(b.key);return _.purge(a)};this.order=function(b,f){var d;null==f&&(f=!1);d=(new a).join(this);this.empty();this.length=b.length;_.map(d,function(a,d,e){return this[_.indexOf(b)]=f?a[f]:a},this);return this};this.promote=function(b){b="NaN"!==parseInt(b).toString()?b:_.indexOf(e.keys(),b);return e.pick(b,b-1)};this.demote=function(b){b="NaN"!==parseInt(b).toString()?b:_.indexOf(e.keys(),b);return e.pick(b,b+1)};this.remove=function(b){var a;a="NaN"!==parseInt(b).toString()?b:_.indexOf(e.keys(),b);b=e.slice();b=b.slice(0,a).join(b.slice(a+1));e.empty();return e.join(b)};return this}l(a,h);return a}(Array);this.__apptools_preinit.abstract_base_classes.push(O,u,x,R);N=function(h){function a(b,a){var c=this;this.registry=[];this.callchain={};this.history=[];this.mutators=[];this.fire=this.trigger=this.dispatch=function(){var a,d,g,e,m,h,w,B,l,p,W;d=arguments[0];a=2<=arguments.length?n.call(arguments,1):[];b.dev.eventlog("Trigger","Triggered event.",d,a,c.callchain[d]);if(0<=ba.call(c.registry,d)){m=h=0;g=[];B=[];B.push(d);W=c.callchain[d].hooks;l=0;for(p=W.length;l<p;l++){e=W[l];try{if(!0!==e.once||!0!==e.has_run)!1===e.bridge?(w=e.fn.apply(e,a),h++,c.history.push({event:d,callback:e,args:a,result:w}),e.has_run=!0):!0===e.bridge&&g.push({event:e.event,args:a,mutator:e.mutator})}catch(X){if(m++,e=c.history.push({event:d,callback:e,args:a,error:X}),$.apptools.dev.eventlog("exception",'Encountered unhandled exception when dispatching event hook for "'+d+'".',c.history[e-1]),$.apptools.dev.debug.eventlog&&$.apptools.dev.debug.verbose&&$.apptools.dev.error("Events","Unhandled event hook exception.",X),$.apptools.dev.debug.strict)throw X;}}w=0;for(l=g.length;w<l;w++)a=g[w],B.push(a.event),!1!==a.mutator?c.trigger.apply(c,[a.event].concat(n.call(c.mutators[a.mutator](a.args,d,a.event)))):c.trigger.apply(c,[a.event].concat(n.call(a.args)));return{events:B,executed:h,errors:m}}return!1};this.create=this.register=function(a){var d,g,e;if(!_.is_array(a)){if(_.is_string(a)&&""===a)return;a=[a]}else if(0===a.length)return;b.dev.eventlog("Register","Registered events.",{count:a.length,events:a});g=0;for(e=a.length;g<e;g++)d=a[g],c.registry.push(d),c.callchain[d]={hooks:[]};return c};this.on=this.upon=this.when=this.hook=function(a,d,g){null==g&&(g=!1);0>ba.call(c.registry,a)&&(b.dev.warning("warn","Tried to hook to unrecognized event. Registering..."),c.register(a));c.callchain[a].hooks.push({fn:d,once:g,has_run:!1,bridge:!1});b.dev.eventlog("Hook","Hook registered on event.",a);return!0};this.delegate=this.bridge=function(a,d,g){var e,h,q,w,B,l;null==g&&(g=null);"string"===typeof d&&(d=[d]);"string"===typeof a&&(a=[a]);b.dev.eventlog("Bridge","Bridging events.",{from:a},"->",{to:d});l=[];w=0;for(B=a.length;w<B;w++)h=a[w],l.push(function(){var a,c,f;f=[];a=0;for(c=d.length;a<c;a++)q=d[a],null==this.callchain[h]&&(b.dev.warn("Events","Bridging from undefined source event:",h),this.register(h)),null!=g?(e=this.mutators.push(g),f.push(this.callchain[h].hooks.push({event:q,bridge:!0,mutator:e-1}))):f.push(this.callchain[h].hooks.push({event:q,bridge:!0,mutator:!1}));return f}.call(c));return l}}l(a,h);a.mount="events";a.events=[];return a}(s);this.__apptools_preinit.abstract_base_classes.push(N);M=function(h){function a(b,a){var c,f,d,g,k,h=this;this.platform={};this.fingerprint={};this.capabilities={};null!=b.lib.modernizr&&(this.capabilities=b.lib.modernizr);this.capabilities.simple={};c=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:a.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];f=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];d=void 0;g=function(b){var a,c,f;c=0;for(f=b.length;c<f;c++)if(a=b[c],null!=a.string){if(-1!==a.string.indexOf(a.subString))return d=a.versionSearch||a.identity,a.identity}else if(a.prop)return d=a.versionSearch||a.identity,a.identity};k=function(b){var a;a=b.indexOf(d);if(-1!==a)return parseFloat(b.substring(a+d.length+1))};this.fingerprint=function(){var b,d,l,n,p;b=g(c)||"unknown";p=k(navigator.userAgent)||k(navigator.appVersion)||"unknown";l=g(f)||"unknown";-1!==b.search("iPod/iPhone")||-1!==b.search("Android")?(n="mobile",d=!0):(n="desktop",d=!1);h.platform={os:l,type:n,vendor:navigator.vendor,product:navigator.product,browser:b,version:p,flags:{online:navigator.onLine||!0,mobile:d,webkit:/AppleWebKit\//.test(navigator.userAgent),msie:/MSIE/.test(navigator.userAgent),opera:/Opera/.test(navigator.userAgent),mozilla:/Firefox/.test(navigator.userAgent)}};h.capabilities.simple.cookies=navigator.cookieEnabled;null!=a.XMLHttpRequest&&(h.capabilities.simple.ajax=!0);return{browser:[h.platform.browser,h.platform.version].join(":"),mobile:h.platform.flags.mobile,legacy:h.platform.flags.msie}}();return this}l(a,h);a.mount="agent";a.events=["UA_DISCOVER"];return a}(s);this.__apptools_preinit.abstract_base_classes.push(M);this.StorageDriver=y=function(h){function a(){}l(a,h);a.methods=["compatible","construct"];a["export"]="public";return a}(v);this.compatible=function(){};this.construct=function(){};this.StorageAdapter=x=function(h){function a(){}l(a,h);a.methods="get put delete clear get_async put_async delete_async clear_async".split(" ");a["export"]="public";return a}(v);this.KeyEncoder=v=function(h){function a(){}l(a,h);a.methods=["build_key","encode_key","build_cluster","encode_cluster"];a["export"]="public";return a}(v);null!=this.__apptools_preinit?(null==this.__apptools_preinit.abstract_base_classes&&(this.__apptools_preinit.abstract_base_classes=[]),null==this.__apptools_preinit.deferred_core_modules&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]};this.__apptools_preinit.detected_storage_engines=[];this.__apptools_preinit.abstract_base_classes.push(y,x);this.__apptools_preinit.abstract_feature_interfaces.push({adapter:y,name:"storage"});this.SimpleKeyEncoder=v=function(h){function a(){this.build_key=function(){};this.encode_key=function(){};this.build_cluster=function(){};this.encode_cluster=function(){}}l(a,h);return a}(v);new v;this.TransportInterface=D=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);a.prototype.capability="transport";a.prototype.required=[];return a}(z);this.RPCInterface=K=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);a.prototype.capability="rpc";a.prototype.parent=D;a.prototype.required=["factory","fulfill"];a.prototype.factory=function(){};a.prototype.fulfill=function(){};return a}(D);this.SocketInterface=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);a.prototype.capability="socket";a.prototype.parent=D;a.prototype.required=["factory","open","send","close","message"];a.prototype.open=function(){};a.prototype.send=function(){};a.prototype.close=function(){};a.prototype.factory=function(){};a.prototype.message=function(){};return a}(D);this.NativeXHR=S=function(h){function a(b,a){var c=this;this.xhr=b;this.request=a;this.open=function(b,a,g){return c.xhr.open(b,a,g)};this.get_header=function(b){return c.headers[b]};this.set_header=function(b,a){return c.headers[b]=a};this.send=function(b){var a,g,e,h;h=c.headers;for(a in h)e=h[a],c.xhr.setRequestHeader(a,e);e=c.events;for(g in e)a=e[g],c.xhr[g]=a;return c.xhr.send(b)};return this}l(a,h);a.prototype.xhr=null;a.prototype.request=null;a.prototype.headers={};a.prototype.events={};return a}(t);this.RPCPromise=T=function(h){function a(b,a){this.expected=b;this.directive=a;return this}l(a,h);a.prototype.expected=null;a.prototype.directive=null;a.prototype.fulfilled=!1;a.prototype.value=function(b,a){if("constructed"!==directive.status){if("pending"===directive.status){for(;"pending"===directive.status;);return directive.response}return this.directive.response}return this.directive.request.fulfill()};return a}(t);this.ServiceLayerDriver=r=function(h){function a(b){var e=this;this.internal={status_codes:{errors:[400,401,403,404,405,406,500,501,502,503,504,505],success:[200,201,202,203,204,205,303,304,301,302,307,308]},states:{errors:["REQUEST_ERROR","SERVER_ERROR","UNKNOWN_ERROR"],success:["success","pending"]},endpoint:function(b){}};this.rpc={factory:function(b){return new S(new XMLHttpRequest,b)},fulfill:function(a,f,d){var g,k,h,q;a.open(f.context.http_method,f.endpoint(b.rpc.state.config.jsonrpc),f.context.async);q=_.extend({"Content-Type":b.rpc.state.config.jsonrpc.content_type||f.context.content_type},b.rpc.state.config.headers,f.context.headers);for(k in q)h=q[k],a.set_header(k,h);g=function(b,a,c){var f;try{null==a.target.response||!_.is_string(a.target.response)||0>a.target.response.length||(f={response:{type:"GenericResponse",content:f=JSON.parse(a.target.response)},platform:{engine:"canteen/python"},status:b,id:c.envelope.id})}catch(g){f=a.target.response}return _.in_array(e.internal.status_codes.errors,a.target.status)||_.in_array(e.internal.states.errors,f.response.content.state)?(f.status="failure",d("failure",f)):d(f.status,f)};a.events.onload=function(b){return g("success",b,f)};a.events.onerror=a.events.onabort=a.events.timeout=function(b){return g("failure",b,f)};return a.send(JSON.stringify(f.payload()))}};return a.__super__.constructor.call(this,b)}l(a,h);a.prototype.name="apptools";a.prototype["native"]=!0;a.prototype["interface"]=[K];return a}(r);this.RPCContext=H=function(h){function a(b){null==b&&(b={});_.extend(this,this.defaults,b)}l(a,h);a.prototype.model={url:String(),async:Boolean(),defer:Boolean(),headers:{},cacheable:Boolean(),http_method:String(),crossdomain:Boolean(),content_type:String(),ifmodified:Boolean(),base_uri:String()};a.prototype.defaults={async:!0,defer:!1,headers:{},cacheable:!1,http_method:"POST",crossdomain:!1,content_type:"application/json",ifmodified:!1};return a}(u);this.RPCEnvelope=J=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,h);return a}(u);this.RequestEnvelope=aa=function(h){function a(b){_.extend(this,b)}l(a,h);a.prototype.model={id:Number(),opts:{},agent:{}};return a}(J);this.ResponseEnvelope=function(h){function a(b){a.__super__.constructor.call(this,_.extend(this,b))}l(a,h);a.prototype.model={id:Number(),flags:{},platform:{}};return a}(J);this.RPC=z=function(h){function a(){this.state=L(this.state,this);return this.state("constructed")}l(a,h);a.prototype.model={ttl:Number(),context:H,envelope:J};a.prototype.expired=function(){return!0};a.prototype.state=function(b){null==this.flags&&(this.flags={});this.flags.state=b;return this};return a}(u);this.RPCRequest=U=function(h){function a(b){this.payload=L(this.payload,this);this.fingerprint=L(this.fingerprint,this);a.__super__.constructor.call(this,_.extend(this,b))}l(a,h);a.prototype.states=["constructed","pending","fulfilled"];a.prototype.model={state:String(),params:{},method:String(),service:String()};a.prototype.fulfill=function(b){null==b&&(b={});return $.apptools.rpc.request.fulfill(this,b)};a.prototype.defer=function(b){return this.flags.defer=b};a.prototype.fingerprint=function(){return window.btoa(JSON.stringify([this.service,this.method,this.params,this.envelope.opts]))};a.prototype.endpoint=function(b){var a;null==b&&(b={});return null==this.context.url?(a=null==b.host?[window.location.protocol,window.location.host].join("//"):b.host,b=null!=this.context.base_uri&&_.is_string(this.context.base_uri)?this.context.base_uri:b.base_uri,[[a.concat(b),this.service].join("/"),this.method].join(".")):this.context.url};a.prototype.payload=function(){return this.params};return a}(z);this.RPCResponse=V=function(h){function a(b){this.inflate=L(this.inflate,this);a.__super__.constructor.call(this,_.extend(this,b))}l(a,h);a.prototype.states=["constructed","pending","success","failure","wait"];a.prototype.model={type:String(),status:String(),payload:{}};a.prototype.events={success:null,failure:null};a.prototype.inflate=function(b){return _.extend(this,b)};a.prototype.callbacks=function(b){this.events=b;return this};return a}(z);this.RPCErrorResponse=Z=function(h){function a(b,a){var c;this.events=b.events;if(null==(null!=(c=a.response)?c.content:void 0))throw $.apptools.dev.error("RPC","Invalid RPC error structure.",b,a),"Invalid RPC error structure.";return this.inflate(a)}l(a,h);a.prototype.model={code:Number(),message:String()};return a}(V);this.RPCAPI=Y=function(h){function a(b,a,c,f){var d,g,k,h;g=function(b,a,c,f){return function(c,d,g,e,k){null==c&&(c={});null==d&&(d={});null==g&&(g={});null==e&&(e={});null==k&&(k=U);return f.rpc.request.factory({method:a,service:b,params:c||{},context:new H(_.extend(f.rpc.request.context["default"](),d)),envelope:new aa(_.extend(e,{id:f.rpc.request.provision(),opts:g||{},agent:f.agent.fingerprint}))},k)}};if(null!=a.length&&0!==a.length)for(k=0,h=a.length;k<h;k++)d=a[k],this[d]=g(b,d,c,f);f.rpc.service.register(this,a,c);return this}l(a,h);return a}(t);this.CoreRPCAPI=P=function(h){function a(b,a){var c=this;this.state={config:{jsonrpc:{host:null,enabled:!0,base_uri:"/_rpc/v1",default_ttl:null,driver:null,content_type:"application/json"},channel:{token:null,script:null,enabled:!1,status:"DISCONNECTED",default_ttl:null,driver:null},sockets:{host:null,token:null,enabled:!1,status:"DISCONNECTED",default_ttl:null,driver:null},headers:{"X-ServiceClient":["AppToolsJS/",I.version.get()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}},consumer:null,requestpool:{id:1,data:[],index:[],done:[],queue:[],error:[],expect:{},context:new H},servicepool:{name_i:{},rpc_apis:[]},history:{last_request:null,last_error:null,last_success:null,rpclog:[]},cache:{data:{},index:{}}};this.internals={validate:function(b){return b},respond:function(a,d){var g;null==d&&(d=!1);b.events.trigger("RPC_FULFILL",a);if(d&&null!=a.request.cacheable&&!0===a.request.cacheable)try{if(null!=(g=c.state.cache.data[c.state.cache.index[a.request.fingerprint()]])&&!g.expired())return c.internals.validate(g)}catch(e){}return[c.internals.expect(a,d),c.internals.send_rpc(a)]},expect:function(a,d){a.status="pending";a.request.state("pending");a.response.state("pending");return new T(a,c.state.requestpool.expect[c.state.requestpool.index[a.request.envelope.id]]={success:function(g){a.status="success";a.request.state("fulfilled");a.response.state("success");c.state.requestpool.done.push(c.state.requestpool.index[a.request.envelope.id]);c.state.requestpool.queue.splice(a.queue_i,a.queue_i);delete c.state.requestpool.expect[c.state.requestpool.index[a.request.envelope.id]];d&&c.response.store(a.request,a.response);b.events.dispatch("RPC_SUCCESS",a);a.response.events.success(g.response.content,g.response.type,g)},failure:function(d){a.status="failure";a.response.state("failure");a.request.state("fulfilled");c.state.requestpool.error.push(c.state.requestpool.index[a.request.envelope.id]);c.state.requestpool.queue.splice(a.queue_i,a.queue_i);delete c.state.requestpool.expect[c.state.requestpool.index[a.request.envelope.id]];b.events.dispatch("RPC_FAILURE",a);a.response.events.failure(d.response.content,d.response.type,d)},progress:function(c){var d;b.events.dispatch("RPC_PROGRESS",a);"function"===typeof(d=a.response.events).progress&&d.progress(a.request,c,a)}})},send_rpc:function(a){var d,g;d=(g=c.state.config.jsonrpc).driver||(g.driver=b.sys.drivers.resolve(K));if(null==d)throw b.dev.error("RPC","Failed to resolve RPC-compatible driver for prompted RPC directive.",d,a),"Failed to resolve RPC-compatible driver prompted RPC directive.";a.queue_i=c.state.requestpool.queue.push(c.state.requestpool.index[a.request.envelope.id])-1;a.xhr=d.rpc.factory(a.request);b.events.dispatch("RPC_FULFILL",a.request,a.xhr,a);d.rpc.fulfill(a.xhr,a.request,function(b,d){return c.response.dispatch(b,a,d)});return a},dispatch:function(a,d){if(null==c.state.requestpool.expect[c.state.requestpool.index[a.request.envelope.id]])throw b.dev.error("RPC","Received a request to dispatch an unexpected RPC response.",a),"Unexpected RPC response.";return c.state.requestpool.expect[c.state.requestpool.index[a.request.envelope.id]][a.response.status](a.response,a.response.type,d)}};this.request={provision:function(){return c.state.requestpool.id++},factory:function(a,d){var g,e;null==d&&(d=U);e=new d(a);g=c.state.requestpool.index[e.envelope.id]=c.state.requestpool.data.push({request:e,response:new V({id:e.envelope.id}),status:"constructed"})-1;b.events.dispatch("RPC_CREATE",a,e,g);return e},fulfill:function(a,b,g){null==b&&(b={});null==g&&(g=!1);c.state.requestpool.data[c.state.requestpool.index[a.envelope.id]].response.callbacks(_.extend(c.response.callbacks["default"],b));return c.internals.respond(c.state.requestpool.data[c.state.requestpool.index[a.envelope.id]],g)},context:{"default":function(a){null!=a&&(c.state.requestpool.context=a);return c.state.requestpool.context},factory:function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(H,arguments,function(){})}}};this.response={store:function(a,b){return c},notify:function(a,b,c){},dispatch:function(a,b,g){"failure"===a&&(b.response=new Z(b.response,g));"failure"!==a&&b.response.inflate(g);return c.internals.dispatch(b,g)},callbacks:{"default":{notify:function(a){return b.dev.verbose("RPC","Encountered notify RPC with no callback.",a)},success:function(a){return b.dev.verbose("RPC","Encountered successful RPC with no callback.",a)},failure:function(a){return b.dev.verbose("RPC","Encountered failing RPC with no error callback.",a)}}}};this.direct={notify:function(a){},request:function(a){},response:function(a){},subscribe:function(a){},broadcast:function(a){}};this.service={factory:function(a,d,g,e){var h,q;_.is_array(a)||(a=[a]);h=0;for(q=a.length;h<q;h++)e=a[h],d=e[0],g=e[1],e=e[2],c.state.servicepool.name_i[d]=c.state.servicepool.rpc_apis.push(new Y(d,g,e,b))-1,b.api[d]=c.state.servicepool.rpc_apis[c.state.servicepool.name_i[d]];return c},register:function(a,c,e){return b.events.dispatch("CONSTRUCT_SERVICE",a,c,e)}}}l(a,h);a.mount="rpc";a.events="RPC_CREATE RPC_FULFILL RPC_SUCCESS RPC_FAILURE RPC_COMPLETE RPC_PROGRESS".split(" ");return a}(s);this.CoreServicesAPI=Q=function(h){function a(a,e){this._init=function(a){var b;null!=a.sys.state.config&&null!=(null!=(b=a.sys.state.config)?b.services:void 0)&&(null!=a.sys.state.config.services.endpoint&&(a.rpc.state.config.jsonrpc.host=a.sys.state.config.services.endpoint),null!=a.sys.state.config.services.consumer&&(a.rpc.state.config.consumer=a.sys.state.config.services.consumer),a.events.dispatch("SERVICES_INIT",a.rpc.state.config),a.rpc.service.factory(a.sys.state.config.services.apis),a.dev.verbose("RPC","Autoloaded in-page RPC config.",a.sys.state.config.services))}}l(a,h);a.mount="api";a.events=["SERVICES_INIT","CONSTRUCT_SERVICE"];return a}(s);r=[D,K,S,T,r];s=0;for(t=r.length;s<t;s++)E=r[s],E.prototype.install(window,E);this.__apptools_preinit.abstract_base_classes.push(P);this.__apptools_preinit.abstract_base_classes.push(Q);I=function(){function h(a){var b,e,c,f,d=this;b={transport:{rpc:{host:null,enabled:!0,base_uri:"/_api/rpc"},sockets:{host:null,enabled:!1,endpoint:"/_api/realtime"}},devtools:{debug:!0,strict:!1}};this.lib={};this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED","PLATFORM_READY"],state:{core:[],config:{},status:"NOT_READY",flags:["base","beta"],preinit:{},modules:{},classes:{},drivers:{},interfaces:{},integrations:[],add_flag:function(a){return d.sys.state.flags.push(a)},consider_preinit:function(b){var c,e,f,h;if(null!=b.abstract_base_classes)for(h=b.abstract_base_classes,e=0,f=h.length;e<f;e++)if(c=h[e],d.sys.state.classes[c.name]=c,null!=c["package"]&&null!=d.sys.state.modules[c["package"]]&&(d.sys.state.modules[c["package"]].classes[c.name]=c),null==c["export"]||"private"!==c["export"])a[c.name]=c;if(null!=b.deferred_library_integrations)for(h=b.deferred_library_integrations,e=0,f=h.length;e<f;e++)c=h[e],d.sys.libraries.install(c.name,c.library);if(null!=b.abstract_feature_interfaces)for(h=b.abstract_feature_interfaces,f=0,e=h.length;f<e;f++)c=h[f],d.sys.interfaces.install(c);if(null!=b.installed_drivers)for(h=b.installed_drivers,f=0,e=h.length;f<e;f++)c=h[f],d.sys.drivers.install(c);return b}},modules:{install:function(b,c,e){var f,h,l,n,p,s,r,t;null==c&&(c=null);null==e&&(e=null);b=_.is_array(b)&&null==c&&null==e?b:[b];null!=c&&("function"===typeof c?(e=c,l=null):l=c);null!=l?(null==d[l]&&(d[l]={}),l=d[l],n=!0):(l=d,n=!1);c=[];r=0;for(t=b.length;r<t;r++)(f=b[r])&&f.mount&&(h=null!=f.mount?f.mount:f.name.toLowerCase(),null!=f.events&&null!=d.events&&d.events.register(f.events),null==l[h]&&(p=n?new f(d,l,a):new f(d,a),l[h]=p,d.sys.state.modules[h]={module:p,classes:{}}),"function"===typeof(s=l[h])._init&&s._init(d),delete l[h]._init,null!=d.dev&&null!=d.dev.verbose&&d.dev.verbose("ModuleLoader","Installed module:",p," at mountpoint: ",l," under the name: ",h),null!=d.events&&d.events.trigger("SYS_MODULE_LOADED",{module:p,mountpoint:l}),null!=e&&e(p),c.push(p));return c}},libraries:{install:function(a,b,c){null==c&&(c=null);d.lib[a.toLowerCase()]=b;d.sys.state.integrations.push(a.toLowerCase());d.dev.verbose("Library",a+" detected.");d.events.trigger("SYS_LIB_LOADED",{name:a,library:b});null!=c&&c(b,a);return d.lib[a.toLowerCase()]},resolve:function(a){a=a.toLowerCase();if(null!=d.lib[a.toLowerCase()])return d.lib[a.toLowerCase()]}},interfaces:{install:function(a){a=null!=a.name&&null!=a.adapter?new a.adapter(d):new a(d);d.dev.verbose("Interface",'Installed "'+a.capability+'" interface.',a);if(null!==a.parent)if(_.is_string(a.parent)){if(null==d.sys.state.interfaces[a.parent])throw d.dev.error("System","Encountered interface with invalid parent reference.",a,a.parent),"Parent interface references must be valid and child interfaces must be loaded after their parents.";d.sys.state.interfaces[a.parent].children[a.capability]={adapter:a,children:{}};d.events.trigger("SYS_INTERFACE_LOADED",{adapter:d.sys.state.interfaces[a.parent].children[a.capability].adapter})}else{if(null==d.sys.state.interfaces[a.parent.prototype.capability])throw d.dev.error("System","Encountered interface with invalid parent reference.",a,a.parent),"Parent interface references must be valid and child interfaces must be loaded after their parents.";d.sys.state.interfaces[a.parent.prototype.capability].children[a.capability]={adapter:a,children:{}};d.events.trigger("SYS_INTERFACE_LOADED",{adapter:d.sys.state.interfaces[a.parent.prototype.capability].children[a.capability].adapter})}else d.sys.state.interfaces[a.capability]={adapter:a,children:{}},d.events.trigger("SYS_INTERFACE_LOADED",{adapter:d.sys.state.interfaces[a.capability].adapter});return d.sys.state.interfaces[a.capability]},resolve:function(a){var b,c,e,f;b=_.is_string(a)?String(a).toLowerCase():null!=a.prototype.parent?[a.prototype.parent.prototype.capability,a.prototype.capability].join("."):a.prototype.capability;a=b.split(".");if(1<a.length)return null!=(null!=(c=d.sys.state.interfaces[a[0]])?c.children[a[1]]:void 0)?null!=(e=d.sys.state.interfaces[a[0]])?null!=(f=e.children[a[1]])?f.adapter:void 0:void 0:!1;if(null!=d.sys.state.interfaces[b])return null!=d.sys.state.interfaces[b]?d.sys.state.interfaces[b].adapter:!1},children:function(a){_.is_string(a)||(a=a.capability);if(a.contains("."))return!1;if(null==d.sys.state.interfaces[a])throw d.dev.error('Failed to resolve interface children for missing interface "'+a+'".'),'Failed to resolve interface children for missing interface "'+a+'".';return d.sys.state.interfaces[a].children}},drivers:{install:function(b){var c,e,f,h,l,n,p,r,s;if(!_.is_string(b.name))throw d.dev.error("System","Encountered driver without a valid name.",b,b.name),"Drivers must have a string name attached at `driver.name`.";if(null!=d.sys.state.drivers[b.name])return d.dev.log("System",'Encountered a driver conflict installing "'+b.name+'".',"original: ",d.sys.state.drivers[b.name],"conflict: ",b);if(null!=b.prototype["native"]&&!0===b.prototype["native"]||null!=b.prototype.library||null!=b.prototype.compatible&&!0===b.prototype.compatible()){e=function(){var a,d,e,f;e=b.prototype["interface"];f=[];a=0;for(d=e.length;a<d;a++)c=e[a],f.push(this.sys.interfaces.resolve(c));return f}.call(d);b=null!=b.prototype.library?d.sys.state.drivers[b.name]=new b(b.prototype.library,d,a):d.sys.state.drivers[b.name]=new b(d,a);s=[];h=0;for(n=e.length;h<n;h++){c=e[h];null==b[c.capability]&&d.dev.warning("System",'Encountered driver ("'+b.name+'") with incomplete implementation for interface "'+c.capability+'".',c,b);if(null!=c.required)for(r=c.required,l=0,p=r.length;l<p;l++)if(f=r[l],null==b[c.capability][f])throw d.dev.error("System",'Encountered driver ("'+b.name+'") without required implementation method ("'+f+'") for attached interface "'+c.capability+'".',c,b),"Encountered fatal driver validation error.";s.push(c.add(b))}return s}d.dev.verbose("System",'Installed driver "'+b.name+'" was found to be incompatible with the current environment.');return!1},resolve:function(a,b){null==b&&(b=null);return d.sys.interfaces.resolve(a).resolve(b)}},go:function(a){a.dev.log("Core","All systems go.");a.sys.state.status="READY";a.events.trigger("PLATFORM_READY",a);return d}};null!=a.config&&_.is_object(a.config)?(e=a.config,this.sys.state.config=_.extend(b,this.sys.state.config,a.config)):(e=a._cfgst||"js-config",e=document.getElementById(e),this.sys.state.config=null!=e?_.extend(b,this.sys.state.config,JSON.parse(e.innerText)):_.extend({},b,this.sys.state.config));null!=this.sys.state.config.debug&&(G.prototype.debug=_.extend({},G.prototype.debug,this.sys.state.config.debug));this.sys.modules.install(G,function(a){return d.sys.modules.install(N,function(a){return a.register(d.sys.core_events)})});this.sys.state.preinit=a.__apptools_preinit||a.__preinit;null!=this.sys.state.preinit&&this.sys.state.consider_preinit(a.__apptools_preinit);this.sys.state.core=[O,M,P,Q,void 0];this.sys.modules.install(this.sys.state.core);if(null!=(null!=(c=a.__apptools_preinit)?c.deferred_core_modules:void 0))for(f=a.__apptools_preinit.deferred_core_modules,c=0,e=f.length;c<e;c++)b=f[c],null!=b["package"]?this.sys.modules.install(b.module,b["package"]):this.sys.modules.install(b.module);null!=a.__clock&&null!=this.analytics&&(this.dev.verbose("Analytics","Installing Google Analytics timings integration."),a.__clock.track=function(a){var b,c;c=a[0];b=a[1];d.analytics.track.timing(b[0],b[1],Math.floor(c)-Math.floor(b[2]),b[3],b[4]);return a});return this.sys.go(this)}h.version={major:0,minor:1,micro:5,build:8272012,release:"BETA",get:function(){var a,b,e,c,f;c=[this.major,this.minor,this.micro];f=[];b=0;for(e=c.length;b<e;b++)a=c[b],f.push(a.toString());return[[""+f,this.build.toString()].join("-"),this.release].join(" ")}};return h}();window.AppTools=I;window.apptools=new I(window);null!=window.jQuery?$.extend({apptools:window.apptools}):null!=window.$?window.$.apptools=window.apptools:(window.$=function(h){return document.getElementById(h)}).apptools=window.apptools;null!=window.__clock&&window.__clock.clockpoint("JavaScript","Platform Ready",window.__clock.ts[0],"AppTools",100)}).call(this);
