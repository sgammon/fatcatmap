(function(){var $_get_load_context$$,$__slice$$=[].slice;$_get_load_context$$=function $$_get_load_context$$$($d$$){return document.getElementById($d$$)};this.stage=$_get_load_context$$("appstage");this.map=$_get_load_context$$("map");this.frame=$_get_load_context$$("appframe");this.image_prefix="//fatcatmap.org/image-proxy/providence-clarity/warehouse/raw/govtrack/photos/";this.__onload_callbacks=[];this.receive=function $this$receive$($data$$){var $graph$$,$index$$,$_j_key$$,$_key_iter_key_i_native_suboffset$$,
$_i_native_i_target_k$$,$payload$$,$_len__len1__ref1__ref2_targets$$,$_k__ref$$,$_len2$$;$payload$$="string"===typeof $data$$?this.payload=JSON.parse($data$$):this.payload=$data$$;$data$$=this.data={};$index$$=this.index={nodes_by_key:{},edges_by_key:{},natives_by_key:{},object_natives:{}};$graph$$=this.graph={nodes:[],edges:[],natives:[]};$_k__ref$$=$payload$$.data.keys;$_key_iter_key_i_native_suboffset$$=$_i_native_i_target_k$$=0;for($_len__len1__ref1__ref2_targets$$=$_k__ref$$.length;$_i_native_i_target_k$$<
$_len__len1__ref1__ref2_targets$$;$_key_iter_key_i_native_suboffset$$=++$_i_native_i_target_k$$)$_j_key$$=$_k__ref$$[$_key_iter_key_i_native_suboffset$$],$data$$[$_j_key$$]=$payload$$.data.objects[$_key_iter_key_i_native_suboffset$$];$_len__len1__ref1__ref2_targets$$=Array($payload$$.graph.natives);$_key_iter_key_i_native_suboffset$$=$_j_key$$=0;for($_len__len1__ref1__ref2_targets$$=$_len__len1__ref1__ref2_targets$$.length;$_j_key$$<$_len__len1__ref1__ref2_targets$$;$_key_iter_key_i_native_suboffset$$=
++$_j_key$$)$_i_native_i_target_k$$=$payload$$.graph.edges+1+$_key_iter_key_i_native_suboffset$$,$_i_native_i_target_k$$=$index$$.natives_by_key[$payload$$.data.keys[$_i_native_i_target_k$$]]=$graph$$.natives.push({key:$payload$$.data.keys[$_i_native_i_target_k$$],data:$data$$[$payload$$.data.keys[$_i_native_i_target_k$$]]})-1;for($_key_iter_key_i_native_suboffset$$=-1;$_key_iter_key_i_native_suboffset$$<$payload$$.data.keys.length;)if($_key_iter_key_i_native_suboffset$$++,$_key_iter_key_i_native_suboffset$$<=
$payload$$.graph.nodes)$_i_native_i_target_k$$=$index$$.nodes_by_key[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]=$graph$$.nodes.push({node:{key:$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$],data:$data$$[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]},"native":$graph$$.natives[$index$$.natives_by_key[$data$$[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]["native"]]]})-1;else if($_key_iter_key_i_native_suboffset$$<=$payload$$.graph.edges){$_len__len1__ref1__ref2_targets$$=
$payload$$.data.objects[$_key_iter_key_i_native_suboffset$$].node;$_j_key$$=$_len__len1__ref1__ref2_targets$$[0];$_len__len1__ref1__ref2_targets$$=2<=$_len__len1__ref1__ref2_targets$$.length?$__slice$$.call($_len__len1__ref1__ref2_targets$$,1):[];$_k__ref$$=0;for($_len2$$=$_len__len1__ref1__ref2_targets$$.length;$_k__ref$$<$_len2$$;$_k__ref$$++)$_i_native_i_target_k$$=$_len__len1__ref1__ref2_targets$$[$_k__ref$$],null==$index$$.edges_by_key[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]&&
($index$$.edges_by_key[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]=[]),$_i_native_i_target_k$$=$graph$$.edges.push({edge:{key:$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$],data:$data$$[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]},"native":$graph$$.natives[$index$$.natives_by_key[$data$$[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]]["native"]]],source:{index:$index$$.nodes_by_key[$_j_key$$],object:$graph$$.nodes[$index$$.nodes_by_key[$_j_key$$]]},
target:{index:$index$$.nodes_by_key[$_i_native_i_target_k$$],object:$graph$$.nodes[$index$$.nodes_by_key[$_i_native_i_target_k$$]]}})-1;$index$$.edges_by_key[$payload$$.data.keys[$_key_iter_key_i_native_suboffset$$]].push($_i_native_i_target_k$$)}return setTimeout(function(){return this.draw($graph$$)},0)};$_get_load_context$$=this.load_context=function $this$load_context$($event$$,$data$$){this.context=$data$$||JSON.parse(document.getElementById("js-context").textContent);console.log("Loading context...",
this.context);this.context.services&&(console.log("Loading services...",this.context.services),apptools.rpc.service.factory(this.context.services));this.context.pagedata&&(this.pagedata=JSON.parse(document.getElementById("js-data").textContent),console.log("Detected stapled pagedata...",this.pagedata),this.receive(this.pagedata));return this.context};this.__onload_callbacks.push($_get_load_context$$);this.onload=function $this$onload$($event$$){var $callback$$,$_i$$,$_len$$,$_ref$$,$_results$$;$_ref$$=
this.__onload_callbacks;$_results$$=[];$_i$$=0;for($_len$$=$_ref$$.length;$_i$$<$_len$$;$_i$$++)$callback$$=$_ref$$[$_i$$],$_results$$.push($callback$$($event$$));return $_results$$}}).call(this);(function(){var $graph_config$$,$_ref$$0$$,$_ref1$$,$_ref2$$;$graph_config$$=$graph_config$$={width:frame.offsetWidth,height:frame.offsetHeight,force:{alpha:1,strength:0.4,friction:0.5,theta:0.3,gravity:0.05,charge:-50,distance:function $$graph_config$$$force$distance$($e$$){var $_ref$$;return null!=(null!=($_ref$$=$e$$["native"])?$_ref$$.data:void 0)?$e$$["native"].data.total:500}},node:{radius:20},sprite:{width:60,height:60,images:{format:(null!=($_ref$$0$$=this.context)?null!=($_ref1$$=$_ref$$0$$.agent)?
null!=($_ref2$$=$_ref1$$.capabilities)?"function"===typeof $_ref2$$.webp?$_ref2$$.webp({webp:"jpeg"}):void 0:void 0:void 0:void 0)||"jpeg"}},events:{click:{warmup:0.4}}};this.draw=function $this$draw$($graph$$){var $force$$;this.d3.scale.category20();$force$$=this.d3.layout.force().linkDistance($graph_config$$.force.distance).linkStrength($graph_config$$.force.strength).friction($graph_config$$.force.friction).charge($graph_config$$.force.charge).theta($graph_config$$.force.theta).gravity($graph_config$$.force.gravity).size([$graph_config$$.width,
$graph_config$$.height]).alpha($graph_config$$.force.alpha);return function($g$$){var $container$$,$line$$,$node$$;$node$$=d3.select(this.map);$line$$=$node$$.selectAll(".edge").data($g$$.edges).enter().append("svg").attr("id",function($e$$){return"edge-"+$e$$.edge.key}).append("line").attr("stroke","#999").attr("class","link").style("stroke-width",2);$container$$=$node$$.selectAll(".node").data($g$$.nodes).enter().append("svg").attr("id",function($n$$){return"group-"+$n$$.node.key}).attr("width",
$graph_config$$.sprite.width).attr("height",$graph_config$$.sprite.height).call($force$$.drag);$node$$=$container$$.append("g").attr("width",$graph_config$$.sprite.width).attr("height",$graph_config$$.sprite.height);$node$$.append("circle").attr("r",$graph_config$$.node.radius).attr("cx",$graph_config$$.sprite.width/2).attr("cy",$graph_config$$.sprite.height/2).attr("class","node");$node$$.append("image").filter(function($n$$){return null!=$n$$["native"].data.govtrack_id}).attr("width",$graph_config$$.sprite.width).attr("height",
$graph_config$$.sprite.height).attr("clip-path","url(#node-circle-mask)").attr("xlink:href",function($n$$){return image_prefix+$n$$["native"].data.govtrack_id.toString()+"-100px."+$graph_config$$.sprite.images.format});this.d3.select(stage).on("click",function($n$$){return $force$$.alpha($graph_config$$.events.click.warmup)});$force$$.on("tick",function($f$$){$line$$.attr("x1",function($d$$){return $d$$.source.object.x+$graph_config$$.node.radius/2}).attr("y1",function($d$$){return $d$$.source.object.y+
$graph_config$$.node.radius/2}).attr("x2",function($d$$){return $d$$.target.object.x+$graph_config$$.node.radius/2}).attr("y2",function($d$$){return $d$$.target.object.y+$graph_config$$.node.radius/2});return $container$$.attr("x",function($d$$){return $d$$.x-$graph_config$$.node.radius}).attr("y",function($d$$){return $d$$.y-$graph_config$$.node.radius})});return $force$$.nodes($g$$.nodes).links($g$$.edges).start()}($graph$$)}}).call(this);
