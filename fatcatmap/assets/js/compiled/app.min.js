(function() {Object.defineProperty(Function.prototype,"throttle",{value:function(a){var b=this,c,d,e;return function(){d=arguments;e=this;c||setTimeout(function(){c=null;b.apply(e,d)},a)}}});function h(a){var b;if(a&&a.querySelector)return a;b=b||document;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=b.querySelectorAll(a);b=[];var c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var k={context:JSON.parse(h("#js-context").textContent||"{}"),data:JSON.parse(h("#js-data").textContent||"{}")};var m={};function n(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}n.prototype=m;Object.defineProperty(Function.prototype,"client",{value:function(a){var b=this;return function(){return b.apply(new n(a),arguments)}}});Object.defineProperty(Function.prototype,"service",{value:function(a,b){n.prototype[a]=this.client(b);return n.prototype[a]}});
Object.defineProperty(Object.prototype,"service",{value:function(a){var b;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var c in this)this.hasOwnProperty(c)&&(b=this[c],b instanceof Function&&(this[c]=b.client()));n.prototype[a]=this;return n.prototype[a]}});m.service._register=function(a,b){m[a]=b};var p={q:navigator.cookieEnabled,u:2==window.devicePixelRatio,D:!!window.Worker,v:!!window.SharedWorker,w:!!window.WebSocket,A:!!window.EventSource,geo:!!navigator.geolocation,C:0<navigator.maxTouchPoints,history:{j:!!window.history.pushState,hash:!!window.onhashchange},B:{local:!!window.localStorage,session:!!window.sessionStorage,t:!!window.IDBFactory}};function q(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function r(a){var b={};a=a.split("?").pop().split("&");for(var c,d,e=0;e<a.length;e++)c=a[e].split("="),d=unescape(c[1]),b[c[0]]="true"===d||"false"===d?Boolean(d):/^\d*$/.test(d)?+d:d;return b}
function s(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};var t,u,v;t={};u={};v=function(a,b){for(var c=a.split("."),d=t;1<c.length;)d=d[c.shift()]||{};d[c.shift()]=b};
m.data={init:function(a,b){var c=this.data.normalize(a),d=c.data.keys,e=c.data.objects,f;for(f=0;d&&f<d.length;f++)t[d[f]]=e[f];b(c)},normalize:function(a){if("string"===typeof a)try{a=JSON.parse(a)}catch(b){console.warn("[service.data] Couldn't parse raw data: "),console.warn(a),a={}}return a},get:function(a,b){var c=t[a],d={success:function(a){this.data.set(e,a);b.success(a)}.bind(this),error:b.error},e;if(c)return c.g&&"string"===typeof c.g?(e=c.g,this.watch(e,function(b){this.data.set(a+".native",
b)}.bind(this)),this.data.get(e,d)):b.success(c);debugger},set:function(a,b){v(a,b);u[a].length&&u[a].forEach(function(a){a(b)})},watch:function(a,b){u[a]||(u[a]=[]);u[a].push(b)},unwatch:function(a,b){var c=b;b&&"function"===typeof b?u[a]=u[a].filter(function(a){return a===b}):(c=u[a],u[a]=[]);return c}}.service("data");var w,y;w={d:{},b:{},f:{}};
m.graph={init:function(a){return y=this.graph.i(a.graph,a.data)},i:function(a,b){if(!a)return y;y={nodes:[],edges:[],natives:[],origin:a.origin,n:b.keys[a.origin]};return this.graph.add(a,b)},add:function(a,b){var c,d,e,f,g,l;c=function(a,b){return function(c){var d;if(!w.d[a]||!w.d[a][c]){if(null==w.b[a]||null==w.b[c])debugger;d=y.edges.push({key:b,source:w.b[a],target:w.b[c]})-1;w.f[b].push(d);w.d[a]={};w.d[a][c]=d}}};d=0;for(e=b.keys;d<e.length;)f=e[d],d<=a.nodes?w.b[f]||(g={key:f,classes:["node"]},
l=b.objects[d].g,l=b.objects[e.indexOf(l)],l.s?(g.classes.push("legislator"),g.classes.push("M"===l.r?"male":"female"),g.classes.push(Math.ceil(100*Math.random())%2?"democrat":"republican"),.1869>Math.random()&&g.classes.push("senate")):(g.classes.push("contributor"),g.classes.push("C"==l.p?"corporate":"individual")),w.b[f]=y.nodes.push(g)-1):d<=a.edges&&(w.f[f]||(w.f[f]=[]),g=b.objects[d].node.slice(),l=g.shift(),g.forEach(c(l,f))),d++;return this.graph.get()},get:function(){return y}}.service("graph");var z,A,B;z=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.c?q(b.url,b.c):b.url,!!c);if(b.headers){a=b.headers;for(var e in a)a.hasOwnProperty(e)&&d.setRequestHeader(e,a[e])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=B(d);c.success(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=B(d)});return d};
A=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=z(a,b,c);a.send(d);return a};B=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var e=0;e<c.length;e++)c[e]&&(a=c[e].split(/^([^:]+):\s*/),b.headers[a[1]]=a[2]);return b};
m.http={get:function(a,b){return A("GET",a,b)},delete:function(a,b){return A("DELETE",a,b)},head:function(a,b){return A("HEAD",a,b)},post:function(a,b){return A("POST",a,b)},put:function(a,b){return A("PUT",a,b)},a:function(a,b){return A("PATCH",a,b)},options:function(a,b){return A("OPTIONS",a,b)}}.service("http");var C={e:[],dynamic:[]},D={route:[],routed:[],error:[]},E,G;E=function(a,b,c){function d(a,c){b.args[f.keys[c]]=a}for(var e=0,f,g,l;(f=c[e++])&&f.id<=a;)if(f.a.test(a)){g=!0;a=a.match(f.a).slice(1);a.forEach(d);l=f.handler.call(new n,b);break}return{k:g,response:l}};G=function(a,b){var c=this;c.keys=[];c.id=a.replace(/\/<(\w+)>/,function(a,b,f){c.keys.push(f);return"/(\\w+)"});c.a=new RegExp("^"+c.id+"$");c.handler=b;c.e=0===c.keys.length};
m.router={register:function(a,b){var c=!1,d,e,f,g;d=new G(a,b);f=d.e?C.e:C.dynamic;if(f.length){for(g=0;g<f.length;g++)if(e=f[g],!(e.id<d.id)){f.splice(g,0,d);c=!0;break}!1===c&&f.push(d)}else f.push(d)},route:function(a,b){var c,d,e;b=b||{};b.args={};b.c=b.c||{};c=r(a);for(d in c)c.hasOwnProperty(d)&&(b.c[d]=c[d]);D.route.forEach(function(c){c(a,b)});e=E(a,b,C.e);if(e.k)return e=e.response,D.routed.forEach(function(c){c(a,b,e)}),e;e=E(a,b,C.dynamic);if(e.k)return e=e.response,D.routed.forEach(function(c){c(a,
b,e)}),e;e={status:404};D.error.forEach(function(c){c(a,b,e)});return e},on:function(a,b){D[a]||(D[a]=[]);D[a].push(b)},a:function(a,b){var c;b?(c=D[a].indexOf(b),-1<c&&D[a].splice(c,1)):D[a]=[]},init:function(a,b){for(var c in a)a.hasOwnProperty(c)&&"function"===typeof a[c]&&this.router.register(c,a[c]);b&&b(window.location.pathname.split("?").shift())}}.service("router");m.history={push:p.history.j?function(a,b){window.history.pushState(b,"",a)}:function(){},init:function(){var a=this;a.router.on("routed",function(a,c){"history"!==c.source&&m.history.push(a,c.state)});p.history.j&&(window.onpopstate=function(b){a.router.route(window.location.pathname,{source:"history",state:b.state||{}})});a.init=function(){throw Error("History already started");}}}.service("history");var H;H=function(a,b,c){var d=this;d.name=a;d.config=c;b.forEach(function(a){var b=s("/_rpc/v1/",d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data||{},c:a.c||{},headers:a.headers||{}};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return this.http.post(d,c)}.client()})};m.rpc={m:function(a){var b=a[0];m.rpc[b]=new H(b,a[1],a[2])},init:function(a){a.forEach(m.rpc.m)}}.service("rpc");var I={};m.template={put:function(a,b){"string"===typeof a&&"string"===typeof b&&(I[a]=b)},get:function(a,b){if("string"!==typeof a||"function"!==typeof b.success||"function"!==typeof b.error)throw new TypeError("template.get() requires a filename and CallbackMap.");return I[a]?b.success({data:I[a]}):this.rpc.content.template({data:{path:a}},b)},has:function(a){return!!I[a]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&m.template.put(b,a[b])}}.service("template");var J={};function K(a,b){var c=a.replace(".","/")+".html";m.template.get(c,{success:function(d){var e=[],f,g;if("string"!==typeof d.data)return b(!1,d);f=d.data.replace(/v-component=("|')([\w\.\-]+)\1/g,function(a,b,c){e.push(c);return a});g=e.length;J[a]&&(J[a].options.template=f);m.template.put(c,f);if(0===g)return b();e.forEach(function(a){K(a,function(){g-=1;0===g&&b(f)})})},error:function(a){b(!1,a)}})}
m.view={put:function(a,b){if("string"!==typeof a||"function"!==typeof b)throw new TypeError("services.view.put() takes a string name and constructor.");return J[a]=b},get:function(a){if("string"!==typeof a)throw new TypeError("services.view.get() takes a string name.");return J[a]},init:function(a,b){var c=m.view.get(a);if(!c)throw Error("view.init() cannot be called with unregistered view "+a);K(a,function(d){document.body.innerHTML="";d&&(c.options.template=d);m.view.put(a,c);d=new c({ready:b,el:"body"});
window.__ROOTVIEW=d})}}.service("view");window.__VIEWS=J;var L=Vue.extend({});L.extend=function(a){var b=a.viewname.toLowerCase(),c;if(!b||"string"!==typeof b)throw Error('AppView.extend() requires a "viewname" option to be passed.');a.ready&&(c=a.ready);a.ready=function(){this.$options.handler&&this.$on(this.$options.viewname,this.$options.handler.bind(this));c&&c.call(this)};a=Vue.extend(a);m.view.put(b,a);Vue.component(b,a);return a};L.extend({viewname:"detail",replace:!0,data:{view:"",selected:null},handler:function(a){this.$set("view",a.kind.toLowerCase());this.$set("selected",a)}});L.extend({viewname:"header",replace:!0});L.extend({viewname:"modal",data:{active:!1,message:""}});L.extend({viewname:"stage",replace:!0});L.extend({viewname:"page.map",replace:!0,selectors:{map:"#map",edge:".edge",node:".node",selected:".selected"},data:{map:{},config:{width:0,height:0,force:{alpha:.75,strength:1,friction:.9,theta:.7,gravity:.1,charge:-600,distance:180},origin:{snap:!0,dynamic:!1,position:null},node:{radius:25,scaleFactor:1.6,classes:["node"]},labels:{enable:!1,distance:0},edge:{width:2,stroke:"#999",classes:["link"]},sprite:{width:60,height:60}}},methods:{isNode:function(a){return a.classList.contains("node")},isEdge:function(a){return a.classList.contains("link")},
select:function(a){var b=a.target,c=b.id.split("-").pop(),d=this.$options.selectors.selected.slice(1);this.map.selected||(this.map.selected=[]);this.isNode(b)&&(a.preventDefault(),a.stopPropagation(),b.classList.contains(d)?(a=this.map.selected.indexOf(c),-1<a&&this.map.selected.splice(a,1)):(a.shiftKey||(this.map.selected=[]),this.map.selected.push(c)));this.map.selected.h=!0;this.map.force.start()},browseTo:function(){console.log("map.browseTo()")},draw:function(a){var b=this,c,d,e,f,g,l,x,F;if(a&&
!b.map.root)c=b.config,d=b.$options.selectors,e=d3.select(d.map).attr("width",c.width).attr("height",c.height),f=e.selectAll(d.node),g=e.selectAll(d.edge),l=function(){b.config.origin.snap&&(a.nodes[a.origin].x=b.config.origin.position.x,a.nodes[a.origin].y=b.config.origin.position.y);g.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});f.attr("cx",function(a){return a.x}).attr("cy",
function(a){return a.y});b.map.selected&&b.map.selected.h&&(f.filter(d.selected).filter(function(a){return-1===b.map.selected.indexOf(a.key)}).classed({selected:!1}).transition().duration(200).ease("cubic").attr("r",c.node.radius),f.filter(function(a){return-1<b.map.selected.indexOf(a.key)}).classed({selected:!0}).transition().duration(200).ease("cubic").attr("r",c.node.radius*c.node.scaleFactor),b.map.selected.h=!1)},x=d3.layout.force().size([c.width,c.height]).linkDistance(c.force.distance).linkStrength(c.force.strength).friction(c.force.friction).theta(c.force.theta).gravity(c.force.gravity).alpha(c.force.alpha).charge(function(a){return b.map.selected&&
-1<b.map.selected.indexOf(a.key)?c.force.charge*c.node.scaleFactor:c.force.charge}).on("tick",l),F=function(){var b=a.nodes,d=a.edges;x.nodes(b).links(d).start();g=g.data(d,function(a){return a.key});g.l().remove();g.enter().insert("line",".node").attr("id",function(a){return"edge-"+a.key}).attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("stroke-width",c.edge.width).attr("stroke",
c.edge.stroke).attr("class",c.edge.classes);f=f.data(b,function(a){return a.key});f.l().remove();f.enter().append("svg:circle").attr("id",function(a){return"node-"+a.key}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",c.node.radius).attr("width",c.sprite.width).attr("height",c.sprite.height).attr("class",function(a){return a.classes.join(" ")}).call(x.drag);f.filter(function(b){return b.key===a.n})},b.map.root=e,b.map.force=x,setTimeout(function(){F()},0);else return b.map.root=
null,h(b.$options.selectors.map).innerHTML="",b.draw(a)}},ready:function(){var a=this;window.addEventListener("resize",function(){var b=a.$el.clientWidth,c=a.$el.clientHeight;a.config.width=b;a.config.height=c;a.map.root&&a.map.root.attr("width",b).attr("height",c);a.config.origin.snap&&(a.config.origin.position.x=b/2,a.config.origin.position.y=c/2);a.map.force&&a.map.force.size([b,c]).resume()})},handler:function(a){var b=this.$el.clientWidth,c=this.$el.clientHeight;this.config.width=b;this.config.height=
c;this.config.origin.snap&&(this.config.origin.position=this.config.origin.position||{},this.config.origin.position.x=b/2,this.config.origin.position.y=c/2);this.draw(a);h(this.$options.selectors.map).classList.remove("transparent")}});var M=Vue.extend({data:{page:{active:!1},modal:null},methods:{route:function(a){if(a.target.hasAttribute("data-route")){var b=a.target.getAttribute("href");a.preventDefault();a.stopPropagation();m.router.route(b)}}},ready:function(){this.$on("route",function(a){m.router.route(a)})}});m.view.put("page",M);var N,O,P;N=[];O=function(){var a=N;N=null;a.forEach(function(a){a()})};
P=function(a,b,c){var d=this;d.o=a;d.session=null;a.session&&a.session.established&&(d.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&d.rpc.init(a.services);a.template.manifest&&d.template.init(a.template.manifest);d.data.init(b,function(a){d.graph.init(a)});d.router.init(c,function(a){d.ready(function(){d.history.init();if(a)return d.router.route(a)})});d.view.init("page",function(){this.$set("active",!0);this.$.a.$set("active",!0);m.service._register("app",this);O()});return this}.client({ready:function(a){if(a){if(!N)return a();
N.push(a)}}});window.catnip_beta=P(k.context,k.data,{"/":function(){this.a.$broadcast("page.map",this.graph.i());return null},"/login":function(){},"/settings":function(){},"/404":function(){},"/<key>":function(a){var b=this;b.data.get(a.args.key,{success:function(a){b.a.$broadcast("detail",a)},error:function(c){a.error=c;b.router.route("/404",a)}});return null},"/<key1>/and/<key2>":function(){}});})();

//# sourceMappingURL=../../../../.develop/maps/fatcatmap/assets/js/app.min.js.map