(function() {var f={"/":function(){this.b.d.$set("page.route","/");return null},"/login":function(){},"/settings":function(){},"/beta":function(){this.b.d.$set("page.route","/beta");return null},"/404":function(){},"/<key>":function(a){var b=this;b.data.get(a.args.key,{success:function(a){this.b.d.$broadcast("detail",a)},error:function(c){a.error=c;b.router.route("/404",a)}});return null},"/<key1>/and/<key2>":function(){}};function k(a){if(a&&a.querySelector)return a;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=document.querySelectorAll(a);var b=[],c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var l={i:JSON.parse(k("#js-context").textContent||"{}"),data:JSON.parse(k("#js-data").textContent||"{}")};var m={};function n(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}n.prototype=m;Object.defineProperty(Function.prototype,"client",{value:function(a){var b=this;return function(){return b.apply(new n(a),arguments)}}});Object.defineProperty(Function.prototype,"service",{value:function(a,b){n.prototype[a]=this.client(b);return n.prototype[a]}});
Object.defineProperty(Object.prototype,"service",{value:function(a){var b;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var c in this)this.hasOwnProperty(c)&&(b=this[c],b instanceof Function&&(this[c]=b.client()));n.prototype[a]=this;return n.prototype[a]}});var p={n:navigator.cookieEnabled,q:2==window.devicePixelRatio,w:!!window.Worker,r:!!window.SharedWorker,s:!!window.WebSocket,t:!!window.EventSource,o:!!navigator.geolocation,v:0<navigator.maxTouchPoints,history:{f:!!window.history.pushState,hash:!!window.onhashchange},u:{local:!!window.localStorage,session:!!window.sessionStorage,p:!!window.IDBFactory}};function q(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function r(a){var b={};a=a.split("?").pop().split("&");for(var c,d,e=0;e<a.length;e++)c=a[e].split("="),d=unescape(c[1]),b[c[0]]="true"===d||"false"===d?Boolean(d):/^\d*$/.test(d)?+d:d;return b}
function s(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};m.data={init:function(){this.a={}},normalize:function(a){if("string"===typeof a)try{a=JSON.parse(a)}catch(b){a={}}return a},watch:function(a,b,c){if(!a)throw Error("services.data.watch() requires a string key.");if(!c){if("function"!==typeof b)throw Error("services.data.watch() requires a watcher function.");c=b;b=null}this.a[a]||(this.a[a]=[]);this.a[a].push(b?c.bind(b):function(a){c.call(a,a)})},unwatch:function(a,b){var c,d;if(this.a[a]){c=this.a[a];if(b)for(d=0;d<c.length;d++){if(b===c[d]){c.splice(d,
1);break}}else c=[];this.a[a]=c}}}.service("data");m.graph={init:function(a){return this.graph.h(this.data.normalize(a))},h:function(a){return a}}.service("graph");m.map={draw:function(){}}.service("map");var t,u,v;t=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.c?q(b.url,b.c):b.url,!!c);if(b.headers){a=b.headers;for(var e in a)a.hasOwnProperty(e)&&d.setRequestHeader(e,a[e])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=v(d);c.success(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=v(d)});return d};
u=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=t(a,b,c);a.send(d);return a};v=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var e=0;e<c.length;e++)c[e]&&(a=c[e].split(/^([^:]+):\s*/),b.headers[a[1]]=a[2]);return b};
m.http={get:function(a,b){return u("GET",a,b)},delete:function(a,b){return u("DELETE",a,b)},head:function(a,b){return u("HEAD",a,b)},l:function(a,b){return u("POST",a,b)},put:function(a,b){return u("PUT",a,b)},a:function(a,b){return u("PATCH",a,b)},options:function(a,b){return u("OPTIONS",a,b)}}.service("http");var w={e:[],dynamic:[]},x={route:[],routed:[],error:[]},y,z;y=function(a,b,c){function d(a,c){b.args[g.keys[c]]=a}for(var e=0,g,h,A;(g=c[e++])&&g.id<=a;)if(g.a.test(a)){h=!0;a=a.match(g.a).slice(1);a.forEach(d);A=g.handler.call(new n,b);break}return{g:h,response:A}};z=function(a,b){var c=this;c.keys=[];c.id=a.replace(/\/<(\w+)>/,function(a,b,g){c.keys.push(g);return"/(\\w+)"});c.a=new RegExp("^"+c.id+"$");c.handler=b;c.e=0===c.keys.length};
m.router={register:function(a,b){var c=!1,d,e,g,h;d=new z(a,b);g=d.e?w.e:w.dynamic;if(g.length){for(h=0;h<g.length;h++)if(e=g[h],!(e.id<d.id)){g.splice(h,0,d);c=!0;break}!1===c&&g.push(d)}else g.push(d)},route:function(a,b){var c,d,e;b=b||{};b.args={};b.c=b.c||{};c=r(a);for(d in c)c.hasOwnProperty(d)&&(b.c[d]=c[d]);x.route.forEach(function(c){c(a,b)});e=y(a,b,w.e);if(e.g)return e=e.response,x.routed.forEach(function(c){c(a,b,e)}),e;e=y(a,b,w.dynamic);if(e.g)return e=e.response,x.routed.forEach(function(c){c(a,
b,e)}),e;e={status:404};x.error.forEach(function(c){c(a,b,e)});return e},k:function(a,b){x[a]||(x[a]=[]);x[a].push(b)},a:function(a,b){var c;b?(c=x[a].indexOf(b),-1<c&&x[a].splice(c,1)):x[a]=[]},init:function(a,b){for(var c in a)a.hasOwnProperty(c)&&"function"===typeof a[c]&&this.router.register(c,a[c]);b&&b(window.location.pathname.split("?").shift())}}.service("router");m.history={push:p.history.f?function(a,b){window.history.pushState(b,"",a)}:function(){},init:function(){var a=this;a.router.k("routed",function(a,c){"history"!==c.source&&m.history.push(a,c.state)});p.history.f&&(window.onpopstate=function(b){a.router.route(window.location.pathname,{source:"history",state:b.state||{}})});a.init=function(){throw Error("History already started");}}}.service("history");var B;B=function(a,b,c){var d=this;d.name=a;d.config=c;b.forEach(function(a){var b=s("/_rpc/v1/",d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data||{},c:a.c||{},headers:a.headers||{}};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return this.http.l(d,c)}.client()})};m.rpc={j:function(a){var b=a[0];m.rpc[b]=new B(b,a[1],a[2])},init:function(a){a.forEach(m.rpc.j)}}.service("rpc");var C={};m.template={put:function(a,b){"string"===typeof a&&"string"===typeof b&&(C[a]=b)},get:function(a,b){if("string"!==typeof a||"function"!==typeof b.success||"function"!==typeof b.error)throw new TypeError("template.get() requires a filename and CallbackMap.");return C[a]?b.success({data:C[a]}):this.rpc.content.template({data:{path:a}},b)},a:function(a){return!!C[a]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&m.template.put(b,a[b])}}.service("template");var D={};function E(a,b){var c=a.replace(".","/")+".html";m.template.get(c,{success:function(d){var e=[],g,h;if("string"!==typeof d.data)return b(!1,d);g=d.data.replace(/v-component=("|')(\w+)\1/g,function(a,b,c){e.push(c);return a});h=e.length;D[a]&&(D[a].options.template=g);m.template.put(c,g);if(0===h)return b();e.forEach(function(a){E(a,function(){h-=1;0===h&&b(g)})})},error:function(a){b(!1,a)}})}
m.view={put:function(a,b){if("string"!==typeof a||"function"!==typeof b)throw new TypeError("services.view.put() takes a string name and constructor.");return D[a]=b},get:function(a){if("string"!==typeof a)throw new TypeError("services.view.get() takes a string name.");return D[a]},init:function(a,b){var c=m.view.get(a);if(!c)throw Error("view.init() cannot be called with unregistered view "+a);E(a,function(d){document.body.innerHTML="";d&&(c.options.template=d);m.view.put(a,c);d=new c({ready:b,el:"body"});
window.__ROOTVIEW=d})}}.service("view");window.__VIEWS=D;var F=Vue.extend({});F.extend=function(a){var b=a.viewname.toLowerCase(),c;if(!b||"string"!==typeof b)throw Error('AppView.extend() requires a "viewname" option to be passed.');a.ready&&(c=a.ready);a.ready=function(){this.$options.handler&&this.$on(this.$options.viewname,this.$options.handler.bind(this));c&&c.call(this)};a=Vue.extend(a);m.view.put(b,a);Vue.component(b,a);return a};F.extend({viewname:"detail",replace:!0,data:{view:"",selected:null},handler:function(a){this.$set("view",a.kind.toLowerCase());this.$set("selected",a)}});F.extend({viewname:"header",replace:!0});F.extend({viewname:"map",data:{active:!0,selected:null,config:{width:0,height:0,force:{alpha:.75,strength:1,friction:.9,theta:.7,gravity:.1,charge:-700,distance:180},origin:{snap:!0,dynamic:!0,position:null},node:{radius:20,classes:["node"]},labels:{enable:!1,distance:0},edge:{width:2,stroke:"#999",classes:["link"]},sprite:{width:60,height:60}}},methods:{toggleSelected:function(){},addSelected:function(){},browseTo:function(){},draw:function(){}},attached:function(){var a=this.$el.offsetWidth,b=this.$el.offsetHeight;
this.$set("config.width",a);this.$set("config.height",b);this.$set("config.origin.position",{x:a-30,y:b-30})},ready:function(){window.addEventListener("resize",function(){})}});F.extend({viewname:"modal",data:{active:!1,message:""}});F.extend({viewname:"stage",replace:!0,data:{active:!0}});var G=Vue.extend({data:{page:{route:"/"},active:!1,modal:null},methods:{route:function(a){if(a.target.hasAttribute("data-route")){var b=a.target.getAttribute("href");a.preventDefault();a.stopPropagation();m.router.route(b)}},child:function(a){a=a.split(".");for(var b=this,c;a.length;)c=a.shift(),b=b.$[c];return b}}});m.view.put("page",G);var H,I,J;H=[];I=function(){var a=H;H=null;a.forEach(function(a){a()})};
J=m.b={init:function(a){var b=this;b.m=a;b.session=null;b.d=null;a.session&&a.session.established&&(b.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&b.rpc.init(a.services);a.template.manifest&&b.template.init(a.template.manifest);b.view.init("page",function(){this.$set("active",!0);m.b.d=this;I()});b.router.init(f,function(a){b.b.ready(function(){b.history.init();if(a)return b.router.route(a);b.router.route("/beta")})});m.b.init=function(){return b};return this},ready:function(a){if(a){if(!H)return a();
H.push(a)}}}.service("catnip");window.catnip_beta=J.init(l.i,l.data);})();
