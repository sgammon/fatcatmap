(function() {Object.defineProperty(Function.prototype,"throttle",{value:function(a){var b=this,c,d,e;return function(){d=arguments;e=this;c||setTimeout(function(){c=null;b.apply(e,d)},a)}}});function h(a){var b;if(a&&a.querySelector)return a;b=b||document;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=b.querySelectorAll(a);b=[];var c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var l={context:JSON.parse(h("#js-context").textContent||"{}"),data:JSON.parse(h("#js-data").textContent||"{}")};var m={},n,p;n=function(){};n.prototype={};n.register=function(a,b){return n.prototype[a]=b};p=function(a,b){if("string"!==typeof a)throw new TypeError("Service() requires a service name to register.");if(b)for(var c in b)b.hasOwnProperty(c)&&b[c]instanceof Function&&(this[c]=b[c].k?b[c]:b[c].inject());n.register(a,this)};p.prototype=new n;
Object.defineProperty(Function.prototype,"inject",{value:function(a){var b=this,c,d;if(b.k)return b;a||(a=[]);if(a&&!Array.isArray(a)){if("string"!==typeof a)throw new TypeError("inject() requires a service name or list of names.");a=[a]}a.forEach(function(a){c||(c={});c[a]=n.prototype[a]});d=function(){};d.prototype=c||new n;a=function(){return b.apply(new d,arguments)};a.k=m.length?m:!0;return a}});Object.defineProperty(Function.prototype,"service",{value:function(a){return n.register(a,this.inject())}});
Object.defineProperty(Object.prototype,"service",{value:function(a){return new p(a,this)}});var q={u:navigator.cookieEnabled,B:2==window.devicePixelRatio,I:!!window.Worker,C:!!window.SharedWorker,D:!!window.WebSocket,F:!!window.EventSource,geo:!!navigator.geolocation,H:0<navigator.maxTouchPoints,history:{l:!!window.history.pushState,hash:!!window.onhashchange},G:{local:!!window.localStorage,session:!!window.sessionStorage,v:!!window.IDBFactory}};function r(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function s(a){var b={};a=a.split("?").pop().split("&");for(var c,d,e=0;e<a.length;e++)c=a[e].split("="),d=unescape(c[1]),b[c[0]]="true"===d||"false"===d?Boolean(d):/^\d*$/.test(d)?+d:d;return b}
function t(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};var u,w,x;u={};w={};x=function(a,b){for(var c=a.split("."),d=u;1<c.length;)a=c.shift(),d=d[a]||(d[a]={},d[a]);d[c.shift()]=b};
m.data={init:function(a,b){var c=this.data.normalize(a),d=c.data.keys,e=c.data.objects,f,g,k;for(k=0;d&&k<d.length;k++)f=d[k],g=e[k],g.key||(g.key=f),g.h||(g.kind=g.govtrack_id?"legislator":"contributor"),u[f]=g;window.DATACACHE=u;b(c)},normalize:function(a){if("string"===typeof a)try{a=JSON.parse(a)}catch(b){console.warn("[service.data] Couldn't parse raw data: "),console.warn(a),a={}}return a},get:function(a,b){var c,d;if(Array.isArray(a))return this.data.getAll(a,b);if(c=u[a])return(d=c.h)&&"string"===
typeof d&&(u[d]?(u[d].p=a,this.data.set(a+".native",u[d])):this.data.get(d,{b:function(b){b.p=a;m.data.set(a+".native",b);m.data.set(d,b)},error:function(){}})),b.b(c);debugger},getAll:function(a,b){var c=[],d=!0;a.forEach(function(e,f){m.data.get(e,{b:function(d){c[f]=d;c.length===a.length&&b.b(c)},error:function(a){d&&(d=!1,b.error(a))}})})},set:function(a,b){var c=w[a];x(a,b);c&&c.length&&c.forEach(function(a){a(b)})},watch:function(a,b){w[a]||(w[a]=[]);w[a].push(b)},unwatch:function(a,b){var c=
b;b&&"function"===typeof b?w[a]=w[a].filter(function(a){return a===b}):(c=w[a],w[a]=[]);return c}}.service("data");var y,z;y={f:{},d:{},j:{}};
m.graph={init:function(a){return z=this.graph.g(a.graph,a.data)},g:function(a,b){if(!a)return z;z={nodes:[],edges:[],natives:[],origin:a.origin,q:b.keys[a.origin]};return this.graph.add(a,b)},add:function(a,b){var c,d,e,f,g,k;c=function(a,b){return function(c){var d;if(!y.f[a]||!y.f[a][c]){if(null==y.d[a]||null==y.d[c])debugger;d=z.edges.push({key:b,source:y.d[a],target:y.d[c]})-1;y.j[b].push(d);y.f[a]={};y.f[a][c]=d}}};d=0;for(e=b.keys;d<e.length;)f=e[d],d<=a.nodes?y.d[f]||(g={key:f,classes:["node"]},
k=b.objects[d].h,k=b.objects[e.indexOf(k)],k.govtrack_id?(g.classes.push("legislator"),g.classes.push("M"===k.gender?"male":"female"),g.classes.push(Math.ceil(100*Math.random())%2?"democrat":"republican"),.1869>Math.random()&&g.classes.push("senate")):(g.classes.push("contributor"),g.classes.push("C"==k.t?"corporate":"individual")),y.d[f]=z.nodes.push(g)-1):d<=a.edges&&(y.j[f]||(y.j[f]=[]),g=b.objects[d].node.slice(),k=g.shift(),g.forEach(c(k,f))),d++;return this.graph.get()},get:function(){return z}}.service("graph");var A,B,C;A=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.e?r(b.url,b.e):b.url,!!c);if(b.headers){a=b.headers;for(var e in a)a.hasOwnProperty(e)&&d.setRequestHeader(e,a[e])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=C(d);c.b(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=C(d)});return d};
B=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=A(a,b,c);a.send(d);return a};C=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var e=0;e<c.length;e++)c[e]&&(a=c[e].split(/^([^:]+):\s*/),b.headers[a[1]]=a[2]);return b};
m.http={get:function(a,b){return B("GET",a,b)},delete:function(a,b){return B("DELETE",a,b)},head:function(a,b){return B("HEAD",a,b)},post:function(a,b){return B("POST",a,b)},put:function(a,b){return B("PUT",a,b)},a:function(a,b){return B("PATCH",a,b)},options:function(a,b){return B("OPTIONS",a,b)}}.service("http");var D={i:[],dynamic:[]},E={route:[],routed:[],error:[]},F,G;F=function(a,b,c){function d(a,c){b.args[f.keys[c]]=a}for(var e=0,f,g,k;(f=c[e++])&&f.id<=a;)if(f.a.test(a)){g=!0;a=a.match(f.a).slice(1);a.forEach(d);k=f.handler.call(new n,b);break}return{m:g,response:k}};G=function(a,b){var c=this;c.keys=[];c.id=a.replace(/\/<(\w+)>/g,function(a,b){c.keys.push(b);return"/(\\w+)"});c.a=new RegExp("^"+c.id+"$");c.handler=b;c.i=0===c.keys.length};
m.router={register:function(a,b){var c,d,e;c=new G(a,b);d=c.i?D.i:D.dynamic;for(e=0;e<d.length;e++)if(d[e].id>c.id){d.splice(e,0,c);return}d.push(c)},route:function(a,b){var c,d,e;b=b||{};b.args={};b.e=b.e||{};c=s(a);for(d in c)c.hasOwnProperty(d)&&(b.e[d]=c[d]);E.route.forEach(function(c){c(a,b)});e=F(a,b,D.i);e.m||(e=F(a,b,D.dynamic));e.m?(e=e.response,E.routed.forEach(function(c){c(a,b,e)})):(e={status:404},E.error.forEach(function(c){c(a,b,e)}));return e},on:function(a,b){E[a]||(E[a]=[]);E[a].push(b)},
a:function(a,b){var c;b?(c=E[a].indexOf(b),-1<c&&E[a].splice(c,1)):E[a]=[]},init:function(a,b){for(var c in a)a.hasOwnProperty(c)&&"function"===typeof a[c]&&this.router.register(c,a[c]);b&&b(window.location.pathname)}}.service("router");m.history={push:function(a,b){q.history.l&&window.history.pushState(b,"",a)},init:function(){var a=this;a.router.on("routed",function(a,c,d){"history"!==c.source&&m.history.push(a,d.state)});a.router.back=function(){window.history.back()};a.router.forward=function(){window.history.forward()};q.history.l&&(window.onpopstate=function(b){a.router.route(window.location.pathname,{source:"history",state:b.state||{}})});a.init=function(){throw Error("History already started");}}}.service("history");var H;H=function(a,b,c){var d=this;d.name=a;d.config=c;b.forEach(function(a){var b=t("/_rpc/v1/",d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data||{},e:a.e||{},headers:a.headers||{}};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return this.http.post(d,c)}.inject("http")})};m.rpc={o:function(a){var b=a[0];m.rpc[b]=new H(b,a[1],a[2])},init:function(a){a.forEach(m.rpc.o)}}.service("rpc");var J={};m.template={put:function(a,b){"string"===typeof a&&"string"===typeof b&&(J[a]=b)},get:function(a,b){if("string"!==typeof a||"function"!==typeof b.b||"function"!==typeof b.error)throw new TypeError("template.get() requires a filename and CallbackMap.");return J[a]?b.b({data:J[a]}):this.rpc.content.template({data:{path:a}},b)},has:function(a){return!!J[a]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&m.template.put(b,a[b])}}.service("template");var K={};function L(a,b){var c=a.replace(".","/")+".html";m.template.get(c,{b:function(d){var e=[],f,g;if("string"!==typeof d.data)return b(!1,d);f=d.data.replace(/v-component=("|')([\w\.\-]+)\1/g,function(a,b,c){e.push(c);return a});g=e.length;K[a]&&(K[a].options.template=f);m.template.put(c,f);if(0===g)return b();e.forEach(function(a){L(a,function(){g-=1;0===g&&b(f)})})},error:function(a){b(!1,a)}})}
m.view={put:function(a,b){if("string"!==typeof a||"function"!==typeof b)throw new TypeError("services.view.put() takes a string name and constructor.");K[a]=b},get:function(a){if("string"!==typeof a)throw new TypeError("services.view.get() takes a string name.");return K[a]},init:function(a,b){var c=m.view.get(a);if(!c)throw Error("view.init() cannot be called with unregistered view "+a);L(a,function(d){var e,f;document.body.innerHTML="";d&&(c.options.template=d);m.view.put(a,c);d=new c({ready:b,
el:"body"});window.__ROOTVIEW=d;for(e in K)K.hasOwnProperty(e)&&(f=K[e],f.options.template||L(e,function(a){a&&(f.options.template=a);m.view.put(e,f)}))})}}.service("view");window.__VIEWS=K;var M=Vue.extend({});M.extend=function(a){var b=a.viewname.toLowerCase(),c=a.ready;if(!b||"string"!==typeof b)throw Error('View.extend() requires a "viewname" option to be passed.');a.ready=function(){this.$options.handler&&this.$on(this.$options.viewname,this.$options.handler.bind(this));c&&c.call(this)};a=Vue.extend(a);m.view.put(b,a);Vue.component(b,a);return a};M.extend({viewname:"detail",replace:!0,data:{left:null,right:null,leftview:"",rightview:""},methods:{close:function(a){var b=a.target.parentNode,c;b.classList.contains("close")&&(a.preventDefault(),a.stopPropagation(),c=this[b.parentNode.getAttribute("id").split("_").pop()].key,a=this.keys(),c=a.indexOf(c),-1<c&&(c=Math.abs(c-1),a=a[c]?[a[c]]:[]),b.classList.add("transparent"),this.$root.$emit("route","/"+(1<a.length?a.join("/and/"):a[0]||"")))},keys:function(){var a=[];this.left&&a.push(this.left.key);
this.right&&a.push(this.right.key);return a},select:function(a){var b=this,c,d;a&&a.length&&(2<a.length&&(a=a.slice(0,2)),a.forEach(function(a){b.left&&b.left.key===a.key?c=a:b.right&&b.right.key===a.key?d=a:c?d=a:c=a}));a=[];c&&(b.$set("leftview","detail."+c.h.kind.toLowerCase()),a.push(c.key));d&&(b.$set("rightview","detail."+d.h.kind.toLowerCase()),a.push(d.key));b.$set("left",c);b.$set("right",d);b.$parent.$set("map.selected",a);b.$parent.$set("map.changed",!0)}},handler:function(a){this.select(a)}});M.extend({viewname:"modal",methods:{close:function(a){a&&(a.preventDefault(),a.stopPropagation());m.router.back()}}});M.extend({viewname:"detail.legislator",replace:!0,data:{key:null,kind:null,fec_id:"",bioguideid:"",govtrack_id:"",thomas_id:"",osid:"",lismemberid:null,icpsrid:null,fbid:null,twitterid:null,metavidid:null,pvsid:null,firstname:"",lastname:"",gender:"",birthday:"",lastnameenc:"",lastnamealt:null,namemod:null,nickname:null,religion:null},attached:function(){function a(){c.removeEventListener("transitionend",a);c.removeEventListener("webkitTransitionEnd",a);b.classList.remove("v-enter")}var b=this.$el,
c=b.parentNode;c.addEventListener("webkitTransitionEnd",a);c.addEventListener("transitionend",a);b.classList.add("v-enter")}});M.extend({viewname:"layout.header",replace:!0});M.extend({viewname:"layout.stage",replace:!0});M.extend({viewname:"page.login",replace:!0,methods:{login:function(a){a.preventDefault();a.stopPropagation()}},data:{session:null}});M.extend({viewname:"page.map",replace:!0,selectors:{map:"#map",edge:".edge",node:".node",selected:".selected"},data:{map:{selected:[],changed:!1},config:{width:0,height:0,force:{alpha:.75,strength:1,friction:.9,theta:.7,gravity:.1,charge:-600,distance:180},origin:{snap:!1,dynamic:!1,position:null},node:{radius:25,scaleFactor:1.6,classes:["node"]},labels:{enable:!1,distance:0},edge:{width:2,stroke:"#999",classes:["link"]},sprite:{width:60,height:60}},dragging:!1,active:!1},methods:{isNode:function(a){return a.classList.contains("node")},
isEdge:function(a){return a.classList.contains("link")},viewDetail:function(a){var b,c,d;this.dragging||(b=a.target,c=b.id.split("-").pop(),this.isNode(b)&&(a.preventDefault(),a.stopPropagation(),d=this.$.detail.keys(),b.classList.contains(this.$options.selectors.selected.slice(1))?(a=d.indexOf(c),-1<a&&d.splice(a,1)):2>d.length&&(a.shiftKey?d.push(c):d=[c]),this.map.selected=d,this.map.changed=!0,this.$root.$emit("route","/"+(1<d.length?d.join("/and/"):d[0]||""))))},browseTo:function(){console.log("map.browseTo()")},
startDrag:function(){this.dragging=!0},endDrag:function(){this.dragging=!1},draw:function(a){var b=this,c,d,e,f,g,k,v,I;if(a&&!b.map.root)c=b.config,d=b.$options.selectors,e=d3.select(d.map).attr("width",c.width).attr("height",c.height),f=e.selectAll(d.node),g=e.selectAll(d.edge),k=function(){b.config.origin.snap?(a.nodes[a.origin].x=b.config.origin.position.x,a.nodes[a.origin].y=b.config.origin.position.y):b.config.origin.position={x:a.nodes[a.origin].x,y:a.nodes[a.origin].y};g.attr("x1",function(a){return a.source.x-
b.config.node.radius}).attr("y1",function(a){return a.source.y-b.config.node.radius}).attr("x2",function(a){return a.target.x-b.config.node.radius}).attr("y2",function(a){return a.target.y-b.config.node.radius});f.attr("cx",function(a){return a.x-b.config.node.radius}).attr("cy",function(a){return a.y-b.config.node.radius});b.map.changed&&(f.filter(d.selected).filter(function(a){return-1===b.map.selected.indexOf(a.key)}).classed({selected:!1}).transition().duration(150).ease("cubic").attr("r",c.node.radius),
f.filter(function(a){return-1<b.map.selected.indexOf(a.key)}).classed({selected:!0}).transition().duration(150).ease("cubic").attr("r",c.node.radius*c.node.scaleFactor),b.map.changed=!1,b.map.force.start())},v=d3.layout.force().size([c.width,c.height]).linkDistance(c.force.distance).linkStrength(c.force.strength).friction(c.force.friction).theta(c.force.theta).gravity(c.force.gravity).alpha(c.force.alpha).charge(function(a){return-1<b.map.selected.indexOf(a.key)?c.force.charge*Math.pow(c.node.scaleFactor,
2):c.force.charge}).on("tick",k),I=function(){var d=a.nodes,e=a.edges;v.nodes(d).links(e).start();g=g.data(e,function(a){return a.key});g.n().remove();g.enter().insert("line",".node").attr("id",function(a){return"edge-"+a.key}).attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("stroke-width",c.edge.width).attr("stroke",c.edge.stroke).attr("class",c.edge.classes);f=f.data(d,function(a){return a.key});
f.n().remove();f.enter().append("svg:circle").attr("id",function(a){return"node-"+a.key}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",c.node.radius).attr("width",c.sprite.width).attr("height",c.sprite.height).attr("class",function(a){-1<b.map.selected.indexOf(a.key)&&(b.map.changed=!0);return a.classes.join(" ")}).call(v.drag);f.filter(function(b){return b.key===a.q});b.map.changed&&v.start()},b.map.root=e,b.map.force=v,this.$root.nextTick(function(){I()});else return b.map.root=
null,h(b.$options.selectors.map).innerHTML="",b.draw(a)},resize:function(){var a=this.$el.clientWidth,b=this.$el.clientHeight;this.config.width=a;this.config.height=b;this.map.root&&this.map.root.attr("width",a).attr("height",b);this.config.origin.snap&&(this.config.origin.position={x:a/2,y:b/2});this.map.force.size([a,b]).resume()}},ready:function(){var a=this.$options.selectors.map;this.$watch("active",function(b){b&&h(a).classList.remove("transparent")});this.resize=this.resize.bind(this);window.addEventListener("resize",
this.resize)},beforeDestroy:function(){window.removeEventListener("resize",this.resize)},handler:function(a){var b=this.$el.clientWidth,c=this.$el.clientHeight;this.config.width=b;this.config.height=c;this.config.origin.snap&&(this.config.origin.position=this.config.origin.position||{},this.config.origin.position={x:b/2,y:c/2});a?(this.active=!0,this.draw(a)):(this.map.changed=!0,this.map.force&&this.map.force.start())}});var N=Vue.extend({data:{page:{active:!1},modal:null},methods:{route:function(a){var b;a.target&&a.target.hasAttribute("data-route")&&(b=a.target.getAttribute("href"),a.preventDefault(),a.stopPropagation());b&&this.$emit("route",b)},nextTick:function(a){return Vue.nextTick(a)}},ready:function(){this.$on("route",function(a,b){m.router.route(a,b)})}});m.view.put("app",N);var O,P,Q;O=[];P=function(){var a=O;O=null;a.forEach(function(a){a()})};
Q=function(a,b,c){var d=this;d.r=a;d.session=null;a.session&&a.session.established&&(d.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&d.rpc.init(a.services);a.template.manifest&&d.template.init(a.template.manifest);d.data.init(b,function(a){d.graph.init(a)});d.router.init(c,function(a){Q.ready(function(){d.history.init();if(a)return d.router.route(a)})});d.view.init("app",function(){this.$set("active",!0);this.$.c.$set("active",!0);n.register("app",this);P()});return this}.service("catnip");
Q.ready=function(a){if(!(a instanceof Function))throw new TypeError("catnip.ready() expects a function.");if(!O)return a();O.push(a)};window.catnip_beta=Q(l.context,l.data,{"/":function(a){a=a.state||{};var b=this.a,c=b.$.c&&b.$.c.$.map.active?null:this.graph.g();a.page=a.page||{active:!0};a.modal=a.modal||null;b.$set("page",a.page);b.$set("modal",a.modal);b.nextTick(function(){b.$broadcast("page.map",c);b.$broadcast("detail")});return a},"/login":function(a){a=a.state||{};a.page=null;a.modal=a.modal||{viewname:"page.login",data:{session:this.s.session}};this.a.$set("modal",a.modal);this.a.$set("page",a.page);this.a.$.c&&(this.a.$.c.$.map.active=
!1);return a},"/settings":function(){},"/404":function(){},"/<key>":function(a){var b=this.data,c=this.a,d=a.args.key;a=a.state||{};var e=c.$.c&&c.$.c.$.map.active?null:this.graph.g();a.page=a.page||{active:!0};a.modal=a.modal||null;c.$set("page",a.page);c.$set("modal",a.modal);c.nextTick(function(){c.$broadcast("page.map",e);b.get(d,{b:function(a){c.$broadcast("detail",[a])},error:function(a){c.$emit("route","/404",{error:a})}})});return a},"/<key1>/and/<key2>":function(a){var b=this.data,c=this.a,
d=a.args.w,e=a.args.A;a=a.state||{};var f=c.$.c&&c.$.c.$.map.active?null:this.graph.g();a.page=a.page||{active:!0};a.modal=a.modal||null;c.$set("page",a.page);c.$set("modal",a.modal);c.nextTick(function(){c.$broadcast("page.map",f);b.getAll([d,e],{b:function(a){c.$broadcast("detail",a)},error:function(a){c.$emit("route","/404",{error:a})}})});return a}});})();

//# sourceMappingURL=../../../../.develop/maps/fatcatmap/assets/js/app.min.js.map