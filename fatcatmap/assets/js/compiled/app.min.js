(function() {var h={"/":function(){},"/login":function(){},"/settings":function(){},"/dev":function(){},"/404":function(){},"/<key>":function(){},"/<key1>/and/<key2>":function(){}};function k(){return"#js-context".querySelector?"#js-context":document.getElementById("#js-context".slice(1));throw new TypeError("Invalid document query string.");};var l={i:navigator.cookieEnabled,l:2==window.devicePixelRatio,r:!!window.Worker,m:!!window.SharedWorker,n:!!window.WebSocket,o:!!window.b,j:!!navigator.geolocation,q:0<navigator.b,history:{d:!!window.history.pushState,hash:!!window.onhashchange},storage:{local:!!window.localStorage,session:!!window.sessionStorage,k:!!window.IDBFactory}};function m(a,c){var d=!0;-1===a.indexOf("?")&&(a+="?",d=!1);for(var e in c)c.hasOwnProperty(e)&&(!0===d?a+="&":d=!0,a+=encodeURIComponent(e)+"="+encodeURIComponent(c[e]));return a}function n(a){var c=Array.prototype.slice.call(arguments),d=c.shift(),e=[];if(!c.length)return d;"/"===d.charAt(d.length-1)&&(d=d.slice(0,-1));for(e.push(d);c.length;)if(d=c.shift())"/"===d.charAt(0)&&(d=d.slice(1)),"/"===d.charAt(d.length-1)&&(d=d.slice(0,-1)),e.push(d);return e.join("/")};var s={},t,v,w,x;t=/^([^:]+):\s*/;v=function(a,c,d){var e=new XMLHttpRequest,g;c.c?g=m(c.url,c.c):"string"!==typeof c?g=c.url:g=c;e.open(a.toUpperCase(),g,!!d);if(c.headers){a=c.headers;for(var f in a)a.hasOwnProperty(f)&&e.setRequestHeader(f,a[f])}e.data=c.data;d?(e.onerror=d.error,e.onloadend=function(){e.responseJSON=x(e);d.p(e.responseJSON)}):(e.onerror=function(a){e.error=a},e.onloadend=function(){e.responseJSON=x(e)});return e};
w=function(a,c,d){var e="object"===typeof c.data?JSON.stringify(c.data):"string"===typeof c.data?c.data:null==c.data?null:""+c.data;c=v(a,c,d);c.send(e);return c};x=function(a){var c={},d=a.getAllResponseHeaders().split("\n");try{c.data=JSON.parse(a.responseText)}catch(e){c.data=a.responseText||""}c.headers={};for(var g=0;g<d.length;g++)d[g]&&(a=d[g].split(t),c.headers[a[1]]=a[2]);return c};
s.http={get:function(a,c){return w("GET",a,c)},delete:function(a,c){return w("DELETE",a,c)},head:function(a,c){return w("HEAD",a,c)},post:function(a,c){return w("POST",a,c)},put:function(a,c){return w("PUT",a,c)},patch:function(a,c){return w("PATCH",a,c)},options:function(a,c){return w("OPTIONS",a,c)}};var y;y=function(a,c,d){var e=this;e.name=a;e.b=d;c.forEach(function(a){var c=n("/_rpc/v1/",e.name+"."+a);e[a]=function(a,e){var d={url:c,headers:a.headers||{},data:a};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return s.http.post(d,e)}})};s.rpc={factory:function(a){var c=a[0];s.rpc[c]=new y(c,a[1],a[2]);return s.rpc},init:function(a){a.forEach(s.rpc.factory)}};var z;z=function(){var a=/^[0-9]+$/,c,d;c=function(a){return"string"===typeof a?a:null==a?"":"object"===typeof a?JSON.stringify(a):String(a)};d=function(c){var d=c.charAt(0);return"{"===d||"["===d?JSON.parse(c):c?"true"===c||"false"===c?Boolean(c):a.test(c)?+c:c:null};return function(a){this.get=function(c){return d(a.getItem(c))};this.put=function(d,f){a.setItem(d,c(f))}}}();s.storage={};s.storage.local=l.storage.local?new z(window.localStorage):null;
s.storage.session=l.storage.session?new z(window.sessionStorage):null;function A(){}A.prototype=s;function B(a){return function(){return a.apply(new A,arguments)}}Object.defineProperty(Object.prototype,"service",{value:function(a){var c;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var d in this)this.hasOwnProperty(d)&&(c=this[d],c instanceof Function&&(this[d]=B(c)));A.prototype[a]=this;return A.prototype[a]}});s.data={};A.prototype.data=B({normalize:function(){}});s.b={};A.prototype.graph=B({init:function(a){return this.b.construct(this.data.normalize(a))},construct:function(){}});s.map={};A.prototype.map=B({draw:function(){}});s.a={};var C=/\/<(\w+)>/,D=[],E=[],F={route:[],h:[],error:[]},G;G=function(a,c){var d=this;d.keys=[];d.id=a.replace(C,function(a,c,f){d.keys.push(f);return"/(\\w+)"});d.e=new RegExp(d.id);d.f=c;d.g=0<d.keys.length};
A.prototype.router=B({register:function(a,c){var d=!1,e,g,f,r;if(c||"object"!==typeof a)if(e=new G(a,c),f=e.g?D:E,f.length){for(r=0;r<f.length;r++)if(g=f[r],!(g.id<e.id)){f.splice(r,0,e);d=!0;break}!1===d&&f.push(e)}else f.push(e);else for(e in a)this.a.register(e,a[e])},route:function(a,c){var d=!1,e,g,f;c=c||{};c.c=c.c||{};F.route.forEach(function(d){d(a,c)});e=function(){function e(d){d(a,c,p)}function f(a,d){c.c[q.keys[d]]=a}for(var u=0,q,p;(q=g[u++])&&q.id<a;)if(q.e.test(a))return d=!0,u=a.match(q.e).slice(1),
u.forEach(f),p=q.f(c),F.h.forEach(e),404===p.status?(p.path=a,this.a.route("/404",p)):p};g=D;f=e();if(d)return f;g=E;f=e();if(d)return f;f={status:404};F.error.forEach(function(d){d(a,c,f)});return f},on:function(a,c){F[a]||(F[a]=[]);F[a].push(c)},off:function(a,c){var d;c?(d=F[a].indexOf(c),-1<d&&F[a].splice(d,1)):F[a]=[]}});s.history={};A.prototype.history=B({push:l.history.d?function(a,c){window.history.pushState(c,"",a)}:function(){},start:function(){var a=this;a.a.on("routed",function(c,d){"history"!==d.source&&a.push(c,d.state)});l.history.d&&(window.onpopstate=function(c){a.a.route(window.location.pathname,{source:"history",state:c.state||{}})});a.start=function(){throw Error("History already started");}}});window.catnip_beta=B(function(){var a=JSON.parse(k().textContent);a.services&&this.rpc.init(a.services);this.session=a.session&&a.session.established?a.session.payload:{};this.a.register(h);this.history.start();return this})();})();
