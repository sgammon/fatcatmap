(function() {var g={"/":function(){},"/login":function(){},"/settings":function(){},"/dev":function(){},"/404":function(){},"/<key>":function(){},"/<key1>/and/<key2>":function(){}};function h(a){if(a&&a.querySelector)return a;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=document.querySelectorAll(a);var b=[],c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var k={context:JSON.parse(h("#js-context").textContent||"{}"),data:JSON.parse(h("#js-data").textContent||"{}")};var l={i:navigator.cookieEnabled,l:2==window.devicePixelRatio,r:!!window.Worker,m:!!window.SharedWorker,n:!!window.WebSocket,o:!!window.EventSource,j:!!navigator.geolocation,q:0<navigator.maxTouchPoints,history:{c:!!window.history.pushState,hash:!!window.onhashchange},storage:{local:!!window.localStorage,session:!!window.sessionStorage,k:!!window.IDBFactory}};function q(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function r(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};var t={},u,v,w,x;u=/^([^:]+):\s*/;v=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.a?q(b.url,b.a):b.url,!!c);if(b.headers){a=b.headers;for(var f in a)a.hasOwnProperty(f)&&d.setRequestHeader(f,a[f])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=x(d);c.p(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=x(d)});return d};
w=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=v(a,b,c);a.send(d);return a};x=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var f=0;f<c.length;f++)c[f]&&(a=c[f].split(u),b.headers[a[1]]=a[2]);return b};
t.http={get:function(a,b){return w("GET",a,b)},delete:function(a,b){return w("DELETE",a,b)},head:function(a,b){return w("HEAD",a,b)},post:function(a,b){return w("POST",a,b)},put:function(a,b){return w("PUT",a,b)},patch:function(a,b){return w("PATCH",a,b)},options:function(a,b){return w("OPTIONS",a,b)}};var y="/_rpc/v1/",z;z=function(a,b,c){var d=this;d.name=a;d.e=c;b.forEach(function(a){var b=r(y,d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data,a:a.a,headers:a.headers};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return t.http.post(d,c)}})};t.rpc={factory:function(a){var b=a[0];t.rpc[b]=new z(b,a[1],a[2])},init:function(a,b){b&&"string"===typeof b&&(y=b);a.forEach(t.rpc.factory)}};var A,B=/^[0-9]+$/;function C(a){return"string"===typeof a?a:null==a?"":"object"===typeof a?JSON.stringify(a):String(a)}A=function(a){this.get=function(b){b=a.getItem(b)||"";var c=b.charAt(0);return"{"===c||"["===c?JSON.parse(b):b?"true"===b||"false"===b?Boolean(b):B.test(b)?+b:b:""===b?b:null};this.put=function(b,c){a.setItem(b,C(c))}};t.storage={local:l.storage.local?new A(window.localStorage):null,session:l.storage.session?new A(window.sessionStorage):null};function D(){}D.prototype=t;Function.prototype.client=function(){var a=this;return function(){return a.apply(new D,arguments)}};Function.prototype.service=function(a){D.prototype[a]=this.client();return D.prototype[a]};
Object.defineProperty(Object.prototype,"service",{value:function(a){var b;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var c in this)this.hasOwnProperty(c)&&(b=this[c],b instanceof Function&&(this[c]=b.client()));D.prototype[a]=this;return D.prototype[a]}});t.data={};var E={normalize:function(){}}.service("data");t.graph={};var F={init:function(a){return F.construct(E.normalize(a))},construct:function(){return{}}}.service("graph");t.e={};({draw:function(){}}).service("map");t.b={};var G=/\/<(\w+)>/,H=[],I=[],J={route:[],h:[],error:[]},K,L;K=function(a,b){var c=this;c.keys=[];c.id=a.replace(G,function(a,b,e){c.keys.push(e);return"/(\\w+)"});c.d=new RegExp(c.id);c.f=b;c.g=0===c.keys.length};
L={register:function(a,b){var c=!1,d,f,e,p;d=new K(a,b);e=d.g?H:I;if(e.length){for(p=0;p<e.length;p++)if(f=e[p],!(f.id<d.id)){e.splice(p,0,d);c=!0;break}!1===c&&e.push(d)}else e.push(d)},route:function(a,b){var c=!1,d,f,e;b=b||{};b.a=b.a||{};J.route.forEach(function(c){c(a,b)});d=function(){function d(c){c(a,b,m)}function e(a,c){b.a[n.keys[c]]=a}for(var s=0,n,m;(n=f[s++])&&n.id<a;)if(n.d.test(a))return c=!0,s=a.match(n.d).slice(1),s.forEach(e),m=n.f(b),J.h.forEach(d),404===m.status?(m.path=a,L.route("/404",
m)):m};f=H;e=d();if(c)return e;f=I;e=d();if(c)return e;e={status:404};J.error.forEach(function(c){c(a,b,e)});return e},on:function(a,b){J[a]||(J[a]=[]);J[a].push(b)},off:function(a,b){var c;b?(c=J[a].indexOf(b),-1<c&&J[a].splice(c,1)):J[a]=[]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"function"===typeof a[b]&&L.register(b,a[b])}}.service("router");t.history={};({push:l.history.c?function(a,b){window.history.pushState(b,"",a)}:function(){},start:function(){var a=this;a.b.on("routed",function(b,c){"history"!==c.source&&a.push(b,c.state)});l.history.c&&(window.onpopstate=function(b){a.b.route(window.location.pathname,{source:"history",state:b.state||{}})});a.start=function(){throw Error("History already started");}}}).service("history");var M=function(a,b){this._context=a;this.session=null;a.session&&a.session.established&&(this.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&this.rpc.init(a.services,a.protocol.rpc.host);this.b.init(g);this.history.start();this.graph.init(b);return this}.client();window.catnip_beta=M(k.context,k.data);})();
