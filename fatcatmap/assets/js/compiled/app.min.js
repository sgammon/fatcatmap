(function() {function f(a){if(a&&a.querySelector)return a;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=document.querySelectorAll(a);var b=[],c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var k={context:JSON.parse(f("#js-context").textContent||"{}"),data:JSON.parse(f("#js-data").textContent||"{}")};var l={};function m(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}m.prototype=l;Object.defineProperty(Function.prototype,"client",{value:function(a){var b=this;return function(){return b.apply(new m(a),arguments)}}});Object.defineProperty(Function.prototype,"service",{value:function(a,b){m.prototype[a]=this.client(b);return m.prototype[a]}});
Object.defineProperty(Object.prototype,"service",{value:function(a){var b;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var c in this)this.hasOwnProperty(c)&&(b=this[c],b instanceof Function&&(this[c]=b.client()));m.prototype[a]=this;return m.prototype[a]}});var n={k:navigator.cookieEnabled,n:2==window.devicePixelRatio,t:!!window.Worker,o:!!window.SharedWorker,p:!!window.WebSocket,q:!!window.EventSource,geo:!!navigator.geolocation,s:0<navigator.maxTouchPoints,history:{e:!!window.history.pushState,hash:!!window.onhashchange},r:{local:!!window.localStorage,session:!!window.sessionStorage,m:!!window.IDBFactory}};function p(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function q(a){var b={};a=a.split("?").pop().split("&");for(var c,d,e=0;e<a.length;e++)c=a[e].split("="),d=unescape(c[1]),b[c[0]]="true"===d||"false"===d?Boolean(d):/^\d*$/.test(d)?+d:d;return b}
function r(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};l.data={init:function(){this.a={}},normalize:function(a){if("string"===typeof a)try{a=JSON.parse(a)}catch(b){a={}}return a},watch:function(a,b,c){if(!a)throw Error("services.data.watch() requires a string key.");if(!c){if("function"!==typeof b)throw Error("services.data.watch() requires a watcher function.");c=b;b=null}this.a[a]||(this.a[a]=[]);this.a[a].push(b?c.bind(b):function(a){c.call(a,a)})},unwatch:function(a,b){var c,d;if(this.a[a]){c=this.a[a];if(b)for(d=0;d<c.length;d++){if(b===c[d]){c.splice(d,
1);break}}else c=[];this.a[a]=c}}}.service("data");l.graph={init:function(a){return this.graph.h(this.data.normalize(a))},h:function(a){return a}}.service("graph");l.map={a:function(){}}.service("map");var s,t,u;s=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.b?p(b.url,b.b):b.url,!!c);if(b.headers){a=b.headers;for(var e in a)a.hasOwnProperty(e)&&d.setRequestHeader(e,a[e])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=u(d);c.success(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=u(d)});return d};
t=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=s(a,b,c);a.send(d);return a};u=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var e=0;e<c.length;e++)c[e]&&(a=c[e].split(/^([^:]+):\s*/),b.headers[a[1]]=a[2]);return b};
l.http={get:function(a,b){return t("GET",a,b)},delete:function(a,b){return t("DELETE",a,b)},head:function(a,b){return t("HEAD",a,b)},post:function(a,b){return t("POST",a,b)},put:function(a,b){return t("PUT",a,b)},a:function(a,b){return t("PATCH",a,b)},options:function(a,b){return t("OPTIONS",a,b)}}.service("http");var v=[],w=[],x={route:[],routed:[],error:[]},y,z;y=function(a,b,c){function d(a,c){b.args[g.keys[c]]=a}for(var e=0,g,h,B;(g=c[e++])&&g.id<=a;)if(g.a.test(a)){h=!0;a=a.match(g.a).slice(1);a.forEach(d);B=g.d.call(new m,b);break}return{f:h,response:B}};z=function(a,b){var c=this;c.keys=[];c.id=a.replace(/\/<(\w+)>/,function(a,b,g){c.keys.push(g);return"/(\\w+)"});c.a=new RegExp("^"+c.id+"$");c.d=b;c.j=0===c.keys.length};
l.router={register:function(a,b){var c=!1,d,e,g,h;d=new z(a,b);g=d.j?v:w;if(g.length){for(h=0;h<g.length;h++)if(e=g[h],!(e.id<d.id)){g.splice(h,0,d);c=!0;break}!1===c&&g.push(d)}else g.push(d)},route:function(a,b){var c,d,e;b=b||{};b.args={};b.b=b.b||{};c=q(a);for(d in c)c.hasOwnProperty(d)&&(b.b[d]=c[d]);x.route.forEach(function(c){c(a,b)});e=y(a,b,v);if(e.f)return e=e.response,x.routed.forEach(function(c){c(a,b,e)}),e;e=y(a,b,w);if(e.f)return e=e.response,x.routed.forEach(function(c){c(a,b,e)}),
e;e={status:404};x.error.forEach(function(c){c(a,b,e)});return e},on:function(a,b){x[a]||(x[a]=[]);x[a].push(b)},a:function(a,b){var c;b?(c=x[a].indexOf(b),-1<c&&x[a].splice(c,1)):x[a]=[]},init:function(a,b){for(var c in a)a.hasOwnProperty(c)&&"function"===typeof a[c]&&this.router.register(c,a[c]);b&&b(window.location.pathname.split("?").shift())}}.service("router");l.history={push:n.history.e?function(a,b){window.history.pushState(b,"",a)}:function(){},init:function(){var a=this;a.router.on("routed",function(a,c){"history"!==c.source&&l.history.push(a,c.state)});n.history.e&&(window.onpopstate=function(b){a.router.route(window.location.pathname,{source:"history",state:b.state||{}})});a.init=function(){throw Error("History already started");}}}.service("history");var A;A=function(a,b,c){var d=this;d.name=a;d.config=c;b.forEach(function(a){var b=r("/_rpc/v1/",d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data||{},b:a.b||{},headers:a.headers||{}};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return this.http.post(d,c)}.client()})};l.rpc={i:function(a){var b=a[0];l.rpc[b]=new A(b,a[1],a[2])},init:function(a){a.forEach(l.rpc.i)}}.service("rpc");var C={};l.template={put:function(a,b){"string"===typeof a&&"string"===typeof b&&(C[a]=b)},get:function(a,b){if("string"!==typeof a||"function"!==typeof b.success||"function"!==typeof b.error)throw new TypeError("template.get() requires a filename and CallbackMap.");return C[a]?b.success({data:C[a]}):this.rpc.content.template({data:{path:a}},b)},has:function(a){return!!C[a]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&l.template.put(b,a[b])}}.service("template");var D={};function E(a,b){var c=a.replace(".","/")+".html";l.template.get(c,{success:function(d){var e=[],g,h;if("string"!==typeof d.data)return b(!1,d);g=d.data.replace(/v-component=("|')(\w+)\1/g,function(a,b,c){e.push(c);return a});h=e.length;D[a]&&(D[a].options.template=g);l.template.put(c,g);if(0===h)return b();e.forEach(function(a){E(a,function(){h-=1;0===h&&b(g)})})},error:function(a){b(!1,a)}})}
l.view={put:function(a,b){if("string"!==typeof a||"function"!==typeof b)throw new TypeError("services.view.put() takes a string name and constructor.");return D[a]=b},get:function(a){if("string"!==typeof a)throw new TypeError("services.view.get() takes a string name.");return D[a]},init:function(a,b){var c=l.view.get(a);if(!c)throw Error("view.init() cannot be called with unregistered view "+a);E(a,function(d){document.body.innerHTML="";d&&(c.options.template=d);l.view.put(a,c);d=new c({ready:b,el:"body"});
window.__ROOTVIEW=d})}}.service("view");window.__VIEWS=D;var F=Vue.extend({});F.extend=function(a){var b=a.viewname.toLowerCase(),c;if(!b||"string"!==typeof b)throw Error('AppView.extend() requires a "viewname" option to be passed.');a.ready&&(c=a.ready);a.ready=function(){this.$options.d&&this.$on(this.$options.viewname,this.$options.d.bind(this));c&&c.call(this)};a=Vue.extend(a);l.view.put(b,a);Vue.component(b,a);return a};F.extend({viewname:"header",replace:!0});F.extend({viewname:"modal",data:{active:!1,message:""}});F.extend({viewname:"stage",replace:!0,data:{active:!0}});var G=Vue.extend({data:{page:"",active:!1,modal:null},methods:{route:function(a){if(a.target.hasAttribute("data-route")){var b=a.target.getAttribute("href");a.preventDefault();a.stopPropagation();l.router.route(b)}}}});l.view.put("page",G);var H,I,J;H=[];I=function(){var a=H;H=null;a.forEach(function(a){a()})};
J=l.c={init:function(a,b,c){var d=this;d.l=a;d.session=null;d.g=null;a.session&&a.session.established&&(d.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&d.rpc.init(a.services);a.template.manifest&&d.template.init(a.template.manifest);d.view.init("page",function(){this.$set("active",!0);l.c.g=this;I()});d.router.init(c,function(a){d.c.ready(function(){d.history.init();if(a)return d.router.route(a)})});l.c.init=function(){return d};return this},ready:function(a){if(a){if(!H)return a();
H.push(a)}}}.service("catnip");window.catnip_beta=J.init(k.context,k.data);})();
