(function() {var e={"/":function(){},"/login":function(){},"/settings":function(){},"/dev":function(){},"/404":function(){},"/<key>":function(){},"/<key1>/and/<key2>":function(){}};function h(a){if(a&&a.querySelector)return a;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=document.querySelectorAll(a);var b=[],c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var k={context:JSON.parse(h("#js-context").textContent||"{}"),data:JSON.parse(h("#js-data").textContent||"{}")};var m={k:navigator.cookieEnabled,n:2==window.devicePixelRatio,s:!!window.Worker,o:!!window.SharedWorker,p:!!window.WebSocket,q:!!window.EventSource,l:!!navigator.geolocation,r:0<navigator.maxTouchPoints,history:{f:!!window.history.pushState,hash:!!window.onhashchange},storage:{local:!!window.localStorage,session:!!window.sessionStorage,m:!!window.IDBFactory}};function n(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function p(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};var q={},r,s,t;r=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.b?n(b.url,b.b):b.url,!!c);if(b.headers){a=b.headers;for(var g in a)a.hasOwnProperty(g)&&d.setRequestHeader(g,a[g])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=t(d);c.d(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=t(d)});return d};
s=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=r(a,b,c);a.send(d);return a};t=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var g=0;g<c.length;g++)c[g]&&(a=c[g].split(/^([^:]+):\s*/),b.headers[a[1]]=a[2]);return b};
q.http={get:function(a,b){return s("GET",a,b)},delete:function(a,b){return s("DELETE",a,b)},head:function(a,b){return s("HEAD",a,b)},post:function(a,b){return s("POST",a,b)},put:function(a,b){return s("PUT",a,b)},patch:function(a,b){return s("PATCH",a,b)},options:function(a,b){return s("OPTIONS",a,b)}};var u;u=function(a,b,c){var d=this;d.name=a;d.config=c;b.forEach(function(a){var b=p("/_rpc/v1/",d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data||{},b:a.b||{},headers:a.headers||{}};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return q.http.post(d,c)}})};q.rpc={factory:function(a){var b=a[0];q.rpc[b]=new u(b,a[1],a[2])},init:function(a){a.forEach(q.rpc.factory)}};var v,w,x;w=function(a){return"string"===typeof a?a:null==a?"":"object"===typeof a?JSON.stringify(a):String(a)};x=function(a){var b=a.charAt(0);return"{"===b||"["===b?JSON.parse(a):a?"true"===a||"false"===a?Boolean(a):/^[0-9]+$/.test(a)?+a:a:""===a?a:null};v=function(a){this.get=function(b){return x(a.getItem(b)||"")};this.put=function(b,c){a.setItem(b,w(c))}};q.storage={local:m.storage.local?new v(window.localStorage):null,session:m.storage.session?new v(window.sessionStorage):null};function z(){}z.prototype=q;Function.prototype.client=function(){var a=this;return function(){return a.apply(new z,arguments)}};Function.prototype.service=function(a){z.prototype[a]=this.client();return z.prototype[a]};
Object.defineProperty(Object.prototype,"service",{value:function(a){var b;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var c in this)this.hasOwnProperty(c)&&(b=this[c],b instanceof Function&&(this[c]=b.client()));z.prototype[a]=this;return z.prototype[a]}});q.data={normalize:function(){}}.service("data");q.graph={init:function(a){return this.graph.construct(this.data.normalize(a))},construct:function(){return{}}}.service("graph");q.map={draw:function(){}}.service("map");var A={};q.template={put:function(a,b){"string"===typeof a&&"string"===typeof b&&(A[a]=b)},get:function(a,b){if("string"!==typeof a||"function"!==typeof b.d||"function"!==typeof b.error)throw new TypeError("template.get() requires a filename and CallbackMap.");return A[a]?b.d({data:A[a]}):this.rpc.content.template({data:{path:a}},b)},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&q.template.put(b,a[b])}}.service("template");var B={};q.view={register:function(a,b){if("string"!==typeof a||"function"!==typeof b)throw new TypeError("services.view.register() takes a string name and constructor.");return B[a]=b},get:function(a){if("string"!==typeof a)throw new TypeError("services.view.register() takes a string name.");return B[a]}}.service("view");var C=Vue.extend({});C.a=function(a){var b=a.viewname;if(!b||"string"!==typeof b)throw Error('AppView.extend() requires a "viewName" to be passed as an option.');return q.view.register(b,Vue.component(b,Vue.extend(a)))};C.a({viewname:"header"});C.a({viewname:"stage"});var D=C.a({viewname:"container",children:["header","stage"]});q.c={};var E=[],F=[],G={route:[],h:[],error:[]},H,I,J;H=function(a,b,c){function d(a,c){b.b[f.keys[c]]=a}for(var g=0,f,l,y;(f=c[g++])&&f.id<=a;)if(f.a.test(a)){l=!0;a=a.match(f.a).slice(1);a.forEach(d);y=f.i(b);break}return{g:l,response:y}};I=function(a,b){var c=this;c.keys=[];c.id=a.replace(/\/<(\w+)>/,function(a,b,f){c.keys.push(f);return"/(\\w+)"});c.a=new RegExp("^"+c.id+"$");c.i=b;c.j=0===c.keys.length};
J={register:function(a,b){var c=!1,d,g,f,l;d=new I(a,b);f=d.j?E:F;if(f.length){for(l=0;l<f.length;l++)if(g=f[l],!(g.id<d.id)){f.splice(l,0,d);c=!0;break}!1===c&&f.push(d)}else f.push(d)},route:function(a,b){var c;b=b||{};b.b=b.b||{};G.route.forEach(function(c){c(a,b)});c=H(a,b,E);if(c.g)return c=c.response,G.h.forEach(function(d){d(a,b,c)}),c;c=H(a,b,F);if(c.g)return c=c.response,G.h.forEach(function(d){d(a,b,c)}),c;c={status:404};G.error.forEach(function(d){d(a,b,c)});return c},on:function(a,b){G[a]||
(G[a]=[]);G[a].push(b)},off:function(a,b){var c;b?(c=G[a].indexOf(b),-1<c&&G[a].splice(c,1)):G[a]=[]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"function"===typeof a[b]&&J.register(b,a[b])}}.service("router");q.history={push:m.history.f?function(a,b){window.history.pushState(b,"",a)}:function(){},start:function(){var a=this;a.c.on("routed",function(a,c){"history"!==c.source&&q.history.push(a,c.state)});m.history.f&&(window.onpopstate=function(b){a.c.route(window.location.pathname,{source:"history",state:b.state||{}})});a.start=function(){throw Error("History already started");}}}.service("history");var K=function(a,b){var c=this;c._context=a;c.session=null;a.session&&a.session.established&&(c.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&c.rpc.init(a.services);a.template.manifest&&c.template.init(a.template.manifest);c.c.init(e);c.history.start();c.graph.init(b);c.template.get("container.html",{d:function(a){c.c.register("/beta",function(){if(!c.e){c.e=new D({template:a.data});debugger;h("body")[0].innerHTML="";debugger;c.e.$appendTo(h("body")[0])}})},error:function(a){throw a;
}});return this}.client();window.catnip_beta=K(k.context,k.data);})();
