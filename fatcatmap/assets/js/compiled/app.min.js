(function() {var e={"/":function(){this.a.c.$set("page.route","/");return null},"/login":function(){},"/settings":function(){},"/beta":function(){this.a.c.$set("page.route","/beta");return null},"/404":function(){},"/<key>":function(){},"/<key1>/and/<key2>":function(){}};function k(a){if(a&&a.querySelector)return a;if("string"===typeof a){if("#"===a.charAt(0))a=document.getElementById(a.slice(1));else{a=document.querySelectorAll(a);var b=[],c;for(c=0;c<a.length;b.push(a[c++]));a=b}return a}throw new TypeError("Invalid document query string.");};var l={i:JSON.parse(k("#js-context").textContent||"{}"),data:JSON.parse(k("#js-data").textContent||"{}")};var m={};function n(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}n.prototype=m;Function.prototype.client=function(a){var b=this;return function(){return b.apply(new n(a),arguments)}};Function.prototype.service=function(a,b){n.prototype[a]=this.client(b);return n.prototype[a]};
Object.defineProperty(Object.prototype,"service",{value:function(a){var b;if(!a||"string"!==typeof a)throw new TypeError("service() requires a string name.");if(this.constructor!==Object)throw Error("service() can only be invoked on native objects.");for(var c in this)this.hasOwnProperty(c)&&(b=this[c],b instanceof Function&&(this[c]=b.client()));n.prototype[a]=this;return n.prototype[a]}});var p={n:navigator.cookieEnabled,q:2==window.devicePixelRatio,w:!!window.Worker,r:!!window.SharedWorker,s:!!window.WebSocket,t:!!window.EventSource,o:!!navigator.geolocation,v:0<navigator.maxTouchPoints,history:{f:!!window.history.pushState,hash:!!window.onhashchange},u:{local:!!window.localStorage,session:!!window.sessionStorage,p:!!window.IDBFactory}};function q(a,b){var c=!0;-1===a.indexOf("?")&&(a+="?",c=!1);for(var d in b)b.hasOwnProperty(d)&&(!0===c?a+="&":c=!0,a+=encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a}function r(a){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=[];if(!b.length)return c;"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1));for(d.push(c);b.length;)if(c=b.shift())"/"===c.charAt(0)&&(c=c.slice(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.push(c);return d.join("/")};m.data={normalize:function(a){if("string"===typeof a)try{a=JSON.parse(a)}catch(b){a={}}return a}}.service("data");m.graph={init:function(a){return this.graph.h(this.data.normalize(a))},h:function(a){return a}}.service("graph");m.map={a:function(){}}.service("map");var s,t,u;s=function(a,b,c){var d=new XMLHttpRequest;d.open(a.toUpperCase(),b.b?q(b.url,b.b):b.url,!!c);if(b.headers){a=b.headers;for(var g in a)a.hasOwnProperty(g)&&d.setRequestHeader(g,a[g])}d.data=b.data;c?(d.onerror=c.error,d.onloadend=function(){d.responseJSON=u(d);c.d(d.responseJSON)}):(d.onerror=function(a){d.error=a},d.onloadend=function(){d.responseJSON=u(d)});return d};
t=function(a,b,c){var d="object"===typeof b.data?JSON.stringify(b.data):"string"===typeof b.data?b.data:null==b.data?null:""+b.data;a=s(a,b,c);a.send(d);return a};u=function(a){var b={},c=a.getAllResponseHeaders().split("\n");try{b.data=JSON.parse(a.responseText)}catch(d){b.data=a.responseText||""}b.headers={};for(var g=0;g<c.length;g++)c[g]&&(a=c[g].split(/^([^:]+):\s*/),b.headers[a[1]]=a[2]);return b};
m.http={get:function(a,b){return t("GET",a,b)},delete:function(a,b){return t("DELETE",a,b)},head:function(a,b){return t("HEAD",a,b)},l:function(a,b){return t("POST",a,b)},put:function(a,b){return t("PUT",a,b)},a:function(a,b){return t("PATCH",a,b)},options:function(a,b){return t("OPTIONS",a,b)}}.service("http");var v=[],w=[],x={route:[],routed:[],error:[]},y,z;y=function(a,b,c){function d(a,c){b.b[f.keys[c]]=a}for(var g=0,f,h,B;(f=c[g++])&&f.id<=a;)if(f.a.test(a)){h=!0;a=a.match(f.a).slice(1);a.forEach(d);B=f.e.call(new n,b);break}return{g:h,response:B}};z=function(a,b){var c=this;c.keys=[];c.id=a.replace(/\/<(\w+)>/,function(a,b,f){c.keys.push(f);return"/(\\w+)"});c.a=new RegExp("^"+c.id+"$");c.e=b;c.m=0===c.keys.length};
m.router={register:function(a,b){var c=!1,d,g,f,h;d=new z(a,b);f=d.m?v:w;if(f.length){for(h=0;h<f.length;h++)if(g=f[h],!(g.id<d.id)){f.splice(h,0,d);c=!0;break}!1===c&&f.push(d)}else f.push(d)},route:function(a,b){var c;b=b||{};b.b=b.b||{};x.route.forEach(function(c){c(a,b)});c=y(a,b,v);if(c.g)return c=c.response,x.routed.forEach(function(d){d(a,b,c)}),c;c=y(a,b,w);if(c.g)return c=c.response,x.routed.forEach(function(d){d(a,b,c)}),c;c={status:404};x.error.forEach(function(d){d(a,b,c)});return c},
k:function(a,b){x[a]||(x[a]=[]);x[a].push(b)},a:function(a,b){var c;b?(c=x[a].indexOf(b),-1<c&&x[a].splice(c,1)):x[a]=[]},init:function(a,b){for(var c in a)a.hasOwnProperty(c)&&"function"===typeof a[c]&&this.router.register(c,a[c]);b&&b(window.location.pathname.split("?").shift())}}.service("router");m.history={push:p.history.f?function(a,b){window.history.pushState(b,"",a)}:function(){},init:function(){var a=this;a.router.k("routed",function(a,c){"history"!==c.source&&m.history.push(a,c.state)});p.history.f&&(window.onpopstate=function(b){a.router.route(window.location.pathname,{source:"history",state:b.state||{}})});a.init=function(){throw Error("History already started");}}}.service("history");var A;A=function(a,b,c){var d=this;d.name=a;d.config=c;b.forEach(function(a){var b=r("/_rpc/v1/",d.name+"."+a);d[a]=function(a,c){var d={url:b,data:a.data||{},b:a.b||{},headers:a.headers||{}};d.headers.Accept="application/json";d.headers["Content-Type"]="application/json";return this.http.l(d,c)}.client()})};m.rpc={j:function(a){var b=a[0];m.rpc[b]=new A(b,a[1],a[2])},init:function(a){a.forEach(m.rpc.j)}}.service("rpc");var C={};m.template={put:function(a,b){"string"===typeof a&&"string"===typeof b&&(C[a]=b)},get:function(a,b){if("string"!==typeof a||"function"!==typeof b.d||"function"!==typeof b.error)throw new TypeError("template.get() requires a filename and CallbackMap.");return C[a]?b.d({data:C[a]}):this.rpc.content.template({data:{path:a}},b)},a:function(a){return!!C[a]},init:function(a){for(var b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&m.template.put(b,a[b])}}.service("template");var D={};function E(a,b){var c=a.replace(".","/")+".html";m.template.get(c,{d:function(d){var g=[],f=d.data.replace(/v-component=("|')(\w+)\1/g,function(a,b,c){g.push(c);return a}),h=g.length;D[a]&&(D[a].options.template=f);m.template.put(c,f);if(0===h)return b();g.forEach(function(a){E(a,function(){h-=1;0===h&&b(f)})})},error:function(a){b(!1,a)}})}
m.view={put:function(a,b){if("string"!==typeof a||"function"!==typeof b)throw new TypeError("services.view.put() takes a string name and constructor.");return D[a]=b},get:function(a){if("string"!==typeof a)throw new TypeError("services.view.get() takes a string name.");return D[a]},init:function(a,b){var c=m.view.get(a);if(!c)throw Error("view.init() cannot be called with unregistered view "+a);E(a,function(d){document.body.innerHTML="";d&&(c.options.template=d);m.view.put(a,c);d=new c({ready:b,el:"body"});
window.__ROOTVIEW=d})}}.service("view");window.__VIEWS=D;var F=Vue.extend({});F.a=function(a){var b=a.viewname.toLowerCase();if(!b||"string"!==typeof b)throw Error('AppView.extend() requires a "viewname" option to be passed.');a=Vue.extend(a);m.view.put(b,a);Vue.component(b,a)};var G=Vue.extend({data:{page:{route:"/"},active:!1,modal:null},methods:{route:function(a){var b=a.target.getAttribute("href");a.preventDefault();a.stopPropagation();m.router.route(b)}},ready:function(){this.$set("active",!0)}});m.view.put("container",G);F.a({viewname:"header",replace:!0});F.a({viewname:"stage",replace:!0,data:{active:!0}});var H,I,J;H=[];I=function(){var a=H;H=null;a.forEach(function(a){a()})};
J=m.a={init:function(a){var b=this;b.e=a;b.session=null;b.c=null;a.session&&a.session.established&&(b.session=a.session.payload);a.services&&a.protocol.rpc.enabled&&b.rpc.init(a.services);a.template.manifest&&b.template.init(a.template.manifest);b.view.init("container",function(){m.a.c=this;I()});b.router.init(e,function(a){b.a.ready(function(){b.history.init();if(a)return b.router.route(a);b.router.route("/beta")})});m.a.init=function(){return b};return this},ready:function(a){if(a){if(!H)return a();
H.push(a)}}}.service("catnip");window.catnip_beta=J.init(l.i,l.data);})();
